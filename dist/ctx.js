var J=Object.create;var{getPrototypeOf:H,defineProperty:N,getOwnPropertyNames:M}=Object;var Q=Object.prototype.hasOwnProperty;var B=(E,X,K)=>{K=E!=null?J(H(E)):{};let A=X||!E||!E.__esModule?N(K,"default",{value:E,enumerable:!0}):K;for(let F of M(E))if(!Q.call(A,F))N(A,F,{get:()=>E[F],enumerable:!0});return A};var C=((E)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(E,{get:(X,K)=>(typeof require!=="undefined"?require:X)[K]}):E)(function(E){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+E+'" is not supported')});function R(E){switch(E.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}function v(E,X){if(!E)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");return(K)=>{try{let A=K.cookies?.accessToken||K.req?.headers?.get("Authorization");if(!A)return K.json({message:"Unauthorized: No token provided"},401);if(A.startsWith("Bearer "))A=A.slice(7);let F=E?.verify(A,X);if(!F)return K.json({message:"Unauthorized: Invalid token"},401);K.set("user",F)}catch(A){return console.error("JWT verification error:",A),K.json({message:"Unauthorized: Invalid token",error:A?.message},401)}}}function T(E,X,K){if(!E)throw new Error("JWT library is not defined, please provide jwt to authenticateJwtDB Function");if(!X)throw new Error("User model is not defined, please provide UserModel to authenticateJwtDB Function");return async(A)=>{try{let F=A.cookies?.accessToken||A.req?.headers?.get("Authorization");if(!F)return A.json({message:"Unauthorized: No token provided"},401);if(F.startsWith("Bearer "))F=F.slice(7);let Z=E?.verify(F,K);if(!Z)return A.json({message:"Unauthorized: Invalid token"},401);let Y=await X.findById(Z._id).select("-password -refreshToken");if(!Y)return A.json({message:"Unauthorized: User not found"},401);A.set("user",Y);return}catch(F){return A.json({message:"Unauthorized: Authentication failed",error:F?.message},401)}}}function U(E,X,K){let A=null,F=null,Z=null,Y=null,I={};return{req:E,server:X,url:K,status:200,headers:new Headers({"Cache-Control":"no-cache"}),setHeader(z,G){return this.headers.set(z,G),this},removeHeader(z){return this.headers.delete(z),this},get ip(){return this.server.requestIP(this.req)?.address??null},get query(){if(!A)try{A=Object.fromEntries(this.url.searchParams)}catch(z){throw new Error("Failed to parse query parameters")}return A},get params(){if(!F&&this.req.routePattern)try{F=f(this.req.routePattern,this.url.pathname)}catch(z){throw new Error("Failed to extract route parameters")}return F??{}},get body(){if(this.req.method==="GET")return Promise.resolve({});if(!Y)Y=(async()=>{let z=await b(this.req);if(z.error)throw new Error(z.error);return Object.keys(z).length===0?null:z})();return Y},set(z,G){return I[z]=G,this},get(z){return I[z]},text(z,G){if(G)this.status=G;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type","text/plain; charset=utf-8");return new Response(z,{status:this.status,headers:this.headers})},send(z,G){if(G)this.status=G;let L=new Map([["string","text/plain; charset=utf-8"],["object","application/json; charset=utf-8"],["Uint8Array","application/octet-stream"],["ArrayBuffer","application/octet-stream"]]),O=z instanceof Uint8Array?"Uint8Array":z instanceof ArrayBuffer?"ArrayBuffer":typeof z;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",L.get(O)??"text/plain; charset=utf-8");let $=O==="object"&&z!==null?JSON.stringify(z):z;return new Response($,{status:this.status,headers:this.headers})},json(z,G){if(G)this.status=G;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type","application/json; charset=utf-8");return Response.json(z,{status:this.status,headers:this.headers})},file(z,G,L){if(L)this.status=L;let O=Bun.file(z);if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",G??R(z));return new Response(O,{status:this.status,headers:this.headers})},async ejs(z,G={},L){if(L)this.status=L;let O;try{O=await import("ejs"),O=O.default||O}catch($){return console.error("EJS not installed! Please run `bun add ejs`"),new Response("EJS not installed! Please run `bun add ejs`",{status:500})}try{let $=await Bun.file(z).text(),V=O.render($,G),W=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response(V,{status:this.status,headers:W})}catch($){return console.error("EJS Rendering Error:",$),new Response("Error rendering template",{status:500})}},redirect(z,G){if(G)this.status=G;else this.status=302;return this.headers.set("Location",z),new Response(null,{status:this.status,headers:this.headers})},stream(z){let G=new Headers(this.headers),L=new ReadableStream({async start(O){await z(O),O.close()}});return new Response(L,{headers:G})},yieldStream(z){return new Response({async*[Symbol.asyncIterator](){yield*z()}},{headers:this.headers})},setCookie(z,G,L={}){let O=`${encodeURIComponent(z)}=${encodeURIComponent(G)}`;if(L.maxAge)O+=`; Max-Age=${L.maxAge}`;if(L.expires)O+=`; Expires=${L.expires.toUTCString()}`;if(L.path)O+=`; Path=${L.path}`;if(L.domain)O+=`; Domain=${L.domain}`;if(L.secure)O+="; Secure";if(L.httpOnly)O+="; HttpOnly";if(L.sameSite)O+=`; SameSite=${L.sameSite}`;return this.headers.append("Set-Cookie",O),this},get cookies(){if(!Z){let z=this.req.headers.get("cookie");Z=z?D(z):{}}return Z}}}function D(E){return Object.fromEntries(E.split(";").map((X)=>{let[K,...A]=X.trim().split("=");return[K,decodeURIComponent(A.join("="))]}))}function f(E,X){let K={},A=E.split("/"),[F]=X.split("?"),Z=F.split("/");if(A.length!==Z.length)return null;for(let Y=0;Y<A.length;Y++)if(A[Y].startsWith(":"))K[A[Y].slice(1)]=Z[Y];return K}async function b(E){let X=E.headers.get("Content-Type");if(!X)return{};if(E.headers.get("Content-Length")==="0"||!E.body)return{};try{if(X.startsWith("application/json"))return await E.json();if(X.startsWith("application/x-www-form-urlencoded")){let A=await E.text();return Object.fromEntries(new URLSearchParams(A))}if(X.startsWith("multipart/form-data")){let A=await E.formData(),F={};for(let[Z,Y]of A.entries())F[Z]=Y;return F}return{error:"Unknown request body type"}}catch(A){return{error:"Invalid request body format"}}}export{U as default};
