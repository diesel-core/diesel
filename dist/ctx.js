function V(E){let{time:F=60000,max:O=100,message:z="Rate limit exceeded. Please try again later."}=E,G=new Map;return(Y)=>{let K=new Date,$=Y.ip;if(!G.has($))G.set($,{count:0,startTime:K});let Z=G.get($);if(Z)if(K-Z.startTime>F)Z.count=1,Z.startTime=K;else Z.count++;if(Z&&Z.count>O)return Y.json({error:z},429)}}function R(E){switch(E.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}var N=(E,F,O,z)=>{if(O>z)return!1;let G=O+(z-O)/2;if(E[G]==F)return!0;if(E[G]>F)return N(E,F,O,G-1);return N(E,F,G+1,z)};function W(E,F,O){let z=new Headers({"Cache-Control":"no-cache"}),G=null,Y=null,K=null,$=null,Z={};return{req:E,server:F,url:O,setHeader(A,L){return z.set(A,L),this},removeHeader(A){return z.delete(A),this},get ip(){return this.server.requestIP(this.req)?.address??null},get query(){if(!G)try{G=Object.fromEntries(this.url.searchParams)}catch(A){throw new Error("Failed to parse query parameters")}return G},get params(){if(!Y&&this.req.routePattern)try{Y=w(this.req.routePattern,this.url.pathname)}catch(A){throw new Error("Failed to extract route parameters")}return Y??{}},get body(){if(!$)$=(async()=>{let A=await _(this.req);if(A.error)throw new Error(A.error);return Object.keys(A).length===0?null:A})();return $},set(A,L){return Z[A]=L,this},get(A){return Z[A]},text(A,L=200){if(!z.has("Content-Type"))z.set("Content-Type","text/plain; charset=utf-8");return new Response(A,{status:L,headers:z})},send(A,L=200){let J=new Map([["string","text/plain; charset=utf-8"],["object","application/json; charset=utf-8"],["Uint8Array","application/octet-stream"],["ArrayBuffer","application/octet-stream"]]),X=A instanceof Uint8Array?"Uint8Array":A instanceof ArrayBuffer?"ArrayBuffer":typeof A;if(!z.has("Content-Type"))z.set("Content-Type",J.get(X)??"text/plain; charset=utf-8");let U=X==="object"&&A!==null?JSON.stringify(A):A;return new Response(U,{status:L,headers:z})},json(A,L=200){if(!z.has("Content-Type"))z.set("Content-Type","application/json; charset=utf-8");return new Response(JSON.stringify(A),{status:L,headers:z})},file(A,L=200,J){let X=Bun.file(A);if(!z.has("Content-Type"))z.set("Content-Type",J??R(A));return new Response(X,{status:L,headers:z})},redirect(A,L=302){return z.set("Location",A),new Response(null,{status:L,headers:z})},setCookie(A,L,J={}){let X=`${encodeURIComponent(A)}=${encodeURIComponent(L)}`;if(J.maxAge)X+=`; Max-Age=${J.maxAge}`;if(J.expires)X+=`; Expires=${J.expires.toUTCString()}`;if(J.path)X+=`; Path=${J.path}`;if(J.domain)X+=`; Domain=${J.domain}`;if(J.secure)X+="; Secure";if(J.httpOnly)X+="; HttpOnly";if(J.sameSite)X+=`; SameSite=${J.sameSite}`;return z.append("Set-Cookie",X),this},get cookies(){if(!K){let A=this.req.headers.get("cookie");K=A?j(A):{}}return K}}}function j(E){return Object.fromEntries(E.split(";").map((F)=>{let[O,...z]=F.trim().split("=");return[O,decodeURIComponent(z.join("="))]}))}function w(E,F){let O={},z=E.split("/"),[G]=F.split("?"),Y=G.split("/");if(z.length!==Y.length)return null;for(let K=0;K<z.length;K++)if(z[K].startsWith(":"))O[z[K].slice(1)]=Y[K];return O}async function _(E){let F=E.headers.get("Content-Type");if(!F)return{};if(E.headers.get("Content-Length")==="0"||!E.body)return{};try{if(F.startsWith("application/json"))return await E.json();if(F.startsWith("application/x-www-form-urlencoded")){let z=await E.text();return Object.fromEntries(new URLSearchParams(z))}if(F.startsWith("multipart/form-data")){let z=await E.formData(),G={};for(let[Y,K]of z.entries())G[Y]=K;return G}return{error:"Unknown request body type"}}catch(z){return{error:"Invalid request body format"}}}export{W as default};
