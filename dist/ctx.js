var Q=Object.create;var{getPrototypeOf:b,defineProperty:V,getOwnPropertyNames:B}=Object;var C=Object.prototype.hasOwnProperty;var M=(E,K,G)=>{G=E!=null?Q(b(E)):{};let z=K||!E||!E.__esModule?V(G,"default",{value:E,enumerable:!0}):G;for(let F of B(E))if(!C.call(z,F))V(z,F,{get:()=>E[F],enumerable:!0});return z};var U=((E)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(E,{get:(K,G)=>(typeof require!=="undefined"?require:K)[G]}):E)(function(E){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+E+'" is not supported')});function D(E){let{time:K=60000,max:G=100,message:z="Rate limit exceeded. Please try again later."}=E,F=new Map;return(Z)=>{let Y=new Date,N=Z.ip;if(!F.has(N))F.set(N,{count:0,startTime:Y});let $=F.get(N);if($)if(Y-$.startTime>K)$.count=1,$.startTime=Y;else $.count++;if($&&$.count>G)return Z.json({error:z},429)}}function W(E){switch(E.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}function T(E,K){if(!E)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");return(G)=>{try{let z=G.cookies?.accessToken||G.req?.headers?.get("Authorization");if(!z)return G.json({message:"Unauthorized: No token provided"},401);if(z.startsWith("Bearer "))z=z.slice(7);let F=E?.verify(z,K);if(!F)return G.json({message:"Unauthorized: Invalid token"},401);G.set("user",F);return}catch(z){return G.json({message:"Unauthorized: Invalid token",error:z?.message},401)}}}function g(E,K,G){if(!E)throw new Error("JWT library is not defined, please provide jwt to authenticateJwtDB Function");if(!K)throw new Error("User model is not defined, please provide UserModel to authenticateJwtDB Function");return async(z)=>{try{let F=z.cookies?.accessToken||z.req?.headers?.get("Authorization");if(!F)return z.json({message:"Unauthorized: No token provided"},401);if(F.startsWith("Bearer "))F=F.slice(7);let Z=E?.verify(F,G);if(!Z)return z.json({message:"Unauthorized: Invalid token"},401);let Y=await K.findById(Z._id).select("-password -refreshToken");if(!Y)return z.json({message:"Unauthorized: User not found"},401);z.set("user",Y);return}catch(F){return z.json({message:"Unauthorized: Authentication failed",error:F?.message},401)}}}function _(E,K,G){let z=new Headers({"Cache-Control":"no-cache"}),F=null,Z=null,Y=null,N=null,$={};return{req:E,server:K,url:G,status:200,setHeader(A,L){return z.set(A,L),this},removeHeader(A){return z.delete(A),this},get ip(){return this.server.requestIP(this.req)?.address??null},get query(){if(!F)try{F=Object.fromEntries(this.url.searchParams)}catch(A){throw new Error("Failed to parse query parameters")}return F},get params(){if(!Z&&this.req.routePattern)try{Z=v(this.req.routePattern,this.url.pathname)}catch(A){throw new Error("Failed to extract route parameters")}return Z??{}},get body(){if(this.req.method==="GET")return Promise.resolve({});if(!N)N=(async()=>{let A=await S(this.req);if(A.error)throw new Error(A.error);return Object.keys(A).length===0?null:A})();return N},set(A,L){return $[A]=L,this},get(A){return $[A]},text(A,L){if(L)this.status=L;if(!z.has("Content-Type"))z.set("Content-Type","text/plain; charset=utf-8");return new Response(A,{status:this.status,headers:z})},send(A,L){if(L)this.status=L;let O=new Map([["string","text/plain; charset=utf-8"],["object","application/json; charset=utf-8"],["Uint8Array","application/octet-stream"],["ArrayBuffer","application/octet-stream"]]),X=A instanceof Uint8Array?"Uint8Array":A instanceof ArrayBuffer?"ArrayBuffer":typeof A;if(!z.has("Content-Type"))z.set("Content-Type",O.get(X)??"text/plain; charset=utf-8");let R=X==="object"&&A!==null?JSON.stringify(A):A;return new Response(R,{status:this.status,headers:z})},json(A,L){if(L)this.status=L;if(!z.has("Content-Type"))z.set("Content-Type","application/json; charset=utf-8");return new Response(JSON.stringify(A),{status:this.status,headers:z})},file(A,L,O){if(O)this.status=O;let X=Bun.file(A);if(!z.has("Content-Type"))z.set("Content-Type",L??W(A));return new Response(X,{status:this.status,headers:z})},async ejs(A,L={},O){if(O)this.status=O;let X;try{X=await import("ejs"),X=X.default||X}catch(R){return console.error("EJS not installed! Please run `bun add ejs`"),new Response("EJS not installed! Please run `bun add ejs`",{status:500})}try{let R=await Bun.file(A).text(),J=X.render(R,L),H=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response(J,{status:this.status,headers:H})}catch(R){return console.error("EJS Rendering Error:",R),new Response("Error rendering template",{status:500})}},redirect(A,L){if(L)this.status=L;else this.status=302;return z.set("Location",A),new Response(null,{status:this.status,headers:z})},setCookie(A,L,O={}){let X=`${encodeURIComponent(A)}=${encodeURIComponent(L)}`;if(O.maxAge)X+=`; Max-Age=${O.maxAge}`;if(O.expires)X+=`; Expires=${O.expires.toUTCString()}`;if(O.path)X+=`; Path=${O.path}`;if(O.domain)X+=`; Domain=${O.domain}`;if(O.secure)X+="; Secure";if(O.httpOnly)X+="; HttpOnly";if(O.sameSite)X+=`; SameSite=${O.sameSite}`;return z.append("Set-Cookie",X),this},get cookies(){if(!Y){let A=this.req.headers.get("cookie");Y=A?I(A):{}}return Y}}}function I(E){return Object.fromEntries(E.split(";").map((K)=>{let[G,...z]=K.trim().split("=");return[G,decodeURIComponent(z.join("="))]}))}function v(E,K){let G={},z=E.split("/"),[F]=K.split("?"),Z=F.split("/");if(z.length!==Z.length)return null;for(let Y=0;Y<z.length;Y++)if(z[Y].startsWith(":"))G[z[Y].slice(1)]=Z[Y];return G}async function S(E){let K=E.headers.get("Content-Type");if(!K)return{};if(E.headers.get("Content-Length")==="0"||!E.body)return{};try{if(K.startsWith("application/json"))return await E.json();if(K.startsWith("application/x-www-form-urlencoded")){let z=await E.text();return Object.fromEntries(new URLSearchParams(z))}if(K.startsWith("multipart/form-data")){let z=await E.formData(),F={};for(let[Z,Y]of z.entries())F[Z]=Y;return F}return{error:"Unknown request body type"}}catch(z){return{error:"Invalid request body format"}}}export{_ as default};
