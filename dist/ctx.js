var H=Object.create;var{getPrototypeOf:Q,defineProperty:R,getOwnPropertyNames:b}=Object;var B=Object.prototype.hasOwnProperty;var C=(E,K,G)=>{G=E!=null?H(Q(E)):{};let A=K||!E||!E.__esModule?R(G,"default",{value:E,enumerable:!0}):G;for(let F of b(E))if(!B.call(A,F))R(A,F,{get:()=>E[F],enumerable:!0});return A};var M=((E)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(E,{get:(K,G)=>(typeof require!=="undefined"?require:K)[G]}):E)(function(E){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+E+'" is not supported')});function U(E){let{time:K=60000,max:G=100,message:A="Rate limit exceeded. Please try again later."}=E,F=new Map;return(Z)=>{let Y=new Date,$=Z.ip;if(!F.has($))F.set($,{count:0,startTime:Y});let z=F.get($);if(z)if(Y-z.startTime>K)z.count=1,z.startTime=Y;else z.count++;if(z&&z.count>G)return Z.json({error:A},429)}}function V(E){switch(E.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}function f(E,K){if(!E)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");return(G)=>{try{let A=G.cookies?.accessToken||G.req?.headers?.get("Authorization");if(!A)return G.json({message:"Unauthorized: No token provided"},401);if(A.startsWith("Bearer "))A=A.slice(7);let F=E?.verify(A,K);if(!F)return G.json({message:"Unauthorized: Invalid token"},401);G.set("user",F);return}catch(A){return G.json({message:"Unauthorized: Invalid token",error:A?.message},401)}}}function T(E,K,G){if(!E)throw new Error("JWT library is not defined, please provide jwt to authenticateJwtDB Function");if(!K)throw new Error("User model is not defined, please provide UserModel to authenticateJwtDB Function");return async(A)=>{try{let F=A.cookies?.accessToken||A.req?.headers?.get("Authorization");if(!F)return A.json({message:"Unauthorized: No token provided"},401);if(F.startsWith("Bearer "))F=F.slice(7);let Z=E?.verify(F,G);if(!Z)return A.json({message:"Unauthorized: Invalid token"},401);let Y=await K.findById(Z._id).select("-password -refreshToken");if(!Y)return A.json({message:"Unauthorized: User not found"},401);A.set("user",Y);return}catch(F){return A.json({message:"Unauthorized: Authentication failed",error:F?.message},401)}}}function D(E,K,G){let A=null,F=null,Z=null,Y=null,$={};return{req:E,server:K,url:G,status:200,headers:new Headers({"Cache-Control":"no-cache"}),setHeader(z,L){return this.headers.set(z,L),this},removeHeader(z){return this.headers.delete(z),this},get ip(){return this.server.requestIP(this.req)?.address??null},get query(){if(!A)try{A=Object.fromEntries(this.url.searchParams)}catch(z){throw new Error("Failed to parse query parameters")}return A},get params(){if(!F&&this.req.routePattern)try{F=I(this.req.routePattern,this.url.pathname)}catch(z){throw new Error("Failed to extract route parameters")}return F??{}},get body(){if(this.req.method==="GET")return Promise.resolve({});if(!Y)Y=(async()=>{let z=await v(this.req);if(z.error)throw new Error(z.error);return Object.keys(z).length===0?null:z})();return Y},set(z,L){return $[z]=L,this},get(z){return $[z]},text(z,L){if(L)this.status=L;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type","text/plain; charset=utf-8");return new Response(z,{status:this.status,headers:this.headers})},send(z,L){if(L)this.status=L;let O=new Map([["string","text/plain; charset=utf-8"],["object","application/json; charset=utf-8"],["Uint8Array","application/octet-stream"],["ArrayBuffer","application/octet-stream"]]),X=z instanceof Uint8Array?"Uint8Array":z instanceof ArrayBuffer?"ArrayBuffer":typeof z;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",O.get(X)??"text/plain; charset=utf-8");let N=X==="object"&&z!==null?JSON.stringify(z):z;return new Response(N,{status:this.status,headers:this.headers})},json(z,L){if(L)this.status=L;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type","application/json; charset=utf-8");return new Response(JSON.stringify(z),{status:this.status,headers:this.headers})},file(z,L,O){if(O)this.status=O;let X=Bun.file(z);if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",L??V(z));return new Response(X,{status:this.status,headers:this.headers})},async ejs(z,L={},O){if(O)this.status=O;let X;try{X=await import("ejs"),X=X.default||X}catch(N){return console.error("EJS not installed! Please run `bun add ejs`"),new Response("EJS not installed! Please run `bun add ejs`",{status:500})}try{let N=await Bun.file(z).text(),W=X.render(N,L),J=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response(W,{status:this.status,headers:J})}catch(N){return console.error("EJS Rendering Error:",N),new Response("Error rendering template",{status:500})}},redirect(z,L){if(L)this.status=L;else this.status=302;return this.headers.set("Location",z),new Response(null,{status:this.status,headers:this.headers})},setCookie(z,L,O={}){let X=`${encodeURIComponent(z)}=${encodeURIComponent(L)}`;if(O.maxAge)X+=`; Max-Age=${O.maxAge}`;if(O.expires)X+=`; Expires=${O.expires.toUTCString()}`;if(O.path)X+=`; Path=${O.path}`;if(O.domain)X+=`; Domain=${O.domain}`;if(O.secure)X+="; Secure";if(O.httpOnly)X+="; HttpOnly";if(O.sameSite)X+=`; SameSite=${O.sameSite}`;return this.headers.append("Set-Cookie",X),this},get cookies(){if(!Z){let z=this.req.headers.get("cookie");Z=z?_(z):{}}return Z}}}function _(E){return Object.fromEntries(E.split(";").map((K)=>{let[G,...A]=K.trim().split("=");return[G,decodeURIComponent(A.join("="))]}))}function I(E,K){let G={},A=E.split("/"),[F]=K.split("?"),Z=F.split("/");if(A.length!==Z.length)return null;for(let Y=0;Y<A.length;Y++)if(A[Y].startsWith(":"))G[A[Y].slice(1)]=Z[Y];return G}async function v(E){let K=E.headers.get("Content-Type");if(!K)return{};if(E.headers.get("Content-Length")==="0"||!E.body)return{};try{if(K.startsWith("application/json"))return await E.json();if(K.startsWith("application/x-www-form-urlencoded")){let A=await E.text();return Object.fromEntries(new URLSearchParams(A))}if(K.startsWith("multipart/form-data")){let A=await E.formData(),F={};for(let[Z,Y]of A.entries())F[Z]=Y;return F}return{error:"Unknown request body type"}}catch(A){return{error:"Invalid request body format"}}}export{D as default};
