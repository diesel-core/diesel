function G(f,z){if(!f)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");return(A)=>{try{let q=A.cookies?.accessToken||A.req?.headers?.get("Authorization");if(!q)return A.json({message:"Unauthorized: No token provided"},401);if(q.startsWith("Bearer "))q=q.slice(7);let v=f?.verify(q,z);if(!v)return A.json({message:"Unauthorized: Invalid token"},401);A.set("user",v)}catch(q){return console.error("JWT verification error:",q),A.json({message:"Unauthorized: Invalid token",error:q?.message},401)}}}function H(f,z,A){if(!f)throw new Error("JWT library is not defined, please provide jwt to authenticateJwtDB Function");if(!z)throw new Error("User model is not defined, please provide UserModel to authenticateJwtDB Function");return async(q)=>{try{let v=q.cookies?.accessToken||q.req?.headers?.get("Authorization");if(!v)return q.json({message:"Unauthorized: No token provided"},401);if(v.startsWith("Bearer "))v=v.slice(7);let E=f?.verify(v,A);if(!E)return q.json({message:"Unauthorized: Invalid token"},401);let C=await z.findById(E._id).select("-password -refreshToken");if(!C)return q.json({message:"Unauthorized: User not found"},401);q.set("user",C);return}catch(v){return q.json({message:"Unauthorized: Authentication failed",error:v?.message},401)}}}var L=(f)=>{if(!f.app)throw new Error("Diesel app is not defined, please provide app to authenticateJwt Function");if(!f.jwt)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");if(!f.jwtSecret)f.jwtSecret=f.app.user_jwt_secret;let{routes:z,app:A,jwt:q,jwtSecret:v}=f,E=G(q,v);return(C)=>{if(z?.length===0||z?.includes(C.url.pathname))return E(C)}},N=(f)=>{if(!f.app)throw new Error("Diesel app is not defined, please provide app to authenticateJwt Function");if(!f.userModel)throw new Error("User model is not defined, please provide userModel to authenticateJwt Function");if(!f.jwt)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");if(!f.jwtSecret)f.jwtSecret=f.app.user_jwt_secret;let{routes:z,app:A,jwt:q,jwtSecret:v,userModel:E}=f,C=H(q,E,v);return(F)=>{if(z?.length===0||z?.includes(F.url.pathname))return C(F)}};export{N as authenticateJwtDB,L as authenticateJwt};
