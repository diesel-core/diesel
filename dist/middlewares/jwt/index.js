function F(f,A){if(!f)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");return(z)=>{try{let q=z.cookies?.accessToken||z.req?.headers?.get("Authorization");if(!q)return z.json({message:"Unauthorized: No token provided"},401);if(q.startsWith("Bearer "))q=q.slice(7);let v=f?.verify(q,A);if(!v)return z.json({message:"Unauthorized: Invalid token"},401);z.set("user",v)}catch(q){return console.error("JWT verification error:",q),z.json({message:"Unauthorized: Invalid token",error:q?.message},401)}}}function G(f,A,z){if(!f)throw new Error("JWT library is not defined, please provide jwt to authenticateJwtDB Function");if(!A)throw new Error("User model is not defined, please provide UserModel to authenticateJwtDB Function");return async(q)=>{try{let v=q.cookies?.accessToken||q.req?.headers?.get("Authorization");if(!v)return q.json({message:"Unauthorized: No token provided"},401);if(v.startsWith("Bearer "))v=v.slice(7);let C=f?.verify(v,z);if(!C)return q.json({message:"Unauthorized: Invalid token"},401);let E=await A.findById(C._id).select("-password -refreshToken");if(!E)return q.json({message:"Unauthorized: User not found"},401);q.set("user",E);return}catch(v){return q.json({message:"Unauthorized: Authentication failed",error:v?.message},401)}}}var K=(f)=>{if(!f.app)throw new Error("Diesel app is not defined, please provide app to authenticateJwt Function");if(!f.jwt)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");if(!f.jwtSecret)f.jwtSecret=f.app.user_jwt_secret;let{routes:A,jwt:z,jwtSecret:q}=f,v=F(z,q);return(C)=>{if(!A?.length||A?.includes(C.url.pathname))return v(C)}},L=(f)=>{if(!f.app)throw new Error("Diesel app is not defined, please provide app to authenticateJwt Function");if(!f.userModel)throw new Error("User model is not defined, please provide userModel to authenticateJwt Function");if(!f.jwt)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");if(!f.jwtSecret)f.jwtSecret=f.app.user_jwt_secret;let{routes:A,jwt:z,jwtSecret:q,userModel:v}=f,C=G(z,v,q);return(E)=>{if(A?.length===0||A?.includes(E.url.pathname))return C(E)}};export{L as authenticateJwtDB,K as authenticateJwt};
