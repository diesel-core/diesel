var t={reset:"\x1B[0m",info:"\x1B[36m",warn:"\x1B[33m",error:"\x1B[31m",method:{GET:"\x1B[32m",POST:"\x1B[34m",PUT:"\x1B[35m",DELETE:"\x1B[31m",PATCH:"\x1B[36m"}},R=(d,s,o)=>{let a=t[d]||t.reset,u=o?.method?t.method[o.method]||t.reset:t.reset,g=o?.status?o.status>=500?t.error:o.status>=400?t.warn:t.info:t.reset;console.log(`
${a}[${d.toUpperCase()}]${t.reset} ${s} - ${u}${o?.method||""}${t.reset}`);let p={timestamp:new Date().toISOString(),...o,status:o?.status?`${g}${o.status}${t.reset}`:void 0,method:o?.method?`${u}${o.method}${t.reset}`:void 0};console.log(JSON.stringify(p,null,2)+`
`)},h=(d)=>{let{app:s,logger:o,logLevel:a="info",onRequest:u,onSend:g,onError:p,routeNotFound:n}=d||{};s?.addHooks("onRequest",(e,r)=>{e.startTime=Date.now(),o?.()??R(a,"Incoming Request",{method:e.method,url:r.toString(),headers:{"user-agent":e.headers.get("user-agent"),"content-type":e.headers.get("content-type")}}),u?.(e,r)}),s?.addHooks("onSend",async(e)=>{let r=`${Date.now()-e.req.startTime}ms`;o?.()??R(a,"Response Sent",{method:e.req.method,url:e.url.toString(),status:e.status,duration:r,headers:{"content-type":e.headers.get("content-type")}});let i=await g?.(e);if(i instanceof Response)return i}),s?.addHooks("routeNotFound",async(e)=>{o?.()??R("warn","Route Not Found",{method:e.req.method,url:e.url.toString(),status:404});let r=await n?.(e);if(r instanceof Response)return r}),s?.addHooks("onError",async(e,r,i)=>{o?.()??R("error","Unhandled Error",{method:r.method,url:i.toString(),status:500,error:e.message});let m=await p?.(e,r,i);if(m instanceof Response)return m})},c=(d,s,o,a=0,u)=>{let g=t.method[s]||t.reset,p=a>=500?t.error:a>=400?t.warn:t.info,n=d==="<--"?`${d} ${g}${s}${t.reset} ${o}`:`${d} ${g}${s}${t.reset} ${o} ${p}${a}${t.reset} ${u||""}`;console.log(n)},l=(d)=>{let s=Date.now()-d;return s<1000?`${s}ms`:`${Math.round(s/1000)}s`},L=(d)=>{let{app:s,log:o,onRequest:a,onSend:u,onError:g,routeNotFound:p}=d;s.addHooks("onRequest",(n,e)=>{n.startTime=Date.now(),o?.()??c("<--",n.method,e.pathname),a?.(n,e)}),s.addHooks("onSend",async(n)=>{let{method:e,url:r}=n.req,i=new URL(r).pathname;o?.()??c("-->",e,i,n.status,l(n.req.startTime));let m=await u?.(n);if(m instanceof Response)return m}),s.addHooks("routeNotFound",async(n)=>{o?.()??c("[routeNotFound]",n.req.method,n.url.pathname,404);let e=await p?.(n);if(e instanceof Response)return e}),s.addHooks("onError",async(n,e,r)=>{o?.()??c(n.message,e.method,r.toString(),500);let i=await g?.(n,e,r);if(i instanceof Response)return i})};export{L as logger,h as advancedLogger};
