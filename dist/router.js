class Q{children;isEndOfWord;handler;isDynamic;pattern;path;method;subMiddlewares;constructor(){this.children={},this.isEndOfWord=!1,this.handler=[],this.isDynamic=!1,this.pattern="",this.path="",this.method=[],this.subMiddlewares=new Map}}class V{root;constructor(){this.root=new Q}insert(G,z){let F=this.root;const U=G.split("/").filter(Boolean);if(G==="/"){F.isEndOfWord=!0,F.handler.push(z.handler),F.path=G,F.method.push(z.method);return}for(let J of U){let L=!1,X=J;if(J.startsWith(":"))L=!0,X=":";if(!F.children[X])F.children[X]=new Q;F=F.children[X],F.isDynamic=L,F.pattern=J}F.isEndOfWord=!0,F.method.push(z.method),F.handler.push(z.handler),F.path=G}search(G,z){let F=this.root;const U=G.split("/").filter(Boolean);for(let L of U){let X=L;if(!F.children[X])if(F.children[":"])F=F.children[":"];else return null;else F=F.children[X]}let J=F.method.indexOf(z);if(J!==-1)return{path:F.path,handler:F.handler[J],isDynamic:F.isDynamic,pattern:F.pattern,method:F.method[J]};return{path:F.path,handler:F.handler,isDynamic:F.isDynamic,pattern:F.pattern,method:F.method[J]}}}async function M(G){const z={};if(!G)return z;return G.split(";").forEach((U)=>{const[J,L]=U?.trim()?.split("=");if(J&&L)z[J.trim()]=L.split(" ")[0].trim()}),z}function T(G,z){const F={},U=G.split("/"),[J]=z.split("?"),L=J.split("/");if(U.length!==L.length)return null;return U.forEach((X,_)=>{if(X.startsWith(":")){const $=X.slice(1);F[$]=L[_]}}),F}async function b(G){const z=G.headers.get("Content-Type")||"";if(!z)return{};try{if(z.startsWith("application/json"))return await G.json();if(z.startsWith("application/x-www-form-urlencoded")){const F=await G.text();return Object.fromEntries(new URLSearchParams(F))}if(z.startsWith("multipart/form-data")){const F=await G.formData();return N(F)}return{error:"Unknown request body type"}}catch(F){return{error:"Invalid request body format"}}}function N(G){const z={};for(let[F,U]of G.entries())z[F]=U;return z}function B(G,z){let F=new Headers,U={},J=!1,L=null,X=null,_=null,$,A=200;return{req:G,url:z,next:()=>{},status(Y){return A=Y,this},async body(){if(!$)$=await b(G);if($.error)return new Response(JSON.stringify({error:$.error}),{status:400});return $},setHeader(Y,Z){return F.set(Y,Z),this},set(Y,Z){return U[Y]=Z,this},get(Y){return U[Y]||null},setAuth(Y){return J=Y,this},getAuth(){return J},text(Y,Z){return new Response(Y,{status:Z??A,headers:F})},json(Y,Z){return new Response(JSON.stringify(Y),{status:Z??A,headers:F})},html(Y,Z){return new Response(Bun.file(Y),{status:Z??A,headers:F})},file(Y,Z){return new Response(Bun.file(Y),{status:Z??A,headers:F})},redirect(Y,Z){return F.set("Location",Y),new Response(null,{status:Z??302,headers:F})},getParams(Y){if(!_)_=T(G?.routePattern,z?.pathname);return Y?_[Y]||null:_},getQuery(Y){if(!L)L=Object.fromEntries(z.searchParams);return Y?L[Y]||null:L},async cookie(Y,Z,E={}){let W=`${encodeURIComponent(Y)}=${encodeURIComponent(Z)}`;if(E.maxAge)W+=`; Max-Age=${E.maxAge}`;if(E.expires)W+=`; Expires=${E.expires.toUTCString()}`;if(E.path)W+=`; Path=${E.path}`;if(E.domain)W+=`; Domain=${E.domain}`;if(E.secure)W+="; Secure";if(E.httpOnly)W+="; HttpOnly";if(E.sameSite)W+=`; SameSite=${E.sameSite}`;return F?.append("Set-Cookie",W),this},async getCookie(Y){if(!X){const Z=G.headers.get("cookie");if(Z)X=await M(Z)}return Y?X[Y]||null:X}}}async function I(G,z){for(let F of G){const U=await F(z);if(U)return U}}async function C(G,z,F={}){const U=G.headers.get("origin")??"*",J=F?.origin,L=F?.allowedHeaders??["Content-Type","Authorization"],X=F?.methods??["GET","POST","PUT","DELETE","OPTIONS"],_=F?.credentials??!1,$=F?.exposedHeaders??[];if(z.setHeader("Access-Control-Allow-Methods",X),z.setHeader("Access-Control-Allow-Headers",L),z.setHeader("Access-Control-Allow-Credentials",_),$.length)z.setHeader("Access-Control-Expose-Headers",$);if(J==="*")z.setHeader("Access-Control-Allow-Origin","*");else if(Array.isArray(J))if(U&&J.includes(U))z.setHeader("Access-Control-Allow-Origin",U);else if(J.includes("*"))z.setHeader("Access-Control-Allow-Origin","*");else return z.status(403).json({message:"CORS not allowed"});else if(typeof J==="string")if(U===J)z.setHeader("Access-Control-Allow-Origin",U);else return z.status(403).json({message:"CORS not allowed"});else return z.status(403).json({message:"CORS not allowed"});if(z.setHeader("Access-Control-Allow-Origin",U),G.method==="OPTIONS")return z.setHeader("Access-Control-Max-Age","86400"),z.status(204).text("");return null}var K={};async function j(G,z,F){const U=B(G,z);if(F.corsConfig){const L=await C(G,U,F.corsConfig);if(L)return L}if(F.hasOnReqHook&&F.hooks.onRequest)await F.hooks.onRequest(U);if(F.hasMiddleware){const L=[...F.globalMiddlewares,...F.middlewares.get(z.pathname)||[]],X=await I(L,U);if(X)return X}let J;if(K[z.pathname+G.method])J=K[z.pathname+G.method];else J=F.trie.search(z.pathname,G.method),K[z.pathname+G.method]=J;if(!J||!J.handler)return new Response(`Route not found for ${z.pathname}`,{status:404});if(J.method!==G.method)return new Response("Method not allowed",{status:405});if(J.isDynamic)G.routePattern=J.path;if(F.hasPreHandlerHook&&F.hooks.preHandler){const L=await F.hooks.preHandler(U);if(L)return L}try{const L=await J.handler(U);if(F.hasPostHandlerHook&&F.hooks.postHandler)await F.hooks.postHandler(U);if(F.hasOnSendHook&&F.hooks.onSend){const X=await F.hooks.onSend(U,L);if(X)return X}return L??new Response("No response from handler",{status:204})}catch(L){return new Response("Internal Server Error",{status:500})}}class v{routes;globalMiddlewares;middlewares;trie;hasOnReqHook;hasMiddleware;hasPreHandlerHook;hasPostHandlerHook;hasOnSendHook;hooks;corsConfig;constructor(){this.routes=new Map,this.globalMiddlewares=[],this.middlewares=new Map,this.trie=new V,this.corsConfig=null,this.hasMiddleware=!1,this.hasOnReqHook=!1,this.hasPreHandlerHook=!1,this.hasPostHandlerHook=!1,this.hasOnSendHook=!1,this.hooks={onRequest:null,preHandler:null,postHandler:null,onSend:null,onError:null,onClose:null}}cors(G){this.corsConfig=G}addHooks(G,z){if(typeof G!=="string")throw new Error("hookName must be a string");if(typeof z!=="function")throw new Error("callback must be a instance of function");if(this.hooks.hasOwnProperty(G))this.hooks[G]=z;else throw new Error(`Unknown hook type: ${G}`)}compile(){if(this.globalMiddlewares.length>0)this.hasMiddleware=!0;for(let[G,z]of this.middlewares.entries())if(z.length>0){this.hasMiddleware=!0;break}if(this.hooks.onRequest)this.hasOnReqHook=!0;if(this.hooks.preHandler)this.hasPreHandlerHook=!0;if(this.hooks.postHandler)this.hasPostHandlerHook=!0;if(this.hooks.onSend)this.hasOnSendHook=!0}listen(G,z,{sslCert:F=null,sslKey:U=null}={}){if(typeof Bun==="undefined")throw new Error(".listen() is designed to run on Bun only...");if(typeof G!=="number")throw new Error("Port must be a numeric value");this.compile();const J=this,L={port:G,fetch:async(_)=>{const $=new URL(_.url);try{return await j(_,$,this)}catch(A){return new Response("Internal Server Error",{status:500})}},onClose(){console.log("Server is shutting down...")}};if(F&&U)L.certFile=F,L.keyFile=U;const X=Bun.serve(L);if(typeof z==="function")return z();if(F&&U)console.log(`HTTPS server is running on https://localhost:${G}`);else console.log(`HTTP server is running on http://localhost:${G}`);return X}register(G,z){if(typeof G!=="string")throw new Error("path must be a string");if(typeof z!=="object")throw new Error("handler parameter should be a instance of router object",z);const F=Object.entries(z.trie.root.children);z.trie.root.subMiddlewares.forEach((U,J)=>{if(!this.middlewares.has(G+J))this.middlewares.set(G+J,[]);U?.forEach((L)=>{if(!this.middlewares.get(G+J)?.includes(L))this.middlewares.get(G+J)?.push(L)})});for(let[U,J]of F){const L=G+J?.path,X=J.handler[0],_=J.method[0];this.trie.insert(L,{handler:X,method:_})}z.trie=new V}#z(G,z,F){if(typeof z!=="string")throw new Error("Path must be a string type");if(typeof G!=="string")throw new Error("method must be a string type");const U=F.slice(0,-1),J=F[F.length-1];if(!this.middlewares.has(z))this.middlewares.set(z,[]);U.forEach((L)=>{if(z==="/"){if(!this.globalMiddlewares.includes(L))this.globalMiddlewares.push(L)}else if(!this.middlewares.get(z)?.includes(L))this.middlewares.get(z)?.push(L)}),this.trie.insert(z,{handler:J,method:G})}use(G,z){if(typeof G==="function"){if(!this.globalMiddlewares.includes(G))return this.globalMiddlewares.push(G)}const F=G;if(!this.middlewares.has(F))this.middlewares.set(F,[]);if(!this.middlewares.get(F)?.includes(z))this.middlewares.get(F)?.push(z)}get(G,...z){return this.#z("GET",G,z),this}post(G,...z){return this.#z("POST",G,z),this}put(G,...z){return this.#z("PUT",G,z),this}patch(G,...z){return this.#z("PATCH",G,z),this}delete(G,...z){return this.#z("DELETE",G,z),this}}class D extends v{constructor(){super()}#z(G,z,F){if(!this.trie.root.subMiddlewares.has(z))this.trie.root.subMiddlewares.set(z,[]);const U=F.slice(0,-1),J=this.trie.root.subMiddlewares.get(z);U.forEach((X)=>{if(!J?.includes(X))J?.push(X)});const L=F[F.length-1];this.trie.insert(z,{handler:L,method:G})}get(G,...z){return this.#z("GET",G,z),this}post(G,...z){return this.#z("POST",G,z),this}put(G,...z){return this.#z("PUT",G,z),this}patch(G,...z){return this.#z("PATCH",G,z),this}delete(G,...z){return this.#z("DELETE",G,z),this}}var y=D;export{y as default};
