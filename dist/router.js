class V{constructor(){this.children={},this.isEndOfWord=!1,this.handler=[],this.isDynamic=!1,this.pattern="",this.path="",this.method=[],this.subMiddlewares=new Map}}class M{constructor(){this.root=new V}insert(L,G){let E=this.root;const z=L.split("/").filter(Boolean);if(L==="/"){E.isEndOfWord=!0,E.handler.push(G.handler),E.path=L,E.method.push(G.method);return}for(let U of z){let F=!1,X=U;if(U.startsWith(":"))F=!0,X=":";if(!E.children[X])E.children[X]=new V;E=E.children[X],E.isDynamic=F,E.pattern=U}E.isEndOfWord=!0,E.method.push(G.method),E.handler.push(G.handler),E.path=L}insertMidl(L){if(!this.root.subMiddlewares.has(L))this.root.subMiddlewares.set(L)}search(L,G){let E=this.root;const z=L.split("/").filter(Boolean);for(let F of z){let X=F;if(!E.children[X])if(E.children[":"])E=E.children[":"];else return null;else E=E.children[X]}let U=E.method.indexOf(G);if(U!==-1)return{path:E.path,handler:E.handler[U],isDynamic:E.isDynamic,pattern:E.pattern,method:E.method[U]};return{path:E.path,handler:E.handler,isDynamic:E.isDynamic,pattern:E.pattern,method:E.method[U]}}getAllRoutes(){const L=[],G=(E,z)=>{if(E.isEndOfWord)L.push({path:z,handler:E.handler,isImportant:E.isImportant,isDynamic:E.isDynamic,pattern:E.pattern});for(let U in E.children){const F=E.children[U],X=z+(U===":"?"/:"+F.pattern:"/"+U);G(F,X)}};return G(this.root,""),L}}async function v(L){const G={};if(!L)return G;return L.split(";").forEach((z)=>{const[U,F]=z.trim().split("=");G[U]=F.split(" ")[0]}),G}function N(L,G){const E={},z=L.split("/"),[U]=G.split("?"),F=U.split("/");if(z.length!==F.length)return null;return z.forEach((X,$)=>{if(X.startsWith(":")){const A=X.slice(1);E[A]=F[$]}}),E}async function I(L){const G=L.headers.get("Content-Type")||"";if(!G)return{};try{if(G.startsWith("application/json"))return await L.json();if(G.startsWith("application/x-www-form-urlencoded")){const E=await L.text();return Object.fromEntries(new URLSearchParams(E))}if(G.startsWith("multipart/form-data")){const E=await L.formData();return C(E)}return new Response({error:"Unknown request body type"})}catch(E){return new Response({error:"Invalid request body format"})}}function C(L){const G={};for(let[E,z]of L.entries())G[E]=z;return G}function B(L,G){let E={},z={},U=!1,F=null,X=null,$=null,A=null,_=200;return{req:L,url:G,next:()=>{},status(J){return _=J,this},async body(){if(!A)A=await I(L);return A},setHeader(J,Y){return E[J]=Y,this},set(J,Y){return z[J]=Y,this},get(J){return z[J]},setAuth(J){return U=J,this},getAuth(){return U},text(J,Y){if(Y)_=Y;return new Response(J,{status:_,headers:E})},json(J,Y){if(Y)_=Y;return new Response(JSON.stringify(J),{status:_,headers:{"Content-Type":"application/json",...E}})},html(J,Y){if(Y)_=Y;return new Response(Bun.file(J),{status:_,headers:{...E}})},file(J,Y){if(Y)_=Y;return new Response(Bun.file(J),{status:_,headers:{...E}})},redirect(J,Y){if(Y)_=Y;return new Response(null,{status:_,headers:{Location:J,...E}})},getParams(J){if(!$)$=N(L.routePattern,G.pathname);return J?$[J]:$},getQuery(J){if(!F)F=Object.fromEntries(G.searchParams);return J?F[J]:F},async cookie(J,Y,Z={}){let W=`${encodeURIComponent(J)}=${encodeURIComponent(Y)}`;if(Z.maxAge)W+=`; Max-Age=${Z.maxAge}`;if(Z.expires)W+=`; Expires=${Z.expires.toUTCString()}`;if(Z.path)W+=`; Path=${Z.path}`;if(Z.domain)W+=`; Domain=${Z.domain}`;if(Z.secure)W+="; Secure";if(Z.httpOnly)W+="; HttpOnly";if(Z.sameSite)W+=`; SameSite=${Z.sameSite}`;if(E["Set-Cookie"]){const b=Array.isArray(E["Set-Cookie"])?E["Set-Cookie"]:[E["Set-Cookie"]];b.push(W),E["Set-Cookie"]=b}else E["Set-Cookie"]=W;return this},async getCookie(J){if(!X)X=await v(L.headers.get("cookie"));return J?X[J]:X}}}async function w(L,G){for(let E of L){const z=await E(G);if(z)return z}}var Q={};async function T(L,G,E){const z=B(L,G);if(E.hasOnReqHook)await E.hooks.onRequest(z);if(E.hasMiddleware){const F=[...E.globalMiddlewares,...E.middlewares.get(G.pathname)||[]],X=await w(F,z);if(X)return X}let U;if(Q[G.pathname+L.method])U=Q[G.pathname+L.method];else U=E.trie.search(G.pathname,L.method),Q[G.pathname+L.method]=U;if(!U||!U.handler)return new Response(`Route not found for ${G.pathname}`,{status:404});if(U.method!==L.method)return new Response("Method not allowed",{status:405});if(U.isDynamic)L.routePattern=U.path;if(E.hasPreHandlerHook){const F=await E.hooks.preHandler(z);if(F)return F}try{const F=await U.handler(z);if(E.hasPostHandlerHook)await E.hooks.postHandler(z);if(E.hasOnSendHook){const X=await E.hooks.onSend(F,z);if(X)return X}return F??new Response("No response from handler",{status:204})}catch(F){return new Response("Internal Server Error",{status:500})}}class j{constructor(){this.routes=new Map,this.globalMiddlewares=[],this.middlewares=new Map,this.trie=new M,this.hasMiddleware=!1,this.hasOnReqHook=!1,this.hasPreHandlerHook=!1,this.hasPostHandlerHook=!1,this.hasOnSendHook=!1,this.hooks={onRequest:null,preHandler:null,postHandler:null,onSend:null,onError:null,onClose:null}}addHooks(L,G){if(typeof L!=="string")throw new Error("hookName must be a string");if(typeof G!=="function")throw new Error("callback must be a instance of function");if(this.hooks.hasOwnProperty(L))this.hooks[L]=G;else throw new Error(`Unknown hook type: ${L}`)}compile(){if(this.globalMiddlewares.length>0)this.hasMiddleware=!0;for(let[L,G]of this.middlewares.entries())if(G.length>0){this.hasMiddleware=!0;break}if(this.hooks.onRequest)this.hasOnReqHook=!0;if(this.hooks.preHandler)this.hasPreHandlerHook=!0;if(this.hooks.postHandler)this.hasPostHandlerHook=!0;if(this.hooks.onSend)this.hasOnSendHook=!0}listen(L,G,{sslCert:E=null,sslKey:z=null}={}){if(typeof Bun==="undefined")throw new Error(".listen() is designed to run on Bun only...");if(typeof L!=="number")throw new Error("Port must be a numeric value");this.compile();const U={port:L,fetch:async(X)=>{const $=new URL(X.url);try{return await T(X,$,this)}catch(A){return new Response("Internal Server Error",{status:500})}},onClose(){console.log("Server is shutting down...")}};if(E&&z)U.certFile=E,U.keyFile=z;const F=Bun.serve(U);if(typeof G==="function")return G();if(E&&z)console.log(`HTTPS server is running on https://localhost:${L}`);else console.log(`HTTP server is running on http://localhost:${L}`);return F}register(L,G){if(typeof L!=="string")throw new Error("path must be a string");if(typeof G!=="object")throw new Error("handler parameter should be a instance of router object",G);const E=Object.entries(G.trie.root.children);G.trie.root.subMiddlewares.forEach((z,U)=>{if(!this.middlewares.has(L+U))this.middlewares.set(L+U,[]);if(!this.middlewares.get(L+U).includes(...z))this.middlewares.get(L+U).push(...z)});for(let[z,U]of E){const F=L+U?.path,X=U.handler[0],$=U.method[0];this.trie.insert(F,{handler:X,method:$})}G.trie=new M}#E(L,G,E){if(typeof G!=="string")throw new Error("Path must be a string type");if(typeof L!=="string")throw new Error("method must be a string type");const z=E.slice(0,-1);if(!this.middlewares.has(G))this.middlewares.set(G,[]);if(G==="/")z.forEach((F)=>{if(!this.globalMiddlewares.includes(F))this.globalMiddlewares.push(F)});else if(!this.middlewares.get(G).includes(...z))this.middlewares.get(G).push(...z);const U=E[E.length-1];this.trie.insert(G,{handler:U,method:L})}use(L,G){if(typeof L==="function"){if(!this.globalMiddlewares.includes(L))return this.globalMiddlewares.push(L)}const E=L;if(!this.middlewares.has(E))this.middlewares.set(E,[]);if(!this.middlewares.get(E).includes(G))this.middlewares.get(E).push(G)}get(L,...G){return this.#E("GET",L,G),this}post(L,...G){return this.#E("POST",L,G),this}put(L,...G){return this.#E("PUT",L,G),this}patch(L,...G){return this.#E("PATCH",L,G),this}delete(L,...G){return this.#E("DELETE",L,G),this}}var K=j;class D extends K{constructor(){super()}#E(L,G,E){if(!this.trie.root.subMiddlewares.has(G))this.trie.root.subMiddlewares.set(G,[]);const z=E.slice(0,-1);if(!this.trie.root.subMiddlewares.get(G).includes(...z))this.trie.root.subMiddlewares.get(G).push(...z);const U=E[E.length-1];this.trie.insert(G,{handler:U,method:L})}get(L,...G){return this.#E("GET",L,G)}post(L,...G){return this.#E("POST",L,G)}put(L,...G){return this.#E("PUT",L,G)}patch(L,...G){if(G.length>0)return this.#E("PATCH",L,G)}delete(L,...G){return this.#E("DELETE",L,G)}}var y=D;export{y as default};
