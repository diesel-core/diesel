var q=Object.create;var{getPrototypeOf:l,defineProperty:X,getOwnPropertyNames:P}=Object;var k=Object.prototype.hasOwnProperty;var e=(n,o,r)=>{r=n!=null?q(l(n)):{};let g=o||!n||!n.__esModule?X(r,"default",{value:n,enumerable:!0}):r;for(let m of P(n))if(!k.call(g,m))X(g,m,{get:()=>n[m],enumerable:!0});return g};var h=((n)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(n,{get:(o,r)=>(typeof require!=="undefined"?require:o)[r]}):n)(function(n){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')});class x{children;isEndOfWord;handler;isDynamic;pattern;path;method;constructor(){this.children={},this.isEndOfWord=!1,this.handler=[],this.isDynamic=!1,this.pattern="",this.path="",this.method=[]}}class T{root;constructor(){this.root=new x}insert(n,o){let r=this.root,g=n.split("/").filter(Boolean);if(n==="/"){r.isEndOfWord=!0,r.handler.push(o.handler),r.path=n,r.method.push(o.method);return}for(let m of g){let $=!1,i=m;if(m.startsWith(":"))$=!0,i=":";if(!r.children[i])r.children[i]=new x;r=r.children[i],r.isDynamic=$,r.pattern=m}r.isEndOfWord=!0,r.path=n,r.method.push(o.method),r.handler.push(o.handler)}search(n,o){let r=this.root,g=n.split("/").filter(Boolean),m=g.length;for(let u of g){let f=u;if(!r.children[f])if(r.children[":"])r=r.children[":"];else return null;else r=r.children[f]}let $=r.path.split("/").filter(Boolean);if(m!==$.length)return null;let i=r.method.indexOf(o);if(i!==-1)return{path:r.path,handler:r.handler[i],isDynamic:r.isDynamic,pattern:r.pattern,method:r.method[i]};return{path:r.path,handler:r.handler,isDynamic:r.isDynamic,pattern:r.pattern,method:r.method[i]}}}function z(n){switch(n.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}function Y(n,o){if(!n)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");return(r)=>{try{let g=r.cookies?.accessToken||r.req?.headers?.get("Authorization");if(!g)return r.json({message:"Unauthorized: No token provided"},401);if(g.startsWith("Bearer "))g=g.slice(7);let m=n?.verify(g,o);if(!m)return r.json({message:"Unauthorized: Invalid token"},401);r.set("user",m)}catch(g){return console.error("JWT verification error:",g),r.json({message:"Unauthorized: Invalid token",error:g?.message},401)}}}function Z(n,o,r){if(!n)throw new Error("JWT library is not defined, please provide jwt to authenticateJwtDB Function");if(!o)throw new Error("User model is not defined, please provide UserModel to authenticateJwtDB Function");return async(g)=>{try{let m=g.cookies?.accessToken||g.req?.headers?.get("Authorization");if(!m)return g.json({message:"Unauthorized: No token provided"},401);if(m.startsWith("Bearer "))m=m.slice(7);let $=n?.verify(m,r);if(!$)return g.json({message:"Unauthorized: Invalid token"},401);let i=await o.findById($._id).select("-password -refreshToken");if(!i)return g.json({message:"Unauthorized: User not found"},401);g.set("user",i);return}catch(m){return g.json({message:"Unauthorized: Authentication failed",error:m?.message},401)}}}function D(n,o,r){let g=null,m=null,$=null,i=null,u={};return{req:n,server:o,url:r,status:200,headers:new Headers({"Cache-Control":"no-cache"}),setHeader(f,v){return this.headers.set(f,v),this},removeHeader(f){return this.headers.delete(f),this},get ip(){return this.server.requestIP(this.req)?.address??null},get query(){if(!g)try{g=Object.fromEntries(this.url.searchParams)}catch(f){throw new Error("Failed to parse query parameters")}return g},get params(){if(!m&&this.req.routePattern)try{m=d(this.req.routePattern,this.url.pathname)}catch(f){throw new Error("Failed to extract route parameters")}return m??{}},get body(){if(this.req.method==="GET")return Promise.resolve({});if(!i)i=(async()=>{let f=await a(this.req);if(f.error)throw new Error(f.error);return Object.keys(f).length===0?null:f})();return i},set(f,v){return u[f]=v,this},get(f){return u[f]},text(f,v){if(v)this.status=v;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type","text/plain; charset=utf-8");return new Response(f,{status:this.status,headers:this.headers})},send(f,v){if(v)this.status=v;let A=new Map([["string","text/plain; charset=utf-8"],["object","application/json; charset=utf-8"],["Uint8Array","application/octet-stream"],["ArrayBuffer","application/octet-stream"]]),C=f instanceof Uint8Array?"Uint8Array":f instanceof ArrayBuffer?"ArrayBuffer":typeof f;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",A.get(C)??"text/plain; charset=utf-8");let L=C==="object"&&f!==null?JSON.stringify(f):f;return new Response(L,{status:this.status,headers:this.headers})},json(f,v){if(v)this.status=v;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type","application/json; charset=utf-8");return Response.json(f,{status:this.status,headers:this.headers})},file(f,v,A){if(A)this.status=A;let C=Bun.file(f);if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",v??z(f));return new Response(C,{status:this.status,headers:this.headers})},async ejs(f,v={},A){if(A)this.status=A;let C;try{C=await import("ejs"),C=C.default||C}catch(L){return console.error("EJS not installed! Please run `bun add ejs`"),new Response("EJS not installed! Please run `bun add ejs`",{status:500})}try{let L=await Bun.file(f).text(),b=C.render(L,v),t=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response(b,{status:this.status,headers:t})}catch(L){return console.error("EJS Rendering Error:",L),new Response("Error rendering template",{status:500})}},redirect(f,v){if(v)this.status=v;else this.status=302;return this.headers.set("Location",f),new Response(null,{status:this.status,headers:this.headers})},stream(f){let v=new Headers(this.headers),A=new ReadableStream({async start(C){await f(C),C.close()}});return new Response(A,{headers:v})},yieldStream(f){return new Response({async*[Symbol.asyncIterator](){yield*f()}},{headers:this.headers})},setCookie(f,v,A={}){let C=`${encodeURIComponent(f)}=${encodeURIComponent(v)}`;if(A.maxAge)C+=`; Max-Age=${A.maxAge}`;if(A.expires)C+=`; Expires=${A.expires.toUTCString()}`;if(A.path)C+=`; Path=${A.path}`;if(A.domain)C+=`; Domain=${A.domain}`;if(A.secure)C+="; Secure";if(A.httpOnly)C+="; HttpOnly";if(A.sameSite)C+=`; SameSite=${A.sameSite}`;return this.headers.append("Set-Cookie",C),this},get cookies(){if(!$){let f=this.req.headers.get("cookie");$=f?p(f):{}}return $}}}function p(n){return Object.fromEntries(n.split(";").map((o)=>{let[r,...g]=o.trim().split("=");return[r,decodeURIComponent(g.join("="))]}))}function d(n,o){let r={},g=n.split("/"),[m]=o.split("?"),$=m.split("/");if(g.length!==$.length)return null;for(let i=0;i<g.length;i++)if(g[i].startsWith(":"))r[g[i].slice(1)]=$[i];return r}async function a(n){let o=n.headers.get("Content-Type");if(!o)return{};if(n.headers.get("Content-Length")==="0"||!n.body)return{};try{if(o.startsWith("application/json"))return await n.json();if(o.startsWith("application/x-www-form-urlencoded")){let g=await n.text();return Object.fromEntries(new URLSearchParams(g))}if(o.startsWith("multipart/form-data")){let g=await n.formData(),m={};for(let[$,i]of g.entries())m[$]=i;return m}return{error:"Unknown request body type"}}catch(g){return{error:"Invalid request body format"}}}async function G(n,o,r,g){let m=D(n,o,r),$=g.trie.search(r.pathname,n.method);n.routePattern=$?.path;try{if(r.pathname.startsWith("/favicon"))return;if(g.hasFilterEnabled){let f=n.routePattern??r.pathname,v=await nn(g,f,m,o);if(v)return v}if(g.hasMiddleware){if(g.globalMiddlewares.length){let v=await M(g.globalMiddlewares,m,o);if(v)return v}let f=g.middlewares.get(r.pathname)||[];if(f?.length){let v=await M(f,m,o);if(v)return v}}if(!$?.handler||$.method!==n.method){if(g.staticPath){let f=await on(g,r.pathname,m);if(f)return f;let v=g.trie.search("*",n.method);if(v?.handler)return await v.handler(m)}if(g.hooks.routeNotFound&&Array.isArray(g.hooks.routeNotFound)&&!$?.handler){let f=g.hooks.routeNotFound;for(let v=0;v<f.length;v++){let A=await f[v](m);if(A)return A}}if(!$||!$?.handler?.length)return R(404,`Route not found for ${r.pathname}`);if($?.method!==n.method)return R(405,"Method not allowed")}if(g.hooks.preHandler?.length&&Array.isArray(g.hooks.preHandler)){let f=g.hooks.preHandler;for(let v=0;v<f.length;v++){let A=await f[v](m);if(A)return A}}let i=$.handler(m);return(i instanceof Promise?await i:i)??R(204,"")}catch(i){if(g.hooks.onError&&Array.isArray(g.hooks.onError)){let u=g.hooks.onError;for(let f=0;f<u.length;f++){let v=g.hooks.onError[f](i,n,r,o);if(v)return v}}return R(500,"Internal Server Error")}finally{if(g.hooks.onSend&&Array.isArray(g.hooks.onSend)){let i=g.hooks.onSend;for(let u=0;u<i.length;u++){let f=await i[u](m);if(f)return f}}}}async function M(n,o,r){for(let g of n){let m=await g(o,r);if(m)return m}return null}async function nn(n,o,r,g){if(!n.filters.has(o))if(n.filterFunction.length)for(let m of n.filterFunction){let $=await m(r,g);if($)return $}else return r.json({error:!0,message:"Protected route, authentication required",status:401},401)}function R(n,o){return new Response(JSON.stringify({error:!0,message:o,status:n}),{status:n,headers:{"Content-Type":"application/json"}})}async function on(n,o,r){if(!n.staticPath)return null;let g=`${n.staticPath}${o}`;if(await Bun.file(g).exists()){let $=z(g);return r.file(g,$,200)}return null}var{create:rn,defineProperty:W,getOwnPropertyDescriptor:fn,getOwnPropertyNames:gn,getPrototypeOf:un}=Object,vn=Object.prototype.hasOwnProperty,mn=(n,o)=>()=>(o||n((o={exports:{}}).exports,o),o.exports),Cn=(n,o,r,g)=>{if(o&&typeof o=="object"||typeof o=="function")for(let m of gn(o))!vn.call(n,m)&&m!==r&&W(n,m,{get:()=>o[m],enumerable:!(g=fn(o,m))||g.enumerable});return n},$n=(n,o,r)=>(r=n!=null?rn(un(n)):{},Cn(o||!n||!n.__esModule?W(r,"default",{value:n,enumerable:!0}):r,n)),An=mn((n,o)=>{function r(i){if(typeof i!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(i))}function g(i,u){for(var f="",v=0,A=-1,C=0,L,b=0;b<=i.length;++b){if(b<i.length)L=i.charCodeAt(b);else{if(L===47)break;L=47}if(L===47){if(!(A===b-1||C===1))if(A!==b-1&&C===2){if(f.length<2||v!==2||f.charCodeAt(f.length-1)!==46||f.charCodeAt(f.length-2)!==46){if(f.length>2){var t=f.lastIndexOf("/");if(t!==f.length-1){t===-1?(f="",v=0):(f=f.slice(0,t),v=f.length-1-f.lastIndexOf("/")),A=b,C=0;continue}}else if(f.length===2||f.length===1){f="",v=0,A=b,C=0;continue}}u&&(f.length>0?f+="/..":f="..",v=2)}else f.length>0?f+="/"+i.slice(A+1,b):f=i.slice(A+1,b),v=b-A-1;A=b,C=0}else L===46&&C!==-1?++C:C=-1}return f}function m(i,u){var f=u.dir||u.root,v=u.base||(u.name||"")+(u.ext||"");return f?f===u.root?f+v:f+i+v:v}var $={resolve:function(){for(var i="",u=!1,f,v=arguments.length-1;v>=-1&&!u;v--){var A;v>=0?A=arguments[v]:(f===void 0&&(f=process.cwd()),A=f),r(A),A.length!==0&&(i=A+"/"+i,u=A.charCodeAt(0)===47)}return i=g(i,!u),u?i.length>0?"/"+i:"/":i.length>0?i:"."},normalize:function(i){if(r(i),i.length===0)return".";var u=i.charCodeAt(0)===47,f=i.charCodeAt(i.length-1)===47;return i=g(i,!u),i.length===0&&!u&&(i="."),i.length>0&&f&&(i+="/"),u?"/"+i:i},isAbsolute:function(i){return r(i),i.length>0&&i.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var i,u=0;u<arguments.length;++u){var f=arguments[u];r(f),f.length>0&&(i===void 0?i=f:i+="/"+f)}return i===void 0?".":$.normalize(i)},relative:function(i,u){if(r(i),r(u),i===u||(i=$.resolve(i),u=$.resolve(u),i===u))return"";for(var f=1;f<i.length&&i.charCodeAt(f)===47;++f);for(var v=i.length,A=v-f,C=1;C<u.length&&u.charCodeAt(C)===47;++C);for(var L=u.length,b=L-C,t=A<b?A:b,y=-1,E=0;E<=t;++E){if(E===t){if(b>t){if(u.charCodeAt(C+E)===47)return u.slice(C+E+1);if(E===0)return u.slice(C+E)}else A>t&&(i.charCodeAt(f+E)===47?y=E:E===0&&(y=0));break}var S=i.charCodeAt(f+E),j=u.charCodeAt(C+E);if(S!==j)break;S===47&&(y=E)}var w="";for(E=f+y+1;E<=v;++E)(E===v||i.charCodeAt(E)===47)&&(w.length===0?w+="..":w+="/..");return w.length>0?w+u.slice(C+y):(C+=y,u.charCodeAt(C)===47&&++C,u.slice(C))},_makeLong:function(i){return i},dirname:function(i){if(r(i),i.length===0)return".";for(var u=i.charCodeAt(0),f=u===47,v=-1,A=!0,C=i.length-1;C>=1;--C)if(u=i.charCodeAt(C),u===47){if(!A){v=C;break}}else A=!1;return v===-1?f?"/":".":f&&v===1?"//":i.slice(0,v)},basename:function(i,u){if(u!==void 0&&typeof u!="string")throw new TypeError('"ext" argument must be a string');r(i);var f=0,v=-1,A=!0,C;if(u!==void 0&&u.length>0&&u.length<=i.length){if(u.length===i.length&&u===i)return"";var L=u.length-1,b=-1;for(C=i.length-1;C>=0;--C){var t=i.charCodeAt(C);if(t===47){if(!A){f=C+1;break}}else b===-1&&(A=!1,b=C+1),L>=0&&(t===u.charCodeAt(L)?--L===-1&&(v=C):(L=-1,v=b))}return f===v?v=b:v===-1&&(v=i.length),i.slice(f,v)}else{for(C=i.length-1;C>=0;--C)if(i.charCodeAt(C)===47){if(!A){f=C+1;break}}else v===-1&&(A=!1,v=C+1);return v===-1?"":i.slice(f,v)}},extname:function(i){r(i);for(var u=-1,f=0,v=-1,A=!0,C=0,L=i.length-1;L>=0;--L){var b=i.charCodeAt(L);if(b===47){if(!A){f=L+1;break}continue}v===-1&&(A=!1,v=L+1),b===46?u===-1?u=L:C!==1&&(C=1):u!==-1&&(C=-1)}return u===-1||v===-1||C===0||C===1&&u===v-1&&u===f+1?"":i.slice(u,v)},format:function(i){if(i===null||typeof i!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof i);return m("/",i)},parse:function(i){r(i);var u={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return u;var f=i.charCodeAt(0),v=f===47,A;v?(u.root="/",A=1):A=0;for(var C=-1,L=0,b=-1,t=!0,y=i.length-1,E=0;y>=A;--y){if(f=i.charCodeAt(y),f===47){if(!t){L=y+1;break}continue}b===-1&&(t=!1,b=y+1),f===46?C===-1?C=y:E!==1&&(E=1):C!==-1&&(E=-1)}return C===-1||b===-1||E===0||E===1&&C===b-1&&C===L+1?b!==-1&&(L===0&&v?u.base=u.name=i.slice(1,b):u.base=u.name=i.slice(L,b)):(L===0&&v?(u.name=i.slice(1,C),u.base=i.slice(1,b)):(u.name=i.slice(L,C),u.base=i.slice(L,b)),u.ext=i.slice(C,b)),L>0?u.dir=i.slice(0,L-1):v&&(u.dir="/"),u},sep:"/",delimiter:":",win32:null,posix:null};$.posix=$,o.exports=$}),B=$n(An()),c=B,bn=B,U=function(n){return n},J=function(){throw new Error("Not implemented")};c.parse??=J;bn.parse??=J;var F={resolve:c.resolve.bind(c),normalize:c.normalize.bind(c),isAbsolute:c.isAbsolute.bind(c),join:c.join.bind(c),relative:c.relative.bind(c),toNamespacedPath:U,dirname:c.dirname.bind(c),basename:c.basename.bind(c),extname:c.extname.bind(c),format:c.format.bind(c),parse:c.parse.bind(c),sep:"/",delimiter:":",win32:void 0,posix:void 0,_makeLong:U},V={sep:"\\",delimiter:";",win32:void 0,...F,posix:F};F.win32=V.win32=V;F.posix=F;var N=F;var{default:K}=(()=>({}));var s={reset:"\x1B[0m",info:"\x1B[34m",warn:"\x1B[33m",error:"\x1B[31m",method:{GET:"\x1B[32m",POST:"\x1B[36m",PUT:"\x1B[35m",DELETE:"\x1B[31m"}},I=(n,o,r)=>{let g=s[n]||s.reset,m=r?.method?s.method[r.method]||s.reset:s.reset,$=r?.status?r.status>=500?s.error:r.status>=400?s.warn:s.info:s.reset;console.log(`
${g}[${n.toUpperCase()}]${s.reset} ${o} - ${m}${r?.method||""}${s.reset}`);let i={timestamp:new Date().toISOString(),...r,status:r?.status?`${$}${r.status}${s.reset}`:void 0,method:r?.method?`${m}${r.method}${s.reset}`:void 0};console.log(JSON.stringify(i,null,2)+`
`)},Q=(n)=>{n.addHooks("onRequest",async(o,r)=>{o.startTime=Date.now(),I("info","Incoming Request",{method:o.method,url:r.toString(),headers:{"user-agent":o.headers.get("user-agent"),"content-type":o.headers.get("Content-Type")}})}),n.addHooks("onSend",(o)=>{let r=`${Date.now()-o.req.startTime}ms`;I("info","Response Sent",{method:o.req.method,url:o.url,status:o.status,duration:r,headers:{"content-type":o.headers.get("Content-Type")}})})},O=(n,o,r,g=0,m)=>{let $=s.method[o]||s.reset,i=g>=500?s.error:g>=400?s.warn:s.info,u=n==="<--"?`${n} ${$}${o}${s.reset} ${r}`:`${n} ${$}${o}${s.reset} ${r} ${i}${g}${s.reset} ${m||""}`;console.log(u)},Ln=(n)=>{let o=Date.now()-n;return o<1000?`${o}ms`:`${Math.round(o/1000)}s`},_=(n)=>{n.addHooks("onRequest",(o,r)=>{o.startTime=Date.now(),O("<--",o.method,new URL(r).pathname)}),n.addHooks("onSend",async(o)=>{let{method:r,url:g}=o.req,m=new URL(g).pathname;O("-->",r,m,o.status,Ln(o.req.startTime))}),n.addHooks("routeNotFound",(o)=>{O("[routeNotFound]",o.req.method,o.url.pathname,404)}),n.addHooks("onError",(o,r,g)=>{O(o?.message,r.method,g.toString(),500)})};class H{tempRoutes;globalMiddlewares;middlewares;trie;hasOnReqHook;hasMiddleware;hasPreHandlerHook;hasPostHandlerHook;hasOnSendHook;hasOnError;hooks;corsConfig;FilterRoutes;filters;filterFunction;hasFilterEnabled;serverInstance;staticPath;staticFiles;user_jwt_secret;baseApiUrl;enableFileRouter;idleTimeOut;constructor({jwtSecret:n,baseApiUrl:o,enableFileRouting:r,idleTimeOut:g}={}){this.idleTimeOut=g??10,this.enableFileRouter=r??!1,this.baseApiUrl=o||"",this.user_jwt_secret=n||process.env.DIESEL_JWT_SECRET||"feault_diesel_secret_for_jwt",this.tempRoutes=new Map,this.globalMiddlewares=[],this.middlewares=new Map,this.trie=new T,this.corsConfig=null,this.hasMiddleware=!1,this.hasOnReqHook=!1,this.hasPreHandlerHook=!1,this.hasPostHandlerHook=!1,this.hasOnSendHook=!1,this.hasOnError=!1,this.hooks={onRequest:[],preHandler:[],postHandler:[],onSend:[],onError:[],onClose:[],routeNotFound:[]},this.FilterRoutes=[],this.filters=new Set,this.filterFunction=[],this.hasFilterEnabled=!1,this.serverInstance=null,this.staticPath=null,this.staticFiles={}}setupFilter(){return this.hasFilterEnabled=!0,{routeMatcher:(...n)=>{return this.FilterRoutes=n,this.setupFilter()},permitAll:()=>{for(let n of this?.FilterRoutes)this.filters.add(n);return this.FilterRoutes=null,this.setupFilter()},authenticate:(n)=>{if(n?.length)for(let o of n)this.filterFunction.push(o)},authenticateJwt:(n)=>{this.filterFunction.push(Y(n,this.user_jwt_secret))},authenticateJwtDB:(n,o)=>{this.filterFunction.push(Z(n,o,this.user_jwt_secret))}}}redirect(n,o,r){return this.any(n,(g)=>{let m=g.params,$=o;if(m)for(let u in m)$=$.replace(`:${u}`,m[u]);let i=g.url.search;if(i)$+=i;return g.redirect($,r)}),this}serveStatic(n){return this.staticPath=n,this}static(n){return this.staticFiles={...this.staticFiles,...n},this}addHooks(n,o){if(typeof n!=="string")throw new Error("hookName must be a string");if(typeof o!=="function")throw new Error("callback must be a instance of function");switch(n){case"onRequest":this.hooks.onRequest?.push(o);break;case"preHandler":this.hooks.preHandler?.push(o);break;case"postHandler":this.hooks.postHandler?.push(o);break;case"onSend":this.hooks.onSend?.push(o);break;case"onError":this.hooks.onError?.push(o);break;case"onClose":this.hooks.onClose?.push(o);break;case"routeNotFound":this.hooks.routeNotFound?.push(o);break;default:throw new Error(`Unknown hook type: ${n}`)}return this}compile(){if(this.globalMiddlewares.length>0)this.hasMiddleware=!0;for(let[n,o]of this.middlewares.entries())if(o.length>0){this.hasMiddleware=!0;break}if(this.enableFileRouter){let n=process.cwd(),o=N.join(n,"src","routes");if(K?.existsSync(o))this.loadRoutes(o,"")}setTimeout(()=>{this.tempRoutes=null},2000)}async registerFileRoutes(n,o,r){let g=await import(n),m;if(r===".ts")m=N.basename(n,".ts");else if(r===".js")m=N.basename(n,".js");let $=o+"/"+m;if($.endsWith("/index"))$=o;else if($.endsWith("/api"))$=o;$=$.replace(/\[(.*?)\]/g,":$1");let i=["GET","POST","PUT","PATCH","DELETE","ANY","HEAD","OPTIONS","PROPFIND"];for(let u of i)if(g[u]){let f=u.toLowerCase(),v=g[u];this[f](`${this.baseApiUrl}${$}`,v)}}async loadRoutes(n,o){let r=await K.promises.readdir(n);for(let g of r){let m=N.join(n,g);if((await K.promises.stat(m)).isDirectory())this.loadRoutes(m,o+"/"+g);else if(g.endsWith(".ts"))this.registerFileRoutes(m,o,".ts");else if(g.endsWith(".js"))this.registerFileRoutes(m,o,".js")}}useLogger(n){return _(n),this}useAdvancedLogger(n){return Q(n),this}listen(n,...o){if(typeof Bun==="undefined")throw new Error(".listen() is designed to run on Bun only...");let r="0.0.0.0",g=void 0,m={};for(let i of o)if(typeof i==="string")r=i;else if(typeof i==="function")g=i;else if(typeof i==="object"&&i!==null)m=i;this.compile();let $={port:n,hostname:r,idleTimeOut:this.idleTimeOut,fetch:async(i,u)=>{let f=new URL(i.url);if(this.hooks.onRequest){let v=this.hooks.onRequest;for(let A=0;A<v.length;A++)await v[A](i,f,u)}return G(i,u,f,this)},static:this.staticFiles};if(m.sslCert&&m.sslKey)$.certFile=m.sslCert,$.keyFile=m.sslKey;if(this.serverInstance=Bun?.serve($),m.sslCert&&m.sslKey)console.log(`HTTPS server is running on https://localhost:${n}`);if(g)return g();return this.serverInstance}close(n){if(this.serverInstance)this.serverInstance.stop(!0),this.serverInstance=null,n?n():console.log("Server has been stopped");else console.warn("Server is not running.")}route(n,o){if(!n||typeof n!=="string")throw new Error("Path must be a string");let r=Object.fromEntries(o.tempRoutes);return Object.entries(r).forEach(([m,$])=>{let i=m.replace(/::\w+$/,""),u=`${n}${i}`;if(!this.middlewares.has(u))this.middlewares.set(u,[]);$.handlers.slice(0,-1).forEach((C)=>{if(!this.middlewares.get(u)?.includes(C))this.middlewares.get(u)?.push(C)});let v=$.handlers[$.handlers.length-1],A=$.method;try{this.trie.insert(u,{handler:v,method:A})}catch(C){console.error(`Error inserting ${u}:`,C)}}),o=null,this}register(n,o){return this.route(n,o)}addRoute(n,o,r){if(typeof o!=="string")throw new Error(`Error in ${r[r.length-1]}: Path must be a string. Received: ${typeof o}`);if(typeof n!=="string")throw new Error(`Error in addRoute: Method must be a string. Received: ${typeof n}`);this.tempRoutes?.set(o+"::"+n,{method:n,handlers:r});let g=r.slice(0,-1),m=r[r.length-1];if(!this.middlewares.has(o))this.middlewares.set(o,[]);g.forEach(($)=>{if(o==="/")this.globalMiddlewares=[...new Set([...this.globalMiddlewares,...g])];else if(!this.middlewares.get(o)?.includes($))this.middlewares.get(o)?.push($)});try{if(n==="ANY"){let $=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD","PROPFIND"];for(let i of $)this.trie.insert(o,{handler:m,method:i})}this.trie.insert(o,{handler:m,method:n})}catch($){console.error(`Error inserting ${o}:`,$)}}use(n,o){if(Array.isArray(n))n.forEach((g)=>{if(typeof g==="function")this.globalMiddlewares.push(g)});if(typeof n==="function"){if(this.globalMiddlewares.push(n),Array.isArray(o))o.forEach((g)=>{this.globalMiddlewares.push(g)});return}return(Array.isArray(n)?n.filter((g)=>typeof g==="string"):[n].filter((g)=>typeof g==="string")).forEach((g)=>{if(!this.middlewares.has(g))this.middlewares.set(g,[]);if(o)(Array.isArray(o)?o:[o]).forEach(($)=>{this.middlewares.get(g)?.push($)})}),this}get(n,...o){return this.addRoute("GET",n,o),this}post(n,...o){return this.addRoute("POST",n,o),this}put(n,...o){return this.addRoute("PUT",n,o),this}patch(n,...o){return this.addRoute("PATCH",n,o),this}delete(n,...o){return this.addRoute("DELETE",n,o),this}any(n,...o){return this.addRoute("ANY",n,o),this}head(n,...o){return this.addRoute("HEAD",n,o),this}options(n,...o){return this.addRoute("OPTIONS",n,o),this}propfind(n,...o){return this.addRoute("PROPFIND",n,o),this}}export{H as default};
