var o=Object.create;var{getPrototypeOf:r,defineProperty:y,getOwnPropertyNames:p}=Object;var h=Object.prototype.hasOwnProperty;var s=(f,i,A)=>{A=f!=null?o(r(f)):{};let n=i||!f||!f.__esModule?y(A,"default",{value:f,enumerable:!0}):A;for(let N of p(f))if(!h.call(n,N))y(n,N,{get:()=>f[N],enumerable:!0});return n};var d=((f)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(f,{get:(i,A)=>(typeof require!=="undefined"?require:i)[A]}):f)(function(f){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+f+'" is not supported')});class M{children;isEndOfWord;handler;isDynamic;pattern;path;method;constructor(){this.children={},this.isEndOfWord=!1,this.handler=[],this.isDynamic=!1,this.pattern="",this.path="",this.method=[]}}class B{root;constructor(){this.root=new M}insert(f,i){let A=this.root,n=f.split("/").filter(Boolean);if(f==="/"){A.isEndOfWord=!0,A.handler.push(i.handler),A.path=f,A.method.push(i.method);return}for(let N of n){let z=!1,v=N;if(N.startsWith(":"))z=!0,v=":";if(!A.children[v])A.children[v]=new M;A=A.children[v],A.isDynamic=z,A.pattern=N}A.isEndOfWord=!0,A.path=f,A.method.push(i.method),A.handler.push(i.handler)}search(f,i){let A=this.root,n=f.split("/").filter(Boolean),N=n.length;for(let b of n){let C=b;if(!A.children[C])if(A.children[":"])A=A.children[":"];else return null;else A=A.children[C]}let z=A.path.split("/").filter(Boolean);if(N!==z.length)return null;let v=A.method.indexOf(i);if(v!==-1)return{path:A.path,handler:A.handler[v],isDynamic:A.isDynamic,pattern:A.pattern,method:A.method[v]};return{path:A.path,handler:A.handler,isDynamic:A.isDynamic,pattern:A.pattern,method:A.method[v]}}}function t(f){let{time:i=60000,max:A=100,message:n="Rate limit exceeded. Please try again later."}=f,N=new Map;return(z)=>{let v=new Date,b=z.ip;if(!N.has(b))N.set(b,{count:0,startTime:v});let C=N.get(b);if(C)if(v-C.startTime>i)C.count=1,C.startTime=v;else C.count++;if(C&&C.count>A)return z.json({error:n},429)}}function Q(f){switch(f.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}function H(f,i){if(!f)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");return(A)=>{try{let n=A.cookies?.accessToken||A.req?.headers?.get("Authorization");if(!n)return A.json({message:"Unauthorized: No token provided"},401);if(n.startsWith("Bearer "))n=n.slice(7);let N=f?.verify(n,i);if(!N)return A.json({message:"Unauthorized: Invalid token"},401);A.set("user",N);return}catch(n){return A.json({message:"Unauthorized: Invalid token",error:n?.message},401)}}}function I(f,i,A){if(!f)throw new Error("JWT library is not defined, please provide jwt to authenticateJwtDB Function");if(!i)throw new Error("User model is not defined, please provide UserModel to authenticateJwtDB Function");return async(n)=>{try{let N=n.cookies?.accessToken||n.req?.headers?.get("Authorization");if(!N)return n.json({message:"Unauthorized: No token provided"},401);if(N.startsWith("Bearer "))N=N.slice(7);let z=f?.verify(N,A);if(!z)return n.json({message:"Unauthorized: Invalid token"},401);let v=await i.findById(z._id).select("-password -refreshToken");if(!v)return n.json({message:"Unauthorized: User not found"},401);n.set("user",v);return}catch(N){return n.json({message:"Unauthorized: Authentication failed",error:N?.message},401)}}}function _(f,i,A){let n=new Headers({"Cache-Control":"no-cache"}),N=null,z=null,v=null,b=null,C={};return{req:f,server:i,url:A,status:200,setHeader(E,F){return n.set(E,F),this},removeHeader(E){return n.delete(E),this},get ip(){return this.server.requestIP(this.req)?.address??null},get query(){if(!N)try{N=Object.fromEntries(this.url.searchParams)}catch(E){throw new Error("Failed to parse query parameters")}return N},get params(){if(!z&&this.req.routePattern)try{z=e(this.req.routePattern,this.url.pathname)}catch(E){throw new Error("Failed to extract route parameters")}return z??{}},get body(){if(this.req.method==="GET")return Promise.resolve({});if(!b)b=(async()=>{let E=await f1(this.req);if(E.error)throw new Error(E.error);return Object.keys(E).length===0?null:E})();return b},set(E,F){return C[E]=F,this},get(E){return C[E]},text(E,F){if(F)this.status=F;if(!n.has("Content-Type"))n.set("Content-Type","text/plain; charset=utf-8");return new Response(E,{status:this.status,headers:n})},send(E,F){if(F)this.status=F;let g=new Map([["string","text/plain; charset=utf-8"],["object","application/json; charset=utf-8"],["Uint8Array","application/octet-stream"],["ArrayBuffer","application/octet-stream"]]),$=E instanceof Uint8Array?"Uint8Array":E instanceof ArrayBuffer?"ArrayBuffer":typeof E;if(!n.has("Content-Type"))n.set("Content-Type",g.get($)??"text/plain; charset=utf-8");let G=$==="object"&&E!==null?JSON.stringify(E):E;return new Response(G,{status:this.status,headers:n})},json(E,F){if(F)this.status=F;if(!n.has("Content-Type"))n.set("Content-Type","application/json; charset=utf-8");return new Response(JSON.stringify(E),{status:this.status,headers:n})},file(E,F,g){if(g)this.status=g;let $=Bun.file(E);if(!n.has("Content-Type"))n.set("Content-Type",F??Q(E));return new Response($,{status:this.status,headers:n})},async ejs(E,F={},g){if(g)this.status=g;let $;try{$=await import("ejs"),$=$.default||$}catch(G){return console.error("EJS not installed! Please run `bun add ejs`"),new Response("EJS not installed! Please run `bun add ejs`",{status:500})}try{let G=await Bun.file(E).text(),Y=$.render(G,F),Z=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response(Y,{status:this.status,headers:Z})}catch(G){return console.error("EJS Rendering Error:",G),new Response("Error rendering template",{status:500})}},redirect(E,F){if(F)this.status=F;else this.status=302;return n.set("Location",E),new Response(null,{status:this.status,headers:n})},setCookie(E,F,g={}){let $=`${encodeURIComponent(E)}=${encodeURIComponent(F)}`;if(g.maxAge)$+=`; Max-Age=${g.maxAge}`;if(g.expires)$+=`; Expires=${g.expires.toUTCString()}`;if(g.path)$+=`; Path=${g.path}`;if(g.domain)$+=`; Domain=${g.domain}`;if(g.secure)$+="; Secure";if(g.httpOnly)$+="; HttpOnly";if(g.sameSite)$+=`; SameSite=${g.sameSite}`;return n.append("Set-Cookie",$),this},get cookies(){if(!v){let E=this.req.headers.get("cookie");v=E?a(E):{}}return v}}}function a(f){return Object.fromEntries(f.split(";").map((i)=>{let[A,...n]=i.trim().split("=");return[A,decodeURIComponent(n.join("="))]}))}function e(f,i){let A={},n=f.split("/"),[N]=i.split("?"),z=N.split("/");if(n.length!==z.length)return null;for(let v=0;v<n.length;v++)if(n[v].startsWith(":"))A[n[v].slice(1)]=z[v];return A}async function f1(f){let i=f.headers.get("Content-Type");if(!i)return{};if(f.headers.get("Content-Length")==="0"||!f.body)return{};try{if(i.startsWith("application/json"))return await f.json();if(i.startsWith("application/x-www-form-urlencoded")){let n=await f.text();return Object.fromEntries(new URLSearchParams(n))}if(i.startsWith("multipart/form-data")){let n=await f.formData(),N={};for(let[z,v]of n.entries())N[z]=v;return N}return{error:"Unknown request body type"}}catch(n){return{error:"Invalid request body format"}}}async function T(f,i,A,n){let N=_(f,i,A),z=n.trie.search(A.pathname,f.method);f.routePattern=z?.path;try{if(n.hasFilterEnabled){let C=f.routePattern??A.pathname,E=await i1(n,C,N,i);if(E)return E}if(n.hasMiddleware){if(n.globalMiddlewares.length){let E=await O(n.globalMiddlewares,N,i);if(E)return E}let C=n.middlewares.get(A.pathname)||[];if(C?.length){let E=await O(C,N,i);if(E)return E}}if(!z?.handler||z.method!==f.method){if(n.staticPath){let C=await v1(n,A.pathname,N);if(C)return C;let E=n.trie.search("*",f.method);if(E?.handler)return await E.handler(N)}if(n.hooks.routeNotFound&&!z?.handler){let C=await n.hooks.routeNotFound(N);if(C)return C}if(!z||!z?.handler?.length)return D(404,`Route not found for ${A.pathname}`);if(z?.method!==f.method)return D(405,"Method not allowed")}if(n.hooks.preHandler){let C=await n.hooks.preHandler(N);if(C)return C}let v=z.handler(N),b=v instanceof Promise?await v:v;if(n.hooks.onSend){let C=await n.hooks.onSend(N,b);if(C)return C}return b??D(204,"No response from this handler")}catch(v){return n.hooks.onError?n.hooks.onError(v,f,A,i):D(500,"Internal Server Error")}finally{if(n.hooks.postHandler)n.hooks.postHandler(N)}}async function O(f,i,A){for(let n of f){console.log("middlewares: ",n);let N=await n(i,A);if(N)return N}return null}async function i1(f,i,A,n){if(!f.filters.has(i))if(f.filterFunction.length)for(let N of f.filterFunction){let z=await N(A,n);if(z)return z}else return A.json({error:!0,message:"Protected route, authentication required",status:401},401)}function D(f,i){return new Response(JSON.stringify({error:!0,message:i,status:f}),{status:f,headers:{"Content-Type":"application/json"}})}async function v1(f,i,A){if(!f.staticPath)return null;let n=`${f.staticPath}${i}`;if(await Bun.file(n).exists()){let z=Q(n);return A.file(n,z,200)}return null}var{create:n1,defineProperty:m,getOwnPropertyDescriptor:A1,getOwnPropertyNames:b1,getPrototypeOf:C1}=Object,E1=Object.prototype.hasOwnProperty,N1=(f,i)=>()=>(i||f((i={exports:{}}).exports,i),i.exports),g1=(f,i,A,n)=>{if(i&&typeof i=="object"||typeof i=="function")for(let N of b1(i))!E1.call(f,N)&&N!==A&&m(f,N,{get:()=>i[N],enumerable:!(n=A1(i,N))||n.enumerable});return f},z1=(f,i,A)=>(A=f!=null?n1(C1(f)):{},g1(i||!f||!f.__esModule?m(A,"default",{value:f,enumerable:!0}):A,f)),F1=N1((f,i)=>{function A(v){if(typeof v!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(v))}function n(v,b){for(var C="",E=0,F=-1,g=0,$,G=0;G<=v.length;++G){if(G<v.length)$=v.charCodeAt(G);else{if($===47)break;$=47}if($===47){if(!(F===G-1||g===1))if(F!==G-1&&g===2){if(C.length<2||E!==2||C.charCodeAt(C.length-1)!==46||C.charCodeAt(C.length-2)!==46){if(C.length>2){var Y=C.lastIndexOf("/");if(Y!==C.length-1){Y===-1?(C="",E=0):(C=C.slice(0,Y),E=C.length-1-C.lastIndexOf("/")),F=G,g=0;continue}}else if(C.length===2||C.length===1){C="",E=0,F=G,g=0;continue}}b&&(C.length>0?C+="/..":C="..",E=2)}else C.length>0?C+="/"+v.slice(F+1,G):C=v.slice(F+1,G),E=G-F-1;F=G,g=0}else $===46&&g!==-1?++g:g=-1}return C}function N(v,b){var C=b.dir||b.root,E=b.base||(b.name||"")+(b.ext||"");return C?C===b.root?C+E:C+v+E:E}var z={resolve:function(){for(var v="",b=!1,C,E=arguments.length-1;E>=-1&&!b;E--){var F;E>=0?F=arguments[E]:(C===void 0&&(C=process.cwd()),F=C),A(F),F.length!==0&&(v=F+"/"+v,b=F.charCodeAt(0)===47)}return v=n(v,!b),b?v.length>0?"/"+v:"/":v.length>0?v:"."},normalize:function(v){if(A(v),v.length===0)return".";var b=v.charCodeAt(0)===47,C=v.charCodeAt(v.length-1)===47;return v=n(v,!b),v.length===0&&!b&&(v="."),v.length>0&&C&&(v+="/"),b?"/"+v:v},isAbsolute:function(v){return A(v),v.length>0&&v.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var v,b=0;b<arguments.length;++b){var C=arguments[b];A(C),C.length>0&&(v===void 0?v=C:v+="/"+C)}return v===void 0?".":z.normalize(v)},relative:function(v,b){if(A(v),A(b),v===b||(v=z.resolve(v),b=z.resolve(b),v===b))return"";for(var C=1;C<v.length&&v.charCodeAt(C)===47;++C);for(var E=v.length,F=E-C,g=1;g<b.length&&b.charCodeAt(g)===47;++g);for(var $=b.length,G=$-g,Y=F<G?F:G,Z=-1,K=0;K<=Y;++K){if(K===Y){if(G>Y){if(b.charCodeAt(g+K)===47)return b.slice(g+K+1);if(K===0)return b.slice(g+K)}else F>Y&&(v.charCodeAt(C+K)===47?Z=K:K===0&&(Z=0));break}var j=v.charCodeAt(C+K),l=b.charCodeAt(g+K);if(j!==l)break;j===47&&(Z=K)}var w="";for(K=C+Z+1;K<=E;++K)(K===E||v.charCodeAt(K)===47)&&(w.length===0?w+="..":w+="/..");return w.length>0?w+b.slice(g+Z):(g+=Z,b.charCodeAt(g)===47&&++g,b.slice(g))},_makeLong:function(v){return v},dirname:function(v){if(A(v),v.length===0)return".";for(var b=v.charCodeAt(0),C=b===47,E=-1,F=!0,g=v.length-1;g>=1;--g)if(b=v.charCodeAt(g),b===47){if(!F){E=g;break}}else F=!1;return E===-1?C?"/":".":C&&E===1?"//":v.slice(0,E)},basename:function(v,b){if(b!==void 0&&typeof b!="string")throw new TypeError('"ext" argument must be a string');A(v);var C=0,E=-1,F=!0,g;if(b!==void 0&&b.length>0&&b.length<=v.length){if(b.length===v.length&&b===v)return"";var $=b.length-1,G=-1;for(g=v.length-1;g>=0;--g){var Y=v.charCodeAt(g);if(Y===47){if(!F){C=g+1;break}}else G===-1&&(F=!1,G=g+1),$>=0&&(Y===b.charCodeAt($)?--$===-1&&(E=g):($=-1,E=G))}return C===E?E=G:E===-1&&(E=v.length),v.slice(C,E)}else{for(g=v.length-1;g>=0;--g)if(v.charCodeAt(g)===47){if(!F){C=g+1;break}}else E===-1&&(F=!1,E=g+1);return E===-1?"":v.slice(C,E)}},extname:function(v){A(v);for(var b=-1,C=0,E=-1,F=!0,g=0,$=v.length-1;$>=0;--$){var G=v.charCodeAt($);if(G===47){if(!F){C=$+1;break}continue}E===-1&&(F=!1,E=$+1),G===46?b===-1?b=$:g!==1&&(g=1):b!==-1&&(g=-1)}return b===-1||E===-1||g===0||g===1&&b===E-1&&b===C+1?"":v.slice(b,E)},format:function(v){if(v===null||typeof v!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof v);return N("/",v)},parse:function(v){A(v);var b={root:"",dir:"",base:"",ext:"",name:""};if(v.length===0)return b;var C=v.charCodeAt(0),E=C===47,F;E?(b.root="/",F=1):F=0;for(var g=-1,$=0,G=-1,Y=!0,Z=v.length-1,K=0;Z>=F;--Z){if(C=v.charCodeAt(Z),C===47){if(!Y){$=Z+1;break}continue}G===-1&&(Y=!1,G=Z+1),C===46?g===-1?g=Z:K!==1&&(K=1):g!==-1&&(K=-1)}return g===-1||G===-1||K===0||K===1&&g===G-1&&g===$+1?G!==-1&&($===0&&E?b.base=b.name=v.slice(1,G):b.base=b.name=v.slice($,G)):($===0&&E?(b.name=v.slice(1,g),b.base=v.slice(1,G)):(b.name=v.slice($,g),b.base=v.slice($,G)),b.ext=v.slice(g,G)),$>0?b.dir=v.slice(0,$-1):E&&(b.dir="/"),b},sep:"/",delimiter:":",win32:null,posix:null};z.posix=z,i.exports=z}),u=z1(F1()),X=u,$1=u,S=function(f){return f},c=function(){throw new Error("Not implemented")};X.parse??=c;$1.parse??=c;var W={resolve:X.resolve.bind(X),normalize:X.normalize.bind(X),isAbsolute:X.isAbsolute.bind(X),join:X.join.bind(X),relative:X.relative.bind(X),toNamespacedPath:S,dirname:X.dirname.bind(X),basename:X.basename.bind(X),extname:X.extname.bind(X),format:X.format.bind(X),parse:X.parse.bind(X),sep:"/",delimiter:":",win32:void 0,posix:void 0,_makeLong:S},R={sep:"\\",delimiter:";",win32:void 0,...W,posix:W};W.win32=R.win32=R;W.posix=W;var J=W;var{default:L}=(()=>({}));var V={reset:"\x1B[0m",info:"\x1B[34m",warn:"\x1B[33m",error:"\x1B[31m",method:{GET:"\x1B[32m",POST:"\x1B[36m",PUT:"\x1B[35m",DELETE:"\x1B[31m"}},U=(f,i,A)=>{let n=V[f]||V.reset,N=A?.method?V.method[A.method]||V.reset:V.reset;console.log(`
${n}[${f.toUpperCase()}]${V.reset} ${i} - ${N}${A?.method||""}${V.reset}`),console.log(JSON.stringify({timestamp:new Date().toISOString(),...A},null,2)+`
`)},k=(f)=>{f.addHooks("onRequest",async(i,A)=>{i.startTime=Date.now(),U("info","Incoming Request",{method:i.method,url:A.toString(),headers:{"user-agent":i.headers.get("user-agent"),"content-type":i.headers.get("content-type")}})}),f.addHooks("postHandler",(i)=>{let A=`${Date.now()-i.req.startTime}ms`;U("info","Response Sent",{method:i.req.method,url:i.url,status:i.status,duration:A})})},x=(f,i,A,n=0,N)=>{let z=f==="<--"?`${f} ${i} ${A}`:`${f} ${i} ${A} ${n} ${N||""}`;console.log(z)},G1=(f)=>{let i=Date.now()-f;return i<1000?`${i}ms`:`${Math.round(i/1000)}s`},P=(f)=>{f.addHooks("onRequest",(i,A)=>{i.startTime=Date.now(),x("<--",i.method,new URL(A).pathname)}),f.addHooks("postHandler",async(i)=>{let{method:A,url:n}=i.req,N=new URL(n).pathname;x("-->",A,N,i.status,G1(i.req.startTime))}),f.addHooks("onError",(i,A,n)=>{U("error","Error occurred",{method:A.method,url:n.toString()})})};class q{tempRoutes;globalMiddlewares;middlewares;trie;hasOnReqHook;hasMiddleware;hasPreHandlerHook;hasPostHandlerHook;hasOnSendHook;hasOnError;hooks;corsConfig;FilterRoutes;filters;filterFunction;hasFilterEnabled;serverInstance;staticPath;staticFiles;user_jwt_secret;baseApiUrl;enableFileRouter;constructor({jwtSecret:f,baseApiUrl:i,enableFileRouting:A}={}){this.enableFileRouter=A??!1,this.baseApiUrl=i||"",this.user_jwt_secret=f||process.env.DIESEL_JWT_SECRET||"feault_diesel_secret_for_jwt",this.tempRoutes=new Map,this.globalMiddlewares=[],this.middlewares=new Map,this.trie=new B,this.corsConfig=null,this.hasMiddleware=!1,this.hasOnReqHook=!1,this.hasPreHandlerHook=!1,this.hasPostHandlerHook=!1,this.hasOnSendHook=!1,this.hasOnError=!1,this.hooks={onRequest:null,preHandler:null,postHandler:null,onSend:null,onError:null,onClose:null,routeNotFound:null},this.FilterRoutes=[],this.filters=new Set,this.filterFunction=[],this.hasFilterEnabled=!1,this.serverInstance=null,this.staticPath=null,this.staticFiles={}}setupFilter(){return this.hasFilterEnabled=!0,{routeMatcher:(...f)=>{return this.FilterRoutes=f,this.setupFilter()},permitAll:()=>{for(let f of this?.FilterRoutes)this.filters.add(f);return this.FilterRoutes=null,this.setupFilter()},authenticate:(f)=>{if(f?.length)for(let i of f)this.filterFunction.push(i)},authenticateJwt:(f)=>{this.filterFunction.push(H(f,this.user_jwt_secret))},authenticateJwtDB:(f,i)=>{this.filterFunction.push(I(f,i,this.user_jwt_secret))}}}redirect(f,i,A){return this.any(f,(n)=>{let N=n.params,z=i;if(N)for(let b in N)z=z.replace(`:${b}`,N[b]);let v=n.url.search;if(v)z+=v;return n.redirect(z,A)}),this}serveStatic(f){return this.staticPath=f,this}static(f){return this.staticFiles={...this.staticFiles,...f},this}addHooks(f,i){if(typeof f!=="string")throw new Error("hookName must be a string");if(typeof i!=="function")throw new Error("callback must be a instance of function");switch(f){case"onRequest":this.hooks.onRequest=i;break;case"preHandler":this.hooks.preHandler=i;break;case"postHandler":this.hooks.postHandler=i;break;case"onSend":this.hooks.onSend=i;break;case"onError":this.hooks.onError=i;break;case"onClose":this.hooks.onClose=i;break;case"routeNotFound":this.hooks.routeNotFound=i;break;default:throw new Error(`Unknown hook type: ${f}`)}return this}compile(){if(this.globalMiddlewares.length>0)this.hasMiddleware=!0;for(let[f,i]of this.middlewares.entries())if(i.length>0){this.hasMiddleware=!0;break}if(this.enableFileRouter){let f=process.cwd(),i=J.join(f,"src","routes");if(L?.existsSync(i))this.loadRoutes(i,"")}setTimeout(()=>{this.tempRoutes=null},2000)}async registerFileRoutes(f,i,A){let n=await import(f),N;if(A===".ts")N=J.basename(f,".ts");else if(A===".js")N=J.basename(f,".js");let z=i+"/"+N;if(z.endsWith("/index"))z=i;else if(z.endsWith("/api"))z=i;z=z.replace(/\[(.*?)\]/g,":$1");let v=["GET","POST","PUT","PATCH","DELETE","ANY","HEAD","OPTIONS","PROPFIND"];for(let b of v)if(n[b]){let C=b,E=n[b];this[C.toLocaleLowerCase()](`${this.baseApiUrl}${z}`,E)}}async loadRoutes(f,i){let A=await L.promises.readdir(f);for(let n of A){let N=J.join(f,n);if((await L.promises.stat(N)).isDirectory())this.loadRoutes(N,i+"/"+n);else if(n.endsWith(".ts"))this.registerFileRoutes(N,i,".ts");else if(n.endsWith(".js"))this.registerFileRoutes(N,i,".js")}}useLogger(f){return P(f),this}useAdvancedLogger(f){return k(f),this}listen(f,...i){if(typeof Bun==="undefined")throw new Error(".listen() is designed to run on Bun only...");let A="0.0.0.0",n=void 0,N={};for(let v of i)if(typeof v==="string")A=v;else if(typeof v==="function")n=v;else if(typeof v==="object"&&v!==null)N=v;this.compile();let z={port:f,hostname:A,fetch:async(v,b)=>{let C=new URL(v.url);if(this.hooks.onRequest)this.hooks.onRequest(v,C,b);return await T(v,b,C,this)},static:this.staticFiles,development:!0};if(N.sslCert&&N.sslKey)z.certFile=N.sslCert,z.keyFile=N.sslKey;if(this.serverInstance=Bun?.serve(z),N.sslCert&&N.sslKey)console.log(`HTTPS server is running on https://localhost:${f}`);if(n)return n();return this.serverInstance}close(f){if(this.serverInstance)this.serverInstance.stop(!0),this.serverInstance=null,f?f():console.log("Server has been stopped");else console.warn("Server is not running.")}route(f,i){if(!f||typeof f!=="string")throw new Error("Path must be a string");let A=Object.fromEntries(i.tempRoutes);return Object.entries(A).forEach(([N,z])=>{let v=N.replace(/::\w+$/,""),b=`${f}${v}`;if(!this.middlewares.has(b))this.middlewares.set(b,[]);z.handlers.slice(0,-1).forEach((g)=>{if(!this.middlewares.get(b)?.includes(g))this.middlewares.get(b)?.push(g)});let E=z.handlers[z.handlers.length-1],F=z.method;try{this.trie.insert(b,{handler:E,method:F})}catch(g){console.error(`Error inserting ${b}:`,g)}}),i=null,this}register(f,i){return this.route(f,i)}addRoute(f,i,A){if(typeof i!=="string")throw new Error(`Error in ${A[A.length-1]}: Path must be a string. Received: ${typeof i}`);if(typeof f!=="string")throw new Error(`Error in addRoute: Method must be a string. Received: ${typeof f}`);this.tempRoutes?.set(i+"::"+f,{method:f,handlers:A});let n=A.slice(0,-1),N=A[A.length-1];if(!this.middlewares.has(i))this.middlewares.set(i,[]);n.forEach((z)=>{if(i==="/")this.globalMiddlewares=[...new Set([...this.globalMiddlewares,...n])];else if(!this.middlewares.get(i)?.includes(z))this.middlewares.get(i)?.push(z)});try{if(f==="ANY"){let z=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD","PROPFIND"];for(let v of z)this.trie.insert(i,{handler:N,method:v})}this.trie.insert(i,{handler:N,method:f})}catch(z){console.error(`Error inserting ${i}:`,z)}}use(f,i){if(Array.isArray(f))f.forEach((n)=>{if(typeof n==="function")this.globalMiddlewares.push(n)});if(typeof f==="function"){if(this.globalMiddlewares.push(f),Array.isArray(i))i.forEach((n)=>{this.globalMiddlewares.push(n)});return}return(Array.isArray(f)?f.filter((n)=>typeof n==="string"):[f].filter((n)=>typeof n==="string")).forEach((n)=>{if(!this.middlewares.has(n))this.middlewares.set(n,[]);if(i)(Array.isArray(i)?i:[i]).forEach((z)=>{this.middlewares.get(n)?.push(z)})}),this}get(f,...i){return this.addRoute("GET",f,i),this}post(f,...i){return this.addRoute("POST",f,i),this}put(f,...i){return this.addRoute("PUT",f,i),this}patch(f,...i){return this.addRoute("PATCH",f,i),this}delete(f,...i){return this.addRoute("DELETE",f,i),this}any(f,...i){return this.addRoute("ANY",f,i),this}head(f,...i){return this.addRoute("HEAD",f,i),this}options(f,...i){return this.addRoute("OPTIONS",f,i),this}propfind(f,...i){return this.addRoute("PROPFIND",f,i),this}}export{q as default};
