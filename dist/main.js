var I=Object.create;var{getPrototypeOf:l,defineProperty:M,getOwnPropertyNames:q}=Object;var P=Object.prototype.hasOwnProperty;var k=(i,v,g)=>{g=i!=null?I(l(i)):{};let A=v||!i||!i.__esModule?M(g,"default",{value:i,enumerable:!0}):g;for(let F of q(i))if(!P.call(A,F))M(A,F,{get:()=>i[F],enumerable:!0});return A};var o=((i)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(i,{get:(v,g)=>(typeof require!=="undefined"?require:v)[g]}):i)(function(i){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+i+'" is not supported')});class m{children;isEndOfWord;handler;isDynamic;pattern;path;method;constructor(){this.children={},this.isEndOfWord=!1,this.handler=[],this.isDynamic=!1,this.pattern="",this.path="",this.method=[]}}class w{root;constructor(){this.root=new m}insert(i,v){let g=this.root,A=i.split("/").filter(Boolean);if(i==="/"){g.isEndOfWord=!0,g.handler.push(v.handler),g.path=i,g.method.push(v.method);return}for(let F of A){let N=!1,f=F;if(F.startsWith(":"))N=!0,f=":";if(!g.children[f])g.children[f]=new m;g=g.children[f],g.isDynamic=N,g.pattern=F}g.isEndOfWord=!0,g.path=i,g.method.push(v.method),g.handler.push(v.handler)}search(i,v){let g=this.root,A=i.split("/").filter(Boolean),F=A.length;for(let C of A){let n=C;if(!g.children[n])if(g.children[":"])g=g.children[":"];else return null;else g=g.children[n]}let N=g.path.split("/").filter(Boolean);if(F!==N.length)return null;let f=g.method.indexOf(v);if(f!==-1)return{path:g.path,handler:g.handler[f],isDynamic:g.isDynamic,pattern:g.pattern,method:g.method[f]};return{path:g.path,handler:g.handler,isDynamic:g.isDynamic,pattern:g.pattern,method:g.method[f]}}}function r(i){let{time:v=60000,max:g=100,message:A="Rate limit exceeded. Please try again later."}=i,F=new Map;return(N)=>{let f=new Date,C=N.ip;if(!F.has(C))F.set(C,{count:0,startTime:f});let n=F.get(C);if(n)if(f-n.startTime>v)n.count=1,n.startTime=f;else n.count++;if(n&&n.count>g)return N.json({error:A},429)}}function J(i){switch(i.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}function O(i,v){if(!i)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");return(g)=>{try{let A=g.cookies?.accessToken||g.req?.headers?.get("Authorization");if(!A)return g.json({message:"Unauthorized: No token provided"},401);if(A.startsWith("Bearer "))A=A.slice(7);let F=i?.verify(A,v);if(!F)return g.json({message:"Unauthorized: Invalid token"},401);g.set("user",F);return}catch(A){return g.json({message:"Unauthorized: Invalid token",error:A?.message},401)}}}function U(i,v,g){if(!i)throw new Error("JWT library is not defined, please provide jwt to authenticateJwtDB Function");if(!v)throw new Error("User model is not defined, please provide UserModel to authenticateJwtDB Function");return async(A)=>{try{let F=A.cookies?.accessToken||A.req?.headers?.get("Authorization");if(!F)return A.json({message:"Unauthorized: No token provided"},401);if(F.startsWith("Bearer "))F=F.slice(7);let N=i?.verify(F,g);if(!N)return A.json({message:"Unauthorized: Invalid token"},401);let f=await v.findById(N._id).select("-password -refreshToken");if(!f)return A.json({message:"Unauthorized: User not found"},401);A.set("user",f);return}catch(F){return A.json({message:"Unauthorized: Authentication failed",error:F?.message},401)}}}function B(i,v,g){let A=new Headers({"Cache-Control":"no-cache"}),F=null,N=null,f=null,C=null,n={};return{req:i,server:v,url:g,status:200,setHeader(b,z){return A.set(b,z),this},removeHeader(b){return A.delete(b),this},get ip(){return this.server.requestIP(this.req)?.address??null},get query(){if(!F)try{F=Object.fromEntries(this.url.searchParams)}catch(b){throw new Error("Failed to parse query parameters")}return F},get params(){if(!N&&this.req.routePattern)try{N=h(this.req.routePattern,this.url.pathname)}catch(b){throw new Error("Failed to extract route parameters")}return N??{}},get body(){if(this.req.method==="GET")return Promise.resolve({});if(!C)C=(async()=>{let b=await s(this.req);if(b.error)throw new Error(b.error);return Object.keys(b).length===0?null:b})();return C},set(b,z){return n[b]=z,this},get(b){return n[b]},text(b,z){if(z)this.status=z;if(!A.has("Content-Type"))A.set("Content-Type","text/plain; charset=utf-8");return new Response(b,{status:this.status,headers:A})},send(b,z){if(z)this.status=z;let E=new Map([["string","text/plain; charset=utf-8"],["object","application/json; charset=utf-8"],["Uint8Array","application/octet-stream"],["ArrayBuffer","application/octet-stream"]]),L=b instanceof Uint8Array?"Uint8Array":b instanceof ArrayBuffer?"ArrayBuffer":typeof b;if(!A.has("Content-Type"))A.set("Content-Type",E.get(L)??"text/plain; charset=utf-8");let $=L==="object"&&b!==null?JSON.stringify(b):b;return new Response($,{status:this.status,headers:A})},json(b,z){if(z)this.status=z;if(!A.has("Content-Type"))A.set("Content-Type","application/json; charset=utf-8");return new Response(JSON.stringify(b),{status:this.status,headers:A})},file(b,z,E){if(E)this.status=E;let L=Bun.file(b);if(!A.has("Content-Type"))A.set("Content-Type",z??J(b));return new Response(L,{status:this.status,headers:A})},async ejs(b,z={},E){if(E)this.status=E;let L;try{L=await import("ejs"),L=L.default||L}catch($){return console.error("EJS not installed! Please run `bun add ejs`"),new Response("EJS not installed! Please run `bun add ejs`",{status:500})}try{let $=await Bun.file(b).text(),X=L.render($,z),Y=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response(X,{status:this.status,headers:Y})}catch($){return console.error("EJS Rendering Error:",$),new Response("Error rendering template",{status:500})}},redirect(b,z){if(z)this.status=z;else this.status=302;return A.set("Location",b),new Response(null,{status:this.status,headers:A})},setCookie(b,z,E={}){let L=`${encodeURIComponent(b)}=${encodeURIComponent(z)}`;if(E.maxAge)L+=`; Max-Age=${E.maxAge}`;if(E.expires)L+=`; Expires=${E.expires.toUTCString()}`;if(E.path)L+=`; Path=${E.path}`;if(E.domain)L+=`; Domain=${E.domain}`;if(E.secure)L+="; Secure";if(E.httpOnly)L+="; HttpOnly";if(E.sameSite)L+=`; SameSite=${E.sameSite}`;return A.append("Set-Cookie",L),this},get cookies(){if(!f){let b=this.req.headers.get("cookie");f=b?p(b):{}}return f}}}function p(i){return Object.fromEntries(i.split(";").map((v)=>{let[g,...A]=v.trim().split("=");return[g,decodeURIComponent(A.join("="))]}))}function h(i,v){let g={},A=i.split("/"),[F]=v.split("?"),N=F.split("/");if(A.length!==N.length)return null;for(let f=0;f<A.length;f++)if(A[f].startsWith(":"))g[A[f].slice(1)]=N[f];return g}async function s(i){let v=i.headers.get("Content-Type");if(!v)return{};if(i.headers.get("Content-Length")==="0"||!i.body)return{};try{if(v.startsWith("application/json"))return await i.json();if(v.startsWith("application/x-www-form-urlencoded")){let A=await i.text();return Object.fromEntries(new URLSearchParams(A))}if(v.startsWith("multipart/form-data")){let A=await i.formData(),F={};for(let[N,f]of A.entries())F[N]=f;return F}return{error:"Unknown request body type"}}catch(A){return{error:"Invalid request body format"}}}async function D(i,v,g,A){let F=B(i,v,g),N=A.trie.search(g.pathname,i.method);if(i.routePattern=N?.path,A.hasFilterEnabled){let n=i.routePattern??g.pathname,b=await t(A,n,F,v);if(b)return b}if(A.hasMiddleware){let n=await R(A.globalMiddlewares,F,v);if(n)return n;let b=A.middlewares.get(g.pathname)||[],z=await R(b,F,v);if(z)return z}if(!N?.handler||N.method!==i.method){if(A.staticPath){let n=await d(A,g.pathname,F);if(n)return n;let b=A.trie.search("*",i.method);if(b?.handler)return await b.handler(F)}if(A.hooks.routeNotFound&&!N?.handler){let n=await A.hooks.routeNotFound(F);if(n)return n}if(!N||!N?.handler?.length)return Q(404,`Route not found for ${g.pathname}`);if(N?.method!==i.method)return Q(405,"Method not allowed")}if(A.hooks.preHandler){let n=await A.hooks.preHandler(F);if(n)return n}let f=N.handler(F),C=f instanceof Promise?await f:f;if(A.hooks.postHandler)A.hooks.postHandler(F);if(A.hooks.onSend){let n=await A.hooks.onSend(F,C);if(n)return n}return C??Q(204,"No response from this handler")}async function R(i,v,g){for(let A of i){let F=await A(v,g);if(F)return F}return null}async function t(i,v,g,A){if(!i.filters.has(v))if(i.filterFunction.length)for(let F of i.filterFunction){let N=await F(g,A);if(N)return N}else return g.json({error:!0,message:"Protected route, authentication required",status:401},401)}function Q(i,v){return new Response(JSON.stringify({error:!0,message:v,status:i}),{status:i,headers:{"Content-Type":"application/json"}})}async function d(i,v,g){if(!i.staticPath)return null;let A=`${i.staticPath}${v}`;if(await Bun.file(A).exists()){let N=J(A);return g.file(A,N,200)}return null}var{create:a,defineProperty:x,getOwnPropertyDescriptor:e,getOwnPropertyNames:i1,getPrototypeOf:f1}=Object,v1=Object.prototype.hasOwnProperty,A1=(i,v)=>()=>(v||i((v={exports:{}}).exports,v),v.exports),g1=(i,v,g,A)=>{if(v&&typeof v=="object"||typeof v=="function")for(let F of i1(v))!v1.call(i,F)&&F!==g&&x(i,F,{get:()=>v[F],enumerable:!(A=e(v,F))||A.enumerable});return i},C1=(i,v,g)=>(g=i!=null?a(f1(i)):{},g1(v||!i||!i.__esModule?x(g,"default",{value:i,enumerable:!0}):g,i)),n1=A1((i,v)=>{function g(f){if(typeof f!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(f))}function A(f,C){for(var n="",b=0,z=-1,E=0,L,$=0;$<=f.length;++$){if($<f.length)L=f.charCodeAt($);else{if(L===47)break;L=47}if(L===47){if(!(z===$-1||E===1))if(z!==$-1&&E===2){if(n.length<2||b!==2||n.charCodeAt(n.length-1)!==46||n.charCodeAt(n.length-2)!==46){if(n.length>2){var X=n.lastIndexOf("/");if(X!==n.length-1){X===-1?(n="",b=0):(n=n.slice(0,X),b=n.length-1-n.lastIndexOf("/")),z=$,E=0;continue}}else if(n.length===2||n.length===1){n="",b=0,z=$,E=0;continue}}C&&(n.length>0?n+="/..":n="..",b=2)}else n.length>0?n+="/"+f.slice(z+1,$):n=f.slice(z+1,$),b=$-z-1;z=$,E=0}else L===46&&E!==-1?++E:E=-1}return n}function F(f,C){var n=C.dir||C.root,b=C.base||(C.name||"")+(C.ext||"");return n?n===C.root?n+b:n+f+b:b}var N={resolve:function(){for(var f="",C=!1,n,b=arguments.length-1;b>=-1&&!C;b--){var z;b>=0?z=arguments[b]:(n===void 0&&(n=process.cwd()),z=n),g(z),z.length!==0&&(f=z+"/"+f,C=z.charCodeAt(0)===47)}return f=A(f,!C),C?f.length>0?"/"+f:"/":f.length>0?f:"."},normalize:function(f){if(g(f),f.length===0)return".";var C=f.charCodeAt(0)===47,n=f.charCodeAt(f.length-1)===47;return f=A(f,!C),f.length===0&&!C&&(f="."),f.length>0&&n&&(f+="/"),C?"/"+f:f},isAbsolute:function(f){return g(f),f.length>0&&f.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var f,C=0;C<arguments.length;++C){var n=arguments[C];g(n),n.length>0&&(f===void 0?f=n:f+="/"+n)}return f===void 0?".":N.normalize(f)},relative:function(f,C){if(g(f),g(C),f===C||(f=N.resolve(f),C=N.resolve(C),f===C))return"";for(var n=1;n<f.length&&f.charCodeAt(n)===47;++n);for(var b=f.length,z=b-n,E=1;E<C.length&&C.charCodeAt(E)===47;++E);for(var L=C.length,$=L-E,X=z<$?z:$,Y=-1,G=0;G<=X;++G){if(G===X){if($>X){if(C.charCodeAt(E+G)===47)return C.slice(E+G+1);if(G===0)return C.slice(E+G)}else z>X&&(f.charCodeAt(n+G)===47?Y=G:G===0&&(Y=0));break}var _=f.charCodeAt(n+G),H=C.charCodeAt(E+G);if(_!==H)break;_===47&&(Y=G)}var V="";for(G=n+Y+1;G<=b;++G)(G===b||f.charCodeAt(G)===47)&&(V.length===0?V+="..":V+="/..");return V.length>0?V+C.slice(E+Y):(E+=Y,C.charCodeAt(E)===47&&++E,C.slice(E))},_makeLong:function(f){return f},dirname:function(f){if(g(f),f.length===0)return".";for(var C=f.charCodeAt(0),n=C===47,b=-1,z=!0,E=f.length-1;E>=1;--E)if(C=f.charCodeAt(E),C===47){if(!z){b=E;break}}else z=!1;return b===-1?n?"/":".":n&&b===1?"//":f.slice(0,b)},basename:function(f,C){if(C!==void 0&&typeof C!="string")throw new TypeError('"ext" argument must be a string');g(f);var n=0,b=-1,z=!0,E;if(C!==void 0&&C.length>0&&C.length<=f.length){if(C.length===f.length&&C===f)return"";var L=C.length-1,$=-1;for(E=f.length-1;E>=0;--E){var X=f.charCodeAt(E);if(X===47){if(!z){n=E+1;break}}else $===-1&&(z=!1,$=E+1),L>=0&&(X===C.charCodeAt(L)?--L===-1&&(b=E):(L=-1,b=$))}return n===b?b=$:b===-1&&(b=f.length),f.slice(n,b)}else{for(E=f.length-1;E>=0;--E)if(f.charCodeAt(E)===47){if(!z){n=E+1;break}}else b===-1&&(z=!1,b=E+1);return b===-1?"":f.slice(n,b)}},extname:function(f){g(f);for(var C=-1,n=0,b=-1,z=!0,E=0,L=f.length-1;L>=0;--L){var $=f.charCodeAt(L);if($===47){if(!z){n=L+1;break}continue}b===-1&&(z=!1,b=L+1),$===46?C===-1?C=L:E!==1&&(E=1):C!==-1&&(E=-1)}return C===-1||b===-1||E===0||E===1&&C===b-1&&C===n+1?"":f.slice(C,b)},format:function(f){if(f===null||typeof f!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof f);return F("/",f)},parse:function(f){g(f);var C={root:"",dir:"",base:"",ext:"",name:""};if(f.length===0)return C;var n=f.charCodeAt(0),b=n===47,z;b?(C.root="/",z=1):z=0;for(var E=-1,L=0,$=-1,X=!0,Y=f.length-1,G=0;Y>=z;--Y){if(n=f.charCodeAt(Y),n===47){if(!X){L=Y+1;break}continue}$===-1&&(X=!1,$=Y+1),n===46?E===-1?E=Y:G!==1&&(G=1):E!==-1&&(G=-1)}return E===-1||$===-1||G===0||G===1&&E===$-1&&E===L+1?$!==-1&&(L===0&&b?C.base=C.name=f.slice(1,$):C.base=C.name=f.slice(L,$)):(L===0&&b?(C.name=f.slice(1,E),C.base=f.slice(1,$)):(C.name=f.slice(L,E),C.base=f.slice(L,$)),C.ext=f.slice(E,$)),L>0?C.dir=f.slice(0,L-1):b&&(C.dir="/"),C},sep:"/",delimiter:":",win32:null,posix:null};N.posix=N,v.exports=N}),S=C1(n1()),K=S,b1=S,u=function(i){return i},c=function(){throw new Error("Not implemented")};K.parse??=c;b1.parse??=c;var Z={resolve:K.resolve.bind(K),normalize:K.normalize.bind(K),isAbsolute:K.isAbsolute.bind(K),join:K.join.bind(K),relative:K.relative.bind(K),toNamespacedPath:u,dirname:K.dirname.bind(K),basename:K.basename.bind(K),extname:K.extname.bind(K),format:K.format.bind(K),parse:K.parse.bind(K),sep:"/",delimiter:":",win32:void 0,posix:void 0,_makeLong:u},j={sep:"\\",delimiter:";",win32:void 0,...Z,posix:Z};Z.win32=j.win32=j;Z.posix=Z;var W=Z;var{default:T}=(()=>({}));class y{tempRoutes;globalMiddlewares;middlewares;trie;hasOnReqHook;hasMiddleware;hasPreHandlerHook;hasPostHandlerHook;hasOnSendHook;hasOnError;hooks;corsConfig;FilterRoutes;filters;filterFunction;hasFilterEnabled;serverInstance;staticPath;staticFiles;user_jwt_secret;baseApiUrl;constructor({jwtSecret:i,baseApiUrl:v}={}){this.baseApiUrl=v||"",this.user_jwt_secret=i||process.env.DIESEL_JWT_SECRET||"feault_diesel_secret_for_jwt",this.tempRoutes=new Map,this.globalMiddlewares=[],this.middlewares=new Map,this.trie=new w,this.corsConfig=null,this.hasMiddleware=!1,this.hasOnReqHook=!1,this.hasPreHandlerHook=!1,this.hasPostHandlerHook=!1,this.hasOnSendHook=!1,this.hasOnError=!1,this.hooks={onRequest:null,preHandler:null,postHandler:null,onSend:null,onError:null,onClose:null,routeNotFound:null},this.FilterRoutes=[],this.filters=new Set,this.filterFunction=[],this.hasFilterEnabled=!1,this.serverInstance=null,this.staticPath=null,this.staticFiles={}}setupFilter(){return this.hasFilterEnabled=!0,{routeMatcher:(...i)=>{return this.FilterRoutes=i,this.setupFilter()},permitAll:()=>{for(let i of this?.FilterRoutes)this.filters.add(i);return this.FilterRoutes=null,this.setupFilter()},authenticate:(i)=>{if(i?.length)for(let v of i)this.filterFunction.push(v)},authenticateJwt:(i)=>{this.filterFunction.push(O(i,this.user_jwt_secret))},authenticateJwtDB:(i,v)=>{this.filterFunction.push(U(i,v,this.user_jwt_secret))}}}redirect(i,v,g){return this.any(i,(A)=>{let F=A.params,N=v;if(F)for(let C in F)N=N.replace(`:${C}`,F[C]);let f=A.url.search;if(f)N+=f;return A.redirect(N,g)}),this}serveStatic(i){return this.staticPath=i,this}static(i){return this.staticFiles={...this.staticFiles,...i},this}addHooks(i,v){if(typeof i!=="string")throw new Error("hookName must be a string");if(typeof v!=="function")throw new Error("callback must be a instance of function");switch(i){case"onRequest":this.hooks.onRequest=v;break;case"preHandler":this.hooks.preHandler=v;break;case"postHandler":this.hooks.postHandler=v;break;case"onSend":this.hooks.onSend=v;break;case"onError":this.hooks.onError=v;break;case"onClose":this.hooks.onClose=v;break;case"routeNotFound":this.hooks.routeNotFound=v;break;default:throw new Error(`Unknown hook type: ${i}`)}return this}compile(){if(this.globalMiddlewares.length>0)this.hasMiddleware=!0;for(let[g,A]of this.middlewares.entries())if(A.length>0){this.hasMiddleware=!0;break}let i=process.cwd(),v=W.join(i,"src","routes");if(T?.existsSync(v))this.loadRoutes(v,"");setTimeout(()=>{this.tempRoutes=null},2000)}async registerFileRoutes(i,v,g){let A=await import(i),F;if(g===".ts")F=W.basename(i,".ts");else if(g===".js")F=W.basename(i,".js");let N=v+"/"+F;if(N.endsWith("/index"))N=v;N=N.replace(/\[(.*?)\]/g,":$1");let f=["GET","POST","PUT","PATCH","DELETE","ANY","HEAD","OPTIONS","PROPFIND"];for(let C of f)if(A[C]){let n=C,b=A[C];this.trie.insert(`${this.baseApiUrl}${N}`,{handler:b,method:n})}}async loadRoutes(i,v){let g=await T.promises.readdir(i);for(let A of g){let F=W.join(i,A);if((await T.promises.stat(F)).isDirectory())this.loadRoutes(F,v+"/"+A);else if(A.endsWith(".ts"))this.registerFileRoutes(F,v,".ts");else if(A.endsWith(".js"))this.registerFileRoutes(F,v,".js")}}listen(i,...v){if(typeof Bun==="undefined")throw new Error(".listen() is designed to run on Bun only...");let g="0.0.0.0",A=void 0,F={};for(let f of v)if(typeof f==="string")g=f;else if(typeof f==="function")A=f;else if(typeof f==="object"&&f!==null)F=f;this.compile();let N={port:i,hostname:g,fetch:async(f,C)=>{let n=new URL(f.url);try{if(this.hooks.onRequest)this.hooks.onRequest(f,n,C);return await D(f,C,n,this)}catch(b){return this.hooks.onError?this.hooks.onError(b,f,n,C):new Response(JSON.stringify({message:"Internal Server Error",error:b?.message,status:500}),{status:500})}},static:this.staticFiles,development:!0};if(F.sslCert&&F.sslKey)N.certFile=F.sslCert,N.keyFile=F.sslKey;if(this.serverInstance=Bun?.serve(N),F.sslCert&&F.sslKey)console.log(`HTTPS server is running on https://localhost:${i}`);if(A)return A();return this.serverInstance}close(i){if(this.serverInstance)this.serverInstance.stop(!0),this.serverInstance=null,i?i():console.log("Server has been stopped");else console.warn("Server is not running.")}route(i,v){if(!i||typeof i!=="string")throw new Error("Path must be a string");let g=Object.fromEntries(v.tempRoutes);return Object.entries(g).forEach(([F,N])=>{let f=F.replace(/::\w+$/,""),C=`${i}${f}`;if(!this.middlewares.has(C))this.middlewares.set(C,[]);N.handlers.slice(0,-1).forEach((E)=>{if(!this.middlewares.get(C)?.includes(E))this.middlewares.get(C)?.push(E)});let b=N.handlers[N.handlers.length-1],z=N.method;try{this.trie.insert(C,{handler:b,method:z})}catch(E){console.error(`Error inserting ${C}:`,E)}}),v=null,this}register(i,v){return this.route(i,v)}addRoute(i,v,g){if(typeof v!=="string")throw new Error(`Error in ${g[g.length-1]}: Path must be a string. Received: ${typeof v}`);if(typeof i!=="string")throw new Error(`Error in addRoute: Method must be a string. Received: ${typeof i}`);this.tempRoutes?.set(v+"::"+i,{method:i,handlers:g});let A=g.slice(0,-1),F=g[g.length-1];if(!this.middlewares.has(v))this.middlewares.set(v,[]);A.forEach((N)=>{if(v==="/")this.globalMiddlewares=[...new Set([...this.globalMiddlewares,...A])];else if(!this.middlewares.get(v)?.includes(N))this.middlewares.get(v)?.push(N)});try{if(i==="ANY"){let N=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD","PROPFIND"];for(let f of N)this.trie.insert(v,{handler:F,method:f})}this.trie.insert(v,{handler:F,method:i})}catch(N){console.error(`Error inserting ${v}:`,N)}}use(i,v){if(Array.isArray(i))i.forEach((A)=>{if(typeof A==="function")this.globalMiddlewares.push(A)});if(typeof i==="function"){if(this.globalMiddlewares.push(i),Array.isArray(v))v.forEach((A)=>{this.globalMiddlewares.push(A)});return}return(Array.isArray(i)?i.filter((A)=>typeof A==="string"):[i].filter((A)=>typeof A==="string")).forEach((A)=>{if(!this.middlewares.has(A))this.middlewares.set(A,[]);if(v)(Array.isArray(v)?v:[v]).forEach((N)=>{this.middlewares.get(A)?.push(N)})}),this}get(i,...v){return this.addRoute("GET",i,v),this}post(i,...v){return this.addRoute("POST",i,v),this}put(i,...v){return this.addRoute("PUT",i,v),this}patch(i,...v){return this.addRoute("PATCH",i,v),this}delete(i,...v){return this.addRoute("DELETE",i,v),this}any(i,...v){return this.addRoute("ANY",i,v),this}head(i,...v){return this.addRoute("HEAD",i,v),this}options(i,...v){return this.addRoute("OPTIONS",i,v),this}propfind(i,...v){return this.addRoute("PROPFIND",i,v),this}}export{y as default};
