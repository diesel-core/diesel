var j=Object.create;var{getPrototypeOf:q,defineProperty:Z,getOwnPropertyNames:k}=Object;var P=Object.prototype.hasOwnProperty;var e=(n,r,f)=>{f=n!=null?j(q(n)):{};let g=r||!n||!n.__esModule?Z(f,"default",{value:n,enumerable:!0}):f;for(let u of k(n))if(!P.call(g,u))Z(g,u,{get:()=>n[u],enumerable:!0});return g};var h=((n)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(n,{get:(r,f)=>(typeof require!=="undefined"?require:r)[f]}):n)(function(n){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')});class D{children;isEndOfWord;handler;isDynamic;pattern;path;method;constructor(){this.children={},this.isEndOfWord=!1,this.handler=[],this.isDynamic=!1,this.pattern="",this.path="",this.method=[]}}class t{root;constructor(){this.root=new D}insert(n,r){let f=this.root,g=n.split("/").filter(Boolean);if(n==="/"){f.isEndOfWord=!0,f.handler.push(r.handler),f.path=n,f.method.push(r.method);return}for(let u of g){let C=!1,o=u;if(u.startsWith(":"))C=!0,o=":";if(!f.children[o])f.children[o]=new D;f=f.children[o],f.isDynamic=C,f.pattern=u}f.isEndOfWord=!0,f.path=n,f.method.push(r.method),f.handler.push(r.handler)}search(n,r){let f=this.root,g=n.split("/").filter(Boolean),u=g.length;for(let m of g){let i=m;if(!f.children[i])if(f.children[":"])f=f.children[":"];else return null;else f=f.children[i]}let C=f.path.split("/").filter(Boolean);if(u!==C.length)return null;let o=f.method.indexOf(r);if(o!==-1)return{path:f.path,handler:f.handler[o],isDynamic:f.isDynamic,pattern:f.pattern,method:f.method[o]};return{path:f.path,handler:f.handler,isDynamic:f.isDynamic,pattern:f.pattern,method:f.method[o]}}}function O(n){switch(n.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}function U(n,r){if(!n)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");return(f)=>{try{let g=f.cookies?.accessToken||f.req?.headers?.get("Authorization");if(!g)return f.json({message:"Unauthorized: No token provided"},401);if(g.startsWith("Bearer "))g=g.slice(7);let u=n?.verify(g,r);if(!u)return f.json({message:"Unauthorized: Invalid token"},401);f.set("user",u);return}catch(g){return f.json({message:"Unauthorized: Invalid token",error:g?.message},401)}}}function V(n,r,f){if(!n)throw new Error("JWT library is not defined, please provide jwt to authenticateJwtDB Function");if(!r)throw new Error("User model is not defined, please provide UserModel to authenticateJwtDB Function");return async(g)=>{try{let u=g.cookies?.accessToken||g.req?.headers?.get("Authorization");if(!u)return g.json({message:"Unauthorized: No token provided"},401);if(u.startsWith("Bearer "))u=u.slice(7);let C=n?.verify(u,f);if(!C)return g.json({message:"Unauthorized: Invalid token"},401);let o=await r.findById(C._id).select("-password -refreshToken");if(!o)return g.json({message:"Unauthorized: User not found"},401);g.set("user",o);return}catch(u){return g.json({message:"Unauthorized: Authentication failed",error:u?.message},401)}}}function G(n,r,f){let g=null,u=null,C=null,o=null,m={};return{req:n,server:r,url:f,status:200,headers:new Headers({"Cache-Control":"no-cache"}),setHeader(i,v){return this.headers.set(i,v),this},removeHeader(i){return this.headers.delete(i),this},get ip(){return this.server.requestIP(this.req)?.address??null},get query(){if(!g)try{g=Object.fromEntries(this.url.searchParams)}catch(i){throw new Error("Failed to parse query parameters")}return g},get params(){if(!u&&this.req.routePattern)try{u=d(this.req.routePattern,this.url.pathname)}catch(i){throw new Error("Failed to extract route parameters")}return u??{}},get body(){if(this.req.method==="GET")return Promise.resolve({});if(!o)o=(async()=>{let i=await a(this.req);if(i.error)throw new Error(i.error);return Object.keys(i).length===0?null:i})();return o},set(i,v){return m[i]=v,this},get(i){return m[i]},text(i,v){if(v)this.status=v;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type","text/plain; charset=utf-8");return new Response(i,{status:this.status,headers:this.headers})},send(i,v){if(v)this.status=v;let b=new Map([["string","text/plain; charset=utf-8"],["object","application/json; charset=utf-8"],["Uint8Array","application/octet-stream"],["ArrayBuffer","application/octet-stream"]]),A=i instanceof Uint8Array?"Uint8Array":i instanceof ArrayBuffer?"ArrayBuffer":typeof i;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",b.get(A)??"text/plain; charset=utf-8");let $=A==="object"&&i!==null?JSON.stringify(i):i;return new Response($,{status:this.status,headers:this.headers})},json(i,v){if(v)this.status=v;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type","application/json; charset=utf-8");return new Response(JSON.stringify(i),{status:this.status,headers:this.headers})},file(i,v,b){if(b)this.status=b;let A=Bun.file(i);if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",v??O(i));return new Response(A,{status:this.status,headers:this.headers})},async ejs(i,v={},b){if(b)this.status=b;let A;try{A=await import("ejs"),A=A.default||A}catch($){return console.error("EJS not installed! Please run `bun add ejs`"),new Response("EJS not installed! Please run `bun add ejs`",{status:500})}try{let $=await Bun.file(i).text(),c=A.render($,v),y=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response(c,{status:this.status,headers:y})}catch($){return console.error("EJS Rendering Error:",$),new Response("Error rendering template",{status:500})}},redirect(i,v){if(v)this.status=v;else this.status=302;return this.headers.set("Location",i),new Response(null,{status:this.status,headers:this.headers})},setCookie(i,v,b={}){let A=`${encodeURIComponent(i)}=${encodeURIComponent(v)}`;if(b.maxAge)A+=`; Max-Age=${b.maxAge}`;if(b.expires)A+=`; Expires=${b.expires.toUTCString()}`;if(b.path)A+=`; Path=${b.path}`;if(b.domain)A+=`; Domain=${b.domain}`;if(b.secure)A+="; Secure";if(b.httpOnly)A+="; HttpOnly";if(b.sameSite)A+=`; SameSite=${b.sameSite}`;return this.headers.append("Set-Cookie",A),this},get cookies(){if(!C){let i=this.req.headers.get("cookie");C=i?p(i):{}}return C}}}function p(n){return Object.fromEntries(n.split(";").map((r)=>{let[f,...g]=r.trim().split("=");return[f,decodeURIComponent(g.join("="))]}))}function d(n,r){let f={},g=n.split("/"),[u]=r.split("?"),C=u.split("/");if(g.length!==C.length)return null;for(let o=0;o<g.length;o++)if(g[o].startsWith(":"))f[g[o].slice(1)]=C[o];return f}async function a(n){let r=n.headers.get("Content-Type");if(!r)return{};if(n.headers.get("Content-Length")==="0"||!n.body)return{};try{if(r.startsWith("application/json"))return await n.json();if(r.startsWith("application/x-www-form-urlencoded")){let g=await n.text();return Object.fromEntries(new URLSearchParams(g))}if(r.startsWith("multipart/form-data")){let g=await n.formData(),u={};for(let[C,o]of g.entries())u[C]=o;return u}return{error:"Unknown request body type"}}catch(g){return{error:"Invalid request body format"}}}async function R(n,r,f,g){let u=G(n,r,f),C=g.trie.search(f.pathname,n.method);n.routePattern=C?.path;try{if(g.hasFilterEnabled){let i=n.routePattern??f.pathname,v=await nn(g,i,u,r);if(v)return v}if(g.hasMiddleware){if(g.globalMiddlewares.length){let v=await s(g.globalMiddlewares,u,r);if(v)return v}let i=g.middlewares.get(f.pathname)||[];if(i?.length){let v=await s(i,u,r);if(v)return v}}if(!C?.handler||C.method!==n.method){if(g.staticPath){let i=await rn(g,f.pathname,u);if(i)return i;let v=g.trie.search("*",n.method);if(v?.handler)return await v.handler(u)}if(g.hooks.routeNotFound?.length&&Array.isArray(g.hooks.routeNotFound)&&!C?.handler){let i=g.hooks.routeNotFound;for(let v=0;v<i.length;v++){let b=await i[v](u);if(b)return b}}if(!C||!C?.handler?.length)return l(404,`Route not found for ${f.pathname}`);if(C?.method!==n.method)return l(405,"Method not allowed")}if(g.hooks.preHandler?.length&&Array.isArray(g.hooks.preHandler)){let i=g.hooks.preHandler;for(let v=0;v<i.length;v++){let b=await i[v](u);if(b)return b}}let o=C.handler(u),m=o instanceof Promise?await o:o;if(g.hooks.onSend?.length&&Array.isArray(g.hooks.onSend)){let i=g.hooks.onSend;for(let v=0;v<i.length;v++){let b=await i[v](u);if(b)return b}}return m??l(204,"No response from this handler")}catch(o){return g.hooks.onError?.length&&Array.isArray(g.hooks.onError)?g.hooks.onError[0](o,n,f,r):l(500,"Internal Server Error")}finally{if(g.hooks.postHandler?.length&&Array.isArray(g.hooks.postHandler)){let o=g.hooks.postHandler;for(let m=0;m<o.length;m++){let i=await o[m](u);if(i)return i}}}}async function s(n,r,f){for(let g of n){let u=await g(r,f);if(u)return u}return null}async function nn(n,r,f,g){if(!n.filters.has(r))if(n.filterFunction.length)for(let u of n.filterFunction){let C=await u(f,g);if(C)return C}else return f.json({error:!0,message:"Protected route, authentication required",status:401},401)}function l(n,r){return new Response(JSON.stringify({error:!0,message:r,status:n}),{status:n,headers:{"Content-Type":"application/json"}})}async function rn(n,r,f){if(!n.staticPath)return null;let g=`${n.staticPath}${r}`;if(await Bun.file(g).exists()){let C=O(g);return f.file(g,C,200)}return null}var{create:on,defineProperty:W,getOwnPropertyDescriptor:fn,getOwnPropertyNames:gn,getPrototypeOf:mn}=Object,vn=Object.prototype.hasOwnProperty,un=(n,r)=>()=>(r||n((r={exports:{}}).exports,r),r.exports),An=(n,r,f,g)=>{if(r&&typeof r=="object"||typeof r=="function")for(let u of gn(r))!vn.call(n,u)&&u!==f&&W(n,u,{get:()=>r[u],enumerable:!(g=fn(r,u))||g.enumerable});return n},Cn=(n,r,f)=>(f=n!=null?on(mn(n)):{},An(r||!n||!n.__esModule?W(f,"default",{value:n,enumerable:!0}):f,n)),bn=un((n,r)=>{function f(o){if(typeof o!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(o))}function g(o,m){for(var i="",v=0,b=-1,A=0,$,c=0;c<=o.length;++c){if(c<o.length)$=o.charCodeAt(c);else{if($===47)break;$=47}if($===47){if(!(b===c-1||A===1))if(b!==c-1&&A===2){if(i.length<2||v!==2||i.charCodeAt(i.length-1)!==46||i.charCodeAt(i.length-2)!==46){if(i.length>2){var y=i.lastIndexOf("/");if(y!==i.length-1){y===-1?(i="",v=0):(i=i.slice(0,y),v=i.length-1-i.lastIndexOf("/")),b=c,A=0;continue}}else if(i.length===2||i.length===1){i="",v=0,b=c,A=0;continue}}m&&(i.length>0?i+="/..":i="..",v=2)}else i.length>0?i+="/"+o.slice(b+1,c):i=o.slice(b+1,c),v=c-b-1;b=c,A=0}else $===46&&A!==-1?++A:A=-1}return i}function u(o,m){var i=m.dir||m.root,v=m.base||(m.name||"")+(m.ext||"");return i?i===m.root?i+v:i+o+v:v}var C={resolve:function(){for(var o="",m=!1,i,v=arguments.length-1;v>=-1&&!m;v--){var b;v>=0?b=arguments[v]:(i===void 0&&(i=process.cwd()),b=i),f(b),b.length!==0&&(o=b+"/"+o,m=b.charCodeAt(0)===47)}return o=g(o,!m),m?o.length>0?"/"+o:"/":o.length>0?o:"."},normalize:function(o){if(f(o),o.length===0)return".";var m=o.charCodeAt(0)===47,i=o.charCodeAt(o.length-1)===47;return o=g(o,!m),o.length===0&&!m&&(o="."),o.length>0&&i&&(o+="/"),m?"/"+o:o},isAbsolute:function(o){return f(o),o.length>0&&o.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var o,m=0;m<arguments.length;++m){var i=arguments[m];f(i),i.length>0&&(o===void 0?o=i:o+="/"+i)}return o===void 0?".":C.normalize(o)},relative:function(o,m){if(f(o),f(m),o===m||(o=C.resolve(o),m=C.resolve(m),o===m))return"";for(var i=1;i<o.length&&o.charCodeAt(i)===47;++i);for(var v=o.length,b=v-i,A=1;A<m.length&&m.charCodeAt(A)===47;++A);for(var $=m.length,c=$-A,y=b<c?b:c,F=-1,L=0;L<=y;++L){if(L===y){if(c>y){if(m.charCodeAt(A+L)===47)return m.slice(A+L+1);if(L===0)return m.slice(A+L)}else b>y&&(o.charCodeAt(i+L)===47?F=L:L===0&&(F=0));break}var Y=o.charCodeAt(i+L),H=m.charCodeAt(A+L);if(Y!==H)break;Y===47&&(F=L)}var w="";for(L=i+F+1;L<=v;++L)(L===v||o.charCodeAt(L)===47)&&(w.length===0?w+="..":w+="/..");return w.length>0?w+m.slice(A+F):(A+=F,m.charCodeAt(A)===47&&++A,m.slice(A))},_makeLong:function(o){return o},dirname:function(o){if(f(o),o.length===0)return".";for(var m=o.charCodeAt(0),i=m===47,v=-1,b=!0,A=o.length-1;A>=1;--A)if(m=o.charCodeAt(A),m===47){if(!b){v=A;break}}else b=!1;return v===-1?i?"/":".":i&&v===1?"//":o.slice(0,v)},basename:function(o,m){if(m!==void 0&&typeof m!="string")throw new TypeError('"ext" argument must be a string');f(o);var i=0,v=-1,b=!0,A;if(m!==void 0&&m.length>0&&m.length<=o.length){if(m.length===o.length&&m===o)return"";var $=m.length-1,c=-1;for(A=o.length-1;A>=0;--A){var y=o.charCodeAt(A);if(y===47){if(!b){i=A+1;break}}else c===-1&&(b=!1,c=A+1),$>=0&&(y===m.charCodeAt($)?--$===-1&&(v=A):($=-1,v=c))}return i===v?v=c:v===-1&&(v=o.length),o.slice(i,v)}else{for(A=o.length-1;A>=0;--A)if(o.charCodeAt(A)===47){if(!b){i=A+1;break}}else v===-1&&(b=!1,v=A+1);return v===-1?"":o.slice(i,v)}},extname:function(o){f(o);for(var m=-1,i=0,v=-1,b=!0,A=0,$=o.length-1;$>=0;--$){var c=o.charCodeAt($);if(c===47){if(!b){i=$+1;break}continue}v===-1&&(b=!1,v=$+1),c===46?m===-1?m=$:A!==1&&(A=1):m!==-1&&(A=-1)}return m===-1||v===-1||A===0||A===1&&m===v-1&&m===i+1?"":o.slice(m,v)},format:function(o){if(o===null||typeof o!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof o);return u("/",o)},parse:function(o){f(o);var m={root:"",dir:"",base:"",ext:"",name:""};if(o.length===0)return m;var i=o.charCodeAt(0),v=i===47,b;v?(m.root="/",b=1):b=0;for(var A=-1,$=0,c=-1,y=!0,F=o.length-1,L=0;F>=b;--F){if(i=o.charCodeAt(F),i===47){if(!y){$=F+1;break}continue}c===-1&&(y=!1,c=F+1),i===46?A===-1?A=F:L!==1&&(L=1):A!==-1&&(L=-1)}return A===-1||c===-1||L===0||L===1&&A===c-1&&A===$+1?c!==-1&&($===0&&v?m.base=m.name=o.slice(1,c):m.base=m.name=o.slice($,c)):($===0&&v?(m.name=o.slice(1,A),m.base=o.slice(1,c)):(m.name=o.slice($,A),m.base=o.slice($,c)),m.ext=o.slice(A,c)),$>0?m.dir=o.slice(0,$-1):v&&(m.dir="/"),m},sep:"/",delimiter:":",win32:null,posix:null};C.posix=C,r.exports=C}),I=Cn(bn()),E=I,cn=I,J=function(n){return n},S=function(){throw new Error("Not implemented")};E.parse??=S;cn.parse??=S;var T={resolve:E.resolve.bind(E),normalize:E.normalize.bind(E),isAbsolute:E.isAbsolute.bind(E),join:E.join.bind(E),relative:E.relative.bind(E),toNamespacedPath:J,dirname:E.dirname.bind(E),basename:E.basename.bind(E),extname:E.extname.bind(E),format:E.format.bind(E),parse:E.parse.bind(E),sep:"/",delimiter:":",win32:void 0,posix:void 0,_makeLong:J},M={sep:"\\",delimiter:";",win32:void 0,...T,posix:T};T.win32=M.win32=M;T.posix=T;var z=T;var{default:X}=(()=>({}));var N={reset:"\x1B[0m",info:"\x1B[34m",warn:"\x1B[33m",error:"\x1B[31m",method:{GET:"\x1B[32m",POST:"\x1B[36m",PUT:"\x1B[35m",DELETE:"\x1B[31m"}},K=(n,r,f)=>{let g=N[n]||N.reset,u=f?.method?N.method[f.method]||N.reset:N.reset;console.log(`
${g}[${n.toUpperCase()}]${N.reset} ${r} - ${u}${f?.method||""}${N.reset}`),console.log(JSON.stringify({timestamp:new Date().toISOString(),...f},null,2)+`
`)},B=(n)=>{n.addHooks("onRequest",async(r,f)=>{r.startTime=Date.now(),K("info","Incoming Request",{method:r.method,url:f.toString(),headers:{"user-agent":r.headers.get("user-agent"),"content-type":r.headers.get("Content-Type")}})}),n.addHooks("postHandler",(r)=>{let f=`${Date.now()-r.req.startTime}ms`;K("info","Response Sent",{method:r.req.method,url:r.url,status:r.status,duration:f,headers:{"content-type":r.headers.get("Content-Type")}})})},x=(n,r,f,g=0,u)=>{let C=n==="<--"?`${n} ${r} ${f}`:`${n} ${r} ${f} ${g} ${u||""}`;console.log(C)},$n=(n)=>{let r=Date.now()-n;return r<1000?`${r}ms`:`${Math.round(r/1000)}s`},Q=(n)=>{n.addHooks("onRequest",(r,f)=>{r.startTime=Date.now(),x("<--",r.method,new URL(f).pathname)}),n.addHooks("postHandler",async(r)=>{let{method:f,url:g}=r.req,u=new URL(g).pathname;x("-->",f,u,r.status,$n(r.req.startTime))}),n.addHooks("routeNotFound",(r)=>{x("routeNotFound",r.req.method,r.url.pathname,404)}),n.addHooks("onError",(r,f,g)=>{K("error","Error occurred",{method:f.method,url:g.toString()})})};class _{tempRoutes;globalMiddlewares;middlewares;trie;hasOnReqHook;hasMiddleware;hasPreHandlerHook;hasPostHandlerHook;hasOnSendHook;hasOnError;hooks;corsConfig;FilterRoutes;filters;filterFunction;hasFilterEnabled;serverInstance;staticPath;staticFiles;user_jwt_secret;baseApiUrl;enableFileRouter;constructor({jwtSecret:n,baseApiUrl:r,enableFileRouting:f}={}){this.enableFileRouter=f??!1,this.baseApiUrl=r||"",this.user_jwt_secret=n||process.env.DIESEL_JWT_SECRET||"feault_diesel_secret_for_jwt",this.tempRoutes=new Map,this.globalMiddlewares=[],this.middlewares=new Map,this.trie=new t,this.corsConfig=null,this.hasMiddleware=!1,this.hasOnReqHook=!1,this.hasPreHandlerHook=!1,this.hasPostHandlerHook=!1,this.hasOnSendHook=!1,this.hasOnError=!1,this.hooks={onRequest:[],preHandler:[],postHandler:[],onSend:[],onError:[],onClose:[],routeNotFound:[]},this.FilterRoutes=[],this.filters=new Set,this.filterFunction=[],this.hasFilterEnabled=!1,this.serverInstance=null,this.staticPath=null,this.staticFiles={}}setupFilter(){return this.hasFilterEnabled=!0,{routeMatcher:(...n)=>{return this.FilterRoutes=n,this.setupFilter()},permitAll:()=>{for(let n of this?.FilterRoutes)this.filters.add(n);return this.FilterRoutes=null,this.setupFilter()},authenticate:(n)=>{if(n?.length)for(let r of n)this.filterFunction.push(r)},authenticateJwt:(n)=>{this.filterFunction.push(U(n,this.user_jwt_secret))},authenticateJwtDB:(n,r)=>{this.filterFunction.push(V(n,r,this.user_jwt_secret))}}}redirect(n,r,f){return this.any(n,(g)=>{let u=g.params,C=r;if(u)for(let m in u)C=C.replace(`:${m}`,u[m]);let o=g.url.search;if(o)C+=o;return g.redirect(C,f)}),this}serveStatic(n){return this.staticPath=n,this}static(n){return this.staticFiles={...this.staticFiles,...n},this}addHooks(n,r){if(typeof n!=="string")throw new Error("hookName must be a string");if(typeof r!=="function")throw new Error("callback must be a instance of function");switch(n){case"onRequest":this.hooks.onRequest?.push(r);break;case"preHandler":this.hooks.preHandler?.push(r);break;case"postHandler":this.hooks.postHandler?.push(r);break;case"onSend":this.hooks.onSend?.push(r);break;case"onError":this.hooks.onError?.push(r);break;case"onClose":this.hooks.onClose?.push(r);break;case"routeNotFound":this.hooks.routeNotFound?.push(r);break;default:throw new Error(`Unknown hook type: ${n}`)}return this}compile(){if(this.globalMiddlewares.length>0)this.hasMiddleware=!0;for(let[n,r]of this.middlewares.entries())if(r.length>0){this.hasMiddleware=!0;break}if(this.enableFileRouter){let n=process.cwd(),r=z.join(n,"src","routes");if(X?.existsSync(r))this.loadRoutes(r,"")}setTimeout(()=>{this.tempRoutes=null},2000)}async registerFileRoutes(n,r,f){let g=await import(n),u;if(f===".ts")u=z.basename(n,".ts");else if(f===".js")u=z.basename(n,".js");let C=r+"/"+u;if(C.endsWith("/index"))C=r;else if(C.endsWith("/api"))C=r;C=C.replace(/\[(.*?)\]/g,":$1");let o=["GET","POST","PUT","PATCH","DELETE","ANY","HEAD","OPTIONS","PROPFIND"];for(let m of o)if(g[m]){let i=m,v=g[m];this[i.toLocaleLowerCase()](`${this.baseApiUrl}${C}`,v)}}async loadRoutes(n,r){let f=await X.promises.readdir(n);for(let g of f){let u=z.join(n,g);if((await X.promises.stat(u)).isDirectory())this.loadRoutes(u,r+"/"+g);else if(g.endsWith(".ts"))this.registerFileRoutes(u,r,".ts");else if(g.endsWith(".js"))this.registerFileRoutes(u,r,".js")}}useLogger(n){return Q(n),this}useAdvancedLogger(n){return B(n),this}listen(n,...r){if(typeof Bun==="undefined")throw new Error(".listen() is designed to run on Bun only...");let f="0.0.0.0",g=void 0,u={};for(let o of r)if(typeof o==="string")f=o;else if(typeof o==="function")g=o;else if(typeof o==="object"&&o!==null)u=o;this.compile();let C={port:n,hostname:f,fetch:async(o,m)=>{let i=new URL(o.url);if(this.hooks.onRequest){let v=this.hooks.onRequest;for(let b=0;b<v.length;b++)await v[b](o,i,m)}return await R(o,m,i,this)},static:this.staticFiles,development:!0};if(u.sslCert&&u.sslKey)C.certFile=u.sslCert,C.keyFile=u.sslKey;if(this.serverInstance=Bun?.serve(C),u.sslCert&&u.sslKey)console.log(`HTTPS server is running on https://localhost:${n}`);if(g)return g();return this.serverInstance}close(n){if(this.serverInstance)this.serverInstance.stop(!0),this.serverInstance=null,n?n():console.log("Server has been stopped");else console.warn("Server is not running.")}route(n,r){if(!n||typeof n!=="string")throw new Error("Path must be a string");let f=Object.fromEntries(r.tempRoutes);return Object.entries(f).forEach(([u,C])=>{let o=u.replace(/::\w+$/,""),m=`${n}${o}`;if(!this.middlewares.has(m))this.middlewares.set(m,[]);C.handlers.slice(0,-1).forEach((A)=>{if(!this.middlewares.get(m)?.includes(A))this.middlewares.get(m)?.push(A)});let v=C.handlers[C.handlers.length-1],b=C.method;try{this.trie.insert(m,{handler:v,method:b})}catch(A){console.error(`Error inserting ${m}:`,A)}}),r=null,this}register(n,r){return this.route(n,r)}addRoute(n,r,f){if(typeof r!=="string")throw new Error(`Error in ${f[f.length-1]}: Path must be a string. Received: ${typeof r}`);if(typeof n!=="string")throw new Error(`Error in addRoute: Method must be a string. Received: ${typeof n}`);this.tempRoutes?.set(r+"::"+n,{method:n,handlers:f});let g=f.slice(0,-1),u=f[f.length-1];if(!this.middlewares.has(r))this.middlewares.set(r,[]);g.forEach((C)=>{if(r==="/")this.globalMiddlewares=[...new Set([...this.globalMiddlewares,...g])];else if(!this.middlewares.get(r)?.includes(C))this.middlewares.get(r)?.push(C)});try{if(n==="ANY"){let C=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD","PROPFIND"];for(let o of C)this.trie.insert(r,{handler:u,method:o})}this.trie.insert(r,{handler:u,method:n})}catch(C){console.error(`Error inserting ${r}:`,C)}}use(n,r){if(Array.isArray(n))n.forEach((g)=>{if(typeof g==="function")this.globalMiddlewares.push(g)});if(typeof n==="function"){if(this.globalMiddlewares.push(n),Array.isArray(r))r.forEach((g)=>{this.globalMiddlewares.push(g)});return}return(Array.isArray(n)?n.filter((g)=>typeof g==="string"):[n].filter((g)=>typeof g==="string")).forEach((g)=>{if(!this.middlewares.has(g))this.middlewares.set(g,[]);if(r)(Array.isArray(r)?r:[r]).forEach((C)=>{this.middlewares.get(g)?.push(C)})}),this}get(n,...r){return this.addRoute("GET",n,r),this}post(n,...r){return this.addRoute("POST",n,r),this}put(n,...r){return this.addRoute("PUT",n,r),this}patch(n,...r){return this.addRoute("PATCH",n,r),this}delete(n,...r){return this.addRoute("DELETE",n,r),this}any(n,...r){return this.addRoute("ANY",n,r),this}head(n,...r){return this.addRoute("HEAD",n,r),this}options(n,...r){return this.addRoute("OPTIONS",n,r),this}propfind(n,...r){return this.addRoute("PROPFIND",n,r),this}}export{_ as default};
