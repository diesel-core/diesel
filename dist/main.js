var s=Object.create;var{getPrototypeOf:q,defineProperty:V,getOwnPropertyNames:k}=Object;var P=Object.prototype.hasOwnProperty;var e=(n,i,g)=>{g=n!=null?s(q(n)):{};let f=i||!n||!n.__esModule?V(g,"default",{value:n,enumerable:!0}):g;for(let A of k(n))if(!P.call(f,A))V(f,A,{get:()=>n[A],enumerable:!0});return f};var h=((n)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(n,{get:(i,g)=>(typeof require!=="undefined"?require:i)[g]}):n)(function(n){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')});class G{children;isEndOfWord;handler;isDynamic;pattern;path;method;constructor(){this.children={},this.isEndOfWord=!1,this.handler=[],this.isDynamic=!1,this.pattern="",this.path="",this.method=[]}}class l{root;constructor(){this.root=new G}insert(n,i){let g=this.root,f=n.split("/").filter(Boolean);if(n==="/"){g.isEndOfWord=!0,g.handler.push(i.handler),g.path=n,g.method.push(i.method);return}for(let A of f){let b=!1,r=A;if(A.startsWith(":"))b=!0,r=":";if(!g.children[r])g.children[r]=new G;g=g.children[r],g.isDynamic=b,g.pattern=A}g.isEndOfWord=!0,g.path=n,g.method.push(i.method),g.handler.push(i.handler)}search(n,i){let g=this.root,f=n.split("/").filter(Boolean),A=f.length;for(let v of f){let o=v;if(!g.children[o])if(g.children[":"])g=g.children[":"];else return null;else g=g.children[o]}let b=g.path.split("/").filter(Boolean);if(A!==b.length)return null;let r=g.method.indexOf(i);if(r!==-1)return{path:g.path,handler:g.handler[r],isDynamic:g.isDynamic,pattern:g.pattern,method:g.method[r]};return{path:g.path,handler:g.handler,isDynamic:g.isDynamic,pattern:g.pattern,method:g.method[r]}}}function p(n){let{time:i=60000,max:g=100,message:f="Rate limit exceeded. Please try again later."}=n,A=new Map;return(b)=>{let r=new Date,v=b.ip;if(!A.has(v))A.set(v,{count:0,startTime:r});let o=A.get(v);if(o)if(r-o.startTime>i)o.count=1,o.startTime=r;else o.count++;if(o&&o.count>g)return b.json({error:f},429)}}function O(n){switch(n.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}function J(n,i){if(!n)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");return(g)=>{try{let f=g.cookies?.accessToken||g.req?.headers?.get("Authorization");if(!f)return g.json({message:"Unauthorized: No token provided"},401);if(f.startsWith("Bearer "))f=f.slice(7);let A=n?.verify(f,i);if(!A)return g.json({message:"Unauthorized: Invalid token"},401);g.set("user",A);return}catch(f){return g.json({message:"Unauthorized: Invalid token",error:f?.message},401)}}}function W(n,i,g){if(!n)throw new Error("JWT library is not defined, please provide jwt to authenticateJwtDB Function");if(!i)throw new Error("User model is not defined, please provide UserModel to authenticateJwtDB Function");return async(f)=>{try{let A=f.cookies?.accessToken||f.req?.headers?.get("Authorization");if(!A)return f.json({message:"Unauthorized: No token provided"},401);if(A.startsWith("Bearer "))A=A.slice(7);let b=n?.verify(A,g);if(!b)return f.json({message:"Unauthorized: Invalid token"},401);let r=await i.findById(b._id).select("-password -refreshToken");if(!r)return f.json({message:"Unauthorized: User not found"},401);f.set("user",r);return}catch(A){return f.json({message:"Unauthorized: Authentication failed",error:A?.message},401)}}}function R(n,i,g){let f=null,A=null,b=null,r=null,v={};return{req:n,server:i,url:g,status:200,headers:new Headers({"Cache-Control":"no-cache"}),setHeader(o,m){return this.headers.set(o,m),this},removeHeader(o){return this.headers.delete(o),this},get ip(){return this.server.requestIP(this.req)?.address??null},get query(){if(!f)try{f=Object.fromEntries(this.url.searchParams)}catch(o){throw new Error("Failed to parse query parameters")}return f},get params(){if(!A&&this.req.routePattern)try{A=a(this.req.routePattern,this.url.pathname)}catch(o){throw new Error("Failed to extract route parameters")}return A??{}},get body(){if(this.req.method==="GET")return Promise.resolve({});if(!r)r=(async()=>{let o=await nn(this.req);if(o.error)throw new Error(o.error);return Object.keys(o).length===0?null:o})();return r},set(o,m){return v[o]=m,this},get(o){return v[o]},text(o,m){if(m)this.status=m;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type","text/plain; charset=utf-8");return new Response(o,{status:this.status,headers:this.headers})},send(o,m){if(m)this.status=m;let u=new Map([["string","text/plain; charset=utf-8"],["object","application/json; charset=utf-8"],["Uint8Array","application/octet-stream"],["ArrayBuffer","application/octet-stream"]]),C=o instanceof Uint8Array?"Uint8Array":o instanceof ArrayBuffer?"ArrayBuffer":typeof o;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",u.get(C)??"text/plain; charset=utf-8");let L=C==="object"&&o!==null?JSON.stringify(o):o;return new Response(L,{status:this.status,headers:this.headers})},json(o,m){if(m)this.status=m;if(!this.headers.has("Content-Type"))this.headers.set("Content-Type","application/json; charset=utf-8");return new Response(JSON.stringify(o),{status:this.status,headers:this.headers})},file(o,m,u){if(u)this.status=u;let C=Bun.file(o);if(!this.headers.has("Content-Type"))this.headers.set("Content-Type",m??O(o));return new Response(C,{status:this.status,headers:this.headers})},async ejs(o,m={},u){if(u)this.status=u;let C;try{C=await import("ejs"),C=C.default||C}catch(L){return console.error("EJS not installed! Please run `bun add ejs`"),new Response("EJS not installed! Please run `bun add ejs`",{status:500})}try{let L=await Bun.file(o).text(),$=C.render(L,m),y=new Headers({"Content-Type":"text/html; charset=utf-8"});return new Response($,{status:this.status,headers:y})}catch(L){return console.error("EJS Rendering Error:",L),new Response("Error rendering template",{status:500})}},redirect(o,m){if(m)this.status=m;else this.status=302;return this.headers.set("Location",o),new Response(null,{status:this.status,headers:this.headers})},setCookie(o,m,u={}){let C=`${encodeURIComponent(o)}=${encodeURIComponent(m)}`;if(u.maxAge)C+=`; Max-Age=${u.maxAge}`;if(u.expires)C+=`; Expires=${u.expires.toUTCString()}`;if(u.path)C+=`; Path=${u.path}`;if(u.domain)C+=`; Domain=${u.domain}`;if(u.secure)C+="; Secure";if(u.httpOnly)C+="; HttpOnly";if(u.sameSite)C+=`; SameSite=${u.sameSite}`;return this.headers.append("Set-Cookie",C),this},get cookies(){if(!b){let o=this.req.headers.get("cookie");b=o?d(o):{}}return b}}}function d(n){return Object.fromEntries(n.split(";").map((i)=>{let[g,...f]=i.trim().split("=");return[g,decodeURIComponent(f.join("="))]}))}function a(n,i){let g={},f=n.split("/"),[A]=i.split("?"),b=A.split("/");if(f.length!==b.length)return null;for(let r=0;r<f.length;r++)if(f[r].startsWith(":"))g[f[r].slice(1)]=b[r];return g}async function nn(n){let i=n.headers.get("Content-Type");if(!i)return{};if(n.headers.get("Content-Length")==="0"||!n.body)return{};try{if(i.startsWith("application/json"))return await n.json();if(i.startsWith("application/x-www-form-urlencoded")){let f=await n.text();return Object.fromEntries(new URLSearchParams(f))}if(i.startsWith("multipart/form-data")){let f=await n.formData(),A={};for(let[b,r]of f.entries())A[b]=r;return A}return{error:"Unknown request body type"}}catch(f){return{error:"Invalid request body format"}}}async function K(n,i,g,f){let A=R(n,i,g),b=f.trie.search(g.pathname,n.method);n.routePattern=b?.path;try{if(f.hasFilterEnabled){let o=n.routePattern??g.pathname,m=await rn(f,o,A,i);if(m)return m}if(f.hasMiddleware){if(f.globalMiddlewares.length){let m=await M(f.globalMiddlewares,A,i);if(m)return m}let o=f.middlewares.get(g.pathname)||[];if(o?.length){let m=await M(o,A,i);if(m)return m}}if(!b?.handler||b.method!==n.method){if(f.staticPath){let o=await on(f,g.pathname,A);if(o)return o;let m=f.trie.search("*",n.method);if(m?.handler)return await m.handler(A)}if(f.hooks.routeNotFound?.length&&Array.isArray(f.hooks.routeNotFound)&&!b?.handler){let o=f.hooks.routeNotFound;for(let m=0;m<o.length;m++){let u=await o[m](A);if(u)return u}}if(!b||!b?.handler?.length)return D(404,`Route not found for ${g.pathname}`);if(b?.method!==n.method)return D(405,"Method not allowed")}if(f.hooks.preHandler?.length&&Array.isArray(f.hooks.preHandler)){let o=f.hooks.preHandler;for(let m=0;m<o.length;m++){let u=await o[m](A);if(u)return u}}let r=b.handler(A),v=r instanceof Promise?await r:r;if(f.hooks.onSend?.length&&Array.isArray(f.hooks.onSend)){let o=f.hooks.onSend;for(let m=0;m<o.length;m++){let u=await o[m](A);if(u)return u}}return v??D(204,"No response from this handler")}catch(r){return f.hooks.onError?.length&&Array.isArray(f.hooks.onError)?f.hooks.onError[0](r,n,g,i):D(500,"Internal Server Error")}finally{if(f.hooks.postHandler?.length&&Array.isArray(f.hooks.postHandler)){let r=f.hooks.postHandler;for(let v=0;v<r.length;v++){let o=await r[v](A);if(o)return o}}}}async function M(n,i,g){for(let f of n){let A=await f(i,g);if(A)return A}return null}async function rn(n,i,g,f){if(!n.filters.has(i))if(n.filterFunction.length)for(let A of n.filterFunction){let b=await A(g,f);if(b)return b}else return g.json({error:!0,message:"Protected route, authentication required",status:401},401)}function D(n,i){return new Response(JSON.stringify({error:!0,message:i,status:n}),{status:n,headers:{"Content-Type":"application/json"}})}async function on(n,i,g){if(!n.staticPath)return null;let f=`${n.staticPath}${i}`;if(await Bun.file(f).exists()){let b=O(f);return g.file(f,b,200)}return null}var{create:gn,defineProperty:Q,getOwnPropertyDescriptor:fn,getOwnPropertyNames:vn,getPrototypeOf:mn}=Object,An=Object.prototype.hasOwnProperty,Cn=(n,i)=>()=>(i||n((i={exports:{}}).exports,i),i.exports),bn=(n,i,g,f)=>{if(i&&typeof i=="object"||typeof i=="function")for(let A of vn(i))!An.call(n,A)&&A!==g&&Q(n,A,{get:()=>i[A],enumerable:!(f=fn(i,A))||f.enumerable});return n},un=(n,i,g)=>(g=n!=null?gn(mn(n)):{},bn(i||!n||!n.__esModule?Q(g,"default",{value:n,enumerable:!0}):g,n)),$n=Cn((n,i)=>{function g(r){if(typeof r!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(r))}function f(r,v){for(var o="",m=0,u=-1,C=0,L,$=0;$<=r.length;++$){if($<r.length)L=r.charCodeAt($);else{if(L===47)break;L=47}if(L===47){if(!(u===$-1||C===1))if(u!==$-1&&C===2){if(o.length<2||m!==2||o.charCodeAt(o.length-1)!==46||o.charCodeAt(o.length-2)!==46){if(o.length>2){var y=o.lastIndexOf("/");if(y!==o.length-1){y===-1?(o="",m=0):(o=o.slice(0,y),m=o.length-1-o.lastIndexOf("/")),u=$,C=0;continue}}else if(o.length===2||o.length===1){o="",m=0,u=$,C=0;continue}}v&&(o.length>0?o+="/..":o="..",m=2)}else o.length>0?o+="/"+r.slice(u+1,$):o=r.slice(u+1,$),m=$-u-1;u=$,C=0}else L===46&&C!==-1?++C:C=-1}return o}function A(r,v){var o=v.dir||v.root,m=v.base||(v.name||"")+(v.ext||"");return o?o===v.root?o+m:o+r+m:m}var b={resolve:function(){for(var r="",v=!1,o,m=arguments.length-1;m>=-1&&!v;m--){var u;m>=0?u=arguments[m]:(o===void 0&&(o=process.cwd()),u=o),g(u),u.length!==0&&(r=u+"/"+r,v=u.charCodeAt(0)===47)}return r=f(r,!v),v?r.length>0?"/"+r:"/":r.length>0?r:"."},normalize:function(r){if(g(r),r.length===0)return".";var v=r.charCodeAt(0)===47,o=r.charCodeAt(r.length-1)===47;return r=f(r,!v),r.length===0&&!v&&(r="."),r.length>0&&o&&(r+="/"),v?"/"+r:r},isAbsolute:function(r){return g(r),r.length>0&&r.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var r,v=0;v<arguments.length;++v){var o=arguments[v];g(o),o.length>0&&(r===void 0?r=o:r+="/"+o)}return r===void 0?".":b.normalize(r)},relative:function(r,v){if(g(r),g(v),r===v||(r=b.resolve(r),v=b.resolve(v),r===v))return"";for(var o=1;o<r.length&&r.charCodeAt(o)===47;++o);for(var m=r.length,u=m-o,C=1;C<v.length&&v.charCodeAt(C)===47;++C);for(var L=v.length,$=L-C,y=u<$?u:$,F=-1,E=0;E<=y;++E){if(E===y){if($>y){if(v.charCodeAt(C+E)===47)return v.slice(C+E+1);if(E===0)return v.slice(C+E)}else u>y&&(r.charCodeAt(o+E)===47?F=E:E===0&&(F=0));break}var U=r.charCodeAt(o+E),t=v.charCodeAt(C+E);if(U!==t)break;U===47&&(F=E)}var T="";for(E=o+F+1;E<=m;++E)(E===m||r.charCodeAt(E)===47)&&(T.length===0?T+="..":T+="/..");return T.length>0?T+v.slice(C+F):(C+=F,v.charCodeAt(C)===47&&++C,v.slice(C))},_makeLong:function(r){return r},dirname:function(r){if(g(r),r.length===0)return".";for(var v=r.charCodeAt(0),o=v===47,m=-1,u=!0,C=r.length-1;C>=1;--C)if(v=r.charCodeAt(C),v===47){if(!u){m=C;break}}else u=!1;return m===-1?o?"/":".":o&&m===1?"//":r.slice(0,m)},basename:function(r,v){if(v!==void 0&&typeof v!="string")throw new TypeError('"ext" argument must be a string');g(r);var o=0,m=-1,u=!0,C;if(v!==void 0&&v.length>0&&v.length<=r.length){if(v.length===r.length&&v===r)return"";var L=v.length-1,$=-1;for(C=r.length-1;C>=0;--C){var y=r.charCodeAt(C);if(y===47){if(!u){o=C+1;break}}else $===-1&&(u=!1,$=C+1),L>=0&&(y===v.charCodeAt(L)?--L===-1&&(m=C):(L=-1,m=$))}return o===m?m=$:m===-1&&(m=r.length),r.slice(o,m)}else{for(C=r.length-1;C>=0;--C)if(r.charCodeAt(C)===47){if(!u){o=C+1;break}}else m===-1&&(u=!1,m=C+1);return m===-1?"":r.slice(o,m)}},extname:function(r){g(r);for(var v=-1,o=0,m=-1,u=!0,C=0,L=r.length-1;L>=0;--L){var $=r.charCodeAt(L);if($===47){if(!u){o=L+1;break}continue}m===-1&&(u=!1,m=L+1),$===46?v===-1?v=L:C!==1&&(C=1):v!==-1&&(C=-1)}return v===-1||m===-1||C===0||C===1&&v===m-1&&v===o+1?"":r.slice(v,m)},format:function(r){if(r===null||typeof r!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof r);return A("/",r)},parse:function(r){g(r);var v={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return v;var o=r.charCodeAt(0),m=o===47,u;m?(v.root="/",u=1):u=0;for(var C=-1,L=0,$=-1,y=!0,F=r.length-1,E=0;F>=u;--F){if(o=r.charCodeAt(F),o===47){if(!y){L=F+1;break}continue}$===-1&&(y=!1,$=F+1),o===46?C===-1?C=F:E!==1&&(E=1):C!==-1&&(E=-1)}return C===-1||$===-1||E===0||E===1&&C===$-1&&C===L+1?$!==-1&&(L===0&&m?v.base=v.name=r.slice(1,$):v.base=v.name=r.slice(L,$)):(L===0&&m?(v.name=r.slice(1,C),v.base=r.slice(1,$)):(v.name=r.slice(L,C),v.base=r.slice(L,$)),v.ext=r.slice(C,$)),L>0?v.dir=r.slice(0,L-1):m&&(v.dir="/"),v},sep:"/",delimiter:":",win32:null,posix:null};b.posix=b,i.exports=b}),x=un($n()),c=x,Ln=x,S=function(n){return n},_=function(){throw new Error("Not implemented")};c.parse??=_;Ln.parse??=_;var w={resolve:c.resolve.bind(c),normalize:c.normalize.bind(c),isAbsolute:c.isAbsolute.bind(c),join:c.join.bind(c),relative:c.relative.bind(c),toNamespacedPath:S,dirname:c.dirname.bind(c),basename:c.basename.bind(c),extname:c.extname.bind(c),format:c.format.bind(c),parse:c.parse.bind(c),sep:"/",delimiter:":",win32:void 0,posix:void 0,_makeLong:S},B={sep:"\\",delimiter:";",win32:void 0,...w,posix:w};w.win32=B.win32=B;w.posix=w;var z=w;var{default:Z}=(()=>({}));var N={reset:"\x1B[0m",info:"\x1B[34m",warn:"\x1B[33m",error:"\x1B[31m",method:{GET:"\x1B[32m",POST:"\x1B[36m",PUT:"\x1B[35m",DELETE:"\x1B[31m"}},Y=(n,i,g)=>{let f=N[n]||N.reset,A=g?.method?N.method[g.method]||N.reset:N.reset;console.log(`
${f}[${n.toUpperCase()}]${N.reset} ${i} - ${A}${g?.method||""}${N.reset}`),console.log(JSON.stringify({timestamp:new Date().toISOString(),...g},null,2)+`
`)},H=(n)=>{n.addHooks("onRequest",async(i,g)=>{i.startTime=Date.now(),Y("info","Incoming Request",{method:i.method,url:g.toString(),headers:{"user-agent":i.headers.get("user-agent"),"content-type":i.headers.get("Content-Type")}})}),n.addHooks("postHandler",(i)=>{let g=`${Date.now()-i.req.startTime}ms`;Y("info","Response Sent",{method:i.req.method,url:i.url,status:i.status,duration:g,headers:{"content-type":i.headers.get("Content-Type")}})})},X=(n,i,g,f=0,A)=>{let b=n==="<--"?`${n} ${i} ${g}`:`${n} ${i} ${g} ${f} ${A||""}`;console.log(b)},En=(n)=>{let i=Date.now()-n;return i<1000?`${i}ms`:`${Math.round(i/1000)}s`},I=(n)=>{n.addHooks("onRequest",(i,g)=>{i.startTime=Date.now(),console.log(`
`),X("<--",i.method,new URL(g).pathname)}),n.addHooks("postHandler",async(i)=>{let{method:g,url:f}=i.req,A=new URL(f).pathname;X("-->",g,A,i.status,En(i.req.startTime))}),n.addHooks("routeNotFound",(i)=>{X("routeNotFound",i.req.method,i.url.pathname,404)}),n.addHooks("onError",(i,g,f)=>{Y("error","Error occurred",{method:g.method,url:f.toString()})})};class j{tempRoutes;globalMiddlewares;middlewares;trie;hasOnReqHook;hasMiddleware;hasPreHandlerHook;hasPostHandlerHook;hasOnSendHook;hasOnError;hooks;corsConfig;FilterRoutes;filters;filterFunction;hasFilterEnabled;serverInstance;staticPath;staticFiles;user_jwt_secret;baseApiUrl;enableFileRouter;constructor({jwtSecret:n,baseApiUrl:i,enableFileRouting:g}={}){this.enableFileRouter=g??!1,this.baseApiUrl=i||"",this.user_jwt_secret=n||process.env.DIESEL_JWT_SECRET||"feault_diesel_secret_for_jwt",this.tempRoutes=new Map,this.globalMiddlewares=[],this.middlewares=new Map,this.trie=new l,this.corsConfig=null,this.hasMiddleware=!1,this.hasOnReqHook=!1,this.hasPreHandlerHook=!1,this.hasPostHandlerHook=!1,this.hasOnSendHook=!1,this.hasOnError=!1,this.hooks={onRequest:[],preHandler:[],postHandler:[],onSend:[],onError:[],onClose:[],routeNotFound:[]},this.FilterRoutes=[],this.filters=new Set,this.filterFunction=[],this.hasFilterEnabled=!1,this.serverInstance=null,this.staticPath=null,this.staticFiles={}}setupFilter(){return this.hasFilterEnabled=!0,{routeMatcher:(...n)=>{return this.FilterRoutes=n,this.setupFilter()},permitAll:()=>{for(let n of this?.FilterRoutes)this.filters.add(n);return this.FilterRoutes=null,this.setupFilter()},authenticate:(n)=>{if(n?.length)for(let i of n)this.filterFunction.push(i)},authenticateJwt:(n)=>{this.filterFunction.push(J(n,this.user_jwt_secret))},authenticateJwtDB:(n,i)=>{this.filterFunction.push(W(n,i,this.user_jwt_secret))}}}redirect(n,i,g){return this.any(n,(f)=>{let A=f.params,b=i;if(A)for(let v in A)b=b.replace(`:${v}`,A[v]);let r=f.url.search;if(r)b+=r;return f.redirect(b,g)}),this}serveStatic(n){return this.staticPath=n,this}static(n){return this.staticFiles={...this.staticFiles,...n},this}addHooks(n,i){if(typeof n!=="string")throw new Error("hookName must be a string");if(typeof i!=="function")throw new Error("callback must be a instance of function");switch(n){case"onRequest":this.hooks.onRequest?.push(i);break;case"preHandler":this.hooks.preHandler?.push(i);break;case"postHandler":this.hooks.postHandler?.push(i);break;case"onSend":this.hooks.onSend?.push(i);break;case"onError":this.hooks.onError?.push(i);break;case"onClose":this.hooks.onClose?.push(i);break;case"routeNotFound":this.hooks.routeNotFound?.push(i);break;default:throw new Error(`Unknown hook type: ${n}`)}return this}compile(){if(this.globalMiddlewares.length>0)this.hasMiddleware=!0;for(let[n,i]of this.middlewares.entries())if(i.length>0){this.hasMiddleware=!0;break}if(this.enableFileRouter){let n=process.cwd(),i=z.join(n,"src","routes");if(Z?.existsSync(i))this.loadRoutes(i,"")}setTimeout(()=>{this.tempRoutes=null},2000)}async registerFileRoutes(n,i,g){let f=await import(n),A;if(g===".ts")A=z.basename(n,".ts");else if(g===".js")A=z.basename(n,".js");let b=i+"/"+A;if(b.endsWith("/index"))b=i;else if(b.endsWith("/api"))b=i;b=b.replace(/\[(.*?)\]/g,":$1");let r=["GET","POST","PUT","PATCH","DELETE","ANY","HEAD","OPTIONS","PROPFIND"];for(let v of r)if(f[v]){let o=v,m=f[v];this[o.toLocaleLowerCase()](`${this.baseApiUrl}${b}`,m)}}async loadRoutes(n,i){let g=await Z.promises.readdir(n);for(let f of g){let A=z.join(n,f);if((await Z.promises.stat(A)).isDirectory())this.loadRoutes(A,i+"/"+f);else if(f.endsWith(".ts"))this.registerFileRoutes(A,i,".ts");else if(f.endsWith(".js"))this.registerFileRoutes(A,i,".js")}}useLogger(n){return I(n),this}useAdvancedLogger(n){return H(n),this}listen(n,...i){if(typeof Bun==="undefined")throw new Error(".listen() is designed to run on Bun only...");let g="0.0.0.0",f=void 0,A={};for(let r of i)if(typeof r==="string")g=r;else if(typeof r==="function")f=r;else if(typeof r==="object"&&r!==null)A=r;this.compile();let b={port:n,hostname:g,fetch:async(r,v)=>{let o=new URL(r.url);if(this.hooks.onRequest){let m=this.hooks.onRequest;for(let u=0;u<m.length;u++)await m[u](r,o,v)}return await K(r,v,o,this)},static:this.staticFiles,development:!0};if(A.sslCert&&A.sslKey)b.certFile=A.sslCert,b.keyFile=A.sslKey;if(this.serverInstance=Bun?.serve(b),A.sslCert&&A.sslKey)console.log(`HTTPS server is running on https://localhost:${n}`);if(f)return f();return this.serverInstance}close(n){if(this.serverInstance)this.serverInstance.stop(!0),this.serverInstance=null,n?n():console.log("Server has been stopped");else console.warn("Server is not running.")}route(n,i){if(!n||typeof n!=="string")throw new Error("Path must be a string");let g=Object.fromEntries(i.tempRoutes);return Object.entries(g).forEach(([A,b])=>{let r=A.replace(/::\w+$/,""),v=`${n}${r}`;if(!this.middlewares.has(v))this.middlewares.set(v,[]);b.handlers.slice(0,-1).forEach((C)=>{if(!this.middlewares.get(v)?.includes(C))this.middlewares.get(v)?.push(C)});let m=b.handlers[b.handlers.length-1],u=b.method;try{this.trie.insert(v,{handler:m,method:u})}catch(C){console.error(`Error inserting ${v}:`,C)}}),i=null,this}register(n,i){return this.route(n,i)}addRoute(n,i,g){if(typeof i!=="string")throw new Error(`Error in ${g[g.length-1]}: Path must be a string. Received: ${typeof i}`);if(typeof n!=="string")throw new Error(`Error in addRoute: Method must be a string. Received: ${typeof n}`);this.tempRoutes?.set(i+"::"+n,{method:n,handlers:g});let f=g.slice(0,-1),A=g[g.length-1];if(!this.middlewares.has(i))this.middlewares.set(i,[]);f.forEach((b)=>{if(i==="/")this.globalMiddlewares=[...new Set([...this.globalMiddlewares,...f])];else if(!this.middlewares.get(i)?.includes(b))this.middlewares.get(i)?.push(b)});try{if(n==="ANY"){let b=["GET","POST","PUT","DELETE","PATCH","OPTIONS","HEAD","PROPFIND"];for(let r of b)this.trie.insert(i,{handler:A,method:r})}this.trie.insert(i,{handler:A,method:n})}catch(b){console.error(`Error inserting ${i}:`,b)}}use(n,i){if(Array.isArray(n))n.forEach((f)=>{if(typeof f==="function")this.globalMiddlewares.push(f)});if(typeof n==="function"){if(this.globalMiddlewares.push(n),Array.isArray(i))i.forEach((f)=>{this.globalMiddlewares.push(f)});return}return(Array.isArray(n)?n.filter((f)=>typeof f==="string"):[n].filter((f)=>typeof f==="string")).forEach((f)=>{if(!this.middlewares.has(f))this.middlewares.set(f,[]);if(i)(Array.isArray(i)?i:[i]).forEach((b)=>{this.middlewares.get(f)?.push(b)})}),this}get(n,...i){return this.addRoute("GET",n,i),this}post(n,...i){return this.addRoute("POST",n,i),this}put(n,...i){return this.addRoute("PUT",n,i),this}patch(n,...i){return this.addRoute("PATCH",n,i),this}delete(n,...i){return this.addRoute("DELETE",n,i),this}any(n,...i){return this.addRoute("ANY",n,i),this}head(n,...i){return this.addRoute("HEAD",n,i),this}options(n,...i){return this.addRoute("OPTIONS",n,i),this}propfind(n,...i){return this.addRoute("PROPFIND",n,i),this}}export{j as default};
