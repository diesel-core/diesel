var N=Object.create;var{getPrototypeOf:O,defineProperty:L,getOwnPropertyNames:Q}=Object;var R=Object.prototype.hasOwnProperty;var V=(v,E,C)=>{C=v!=null?N(O(v)):{};let z=E||!v||!v.__esModule?L(C,"default",{value:v,enumerable:!0}):C;for(let A of Q(v))if(!R.call(z,A))L(z,A,{get:()=>v[A],enumerable:!0});return z};var X=((v)=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(v,{get:(E,C)=>(typeof require!=="undefined"?require:E)[C]}):v)(function(v){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+v+'" is not supported')});function S(v){let{time:E=60000,max:C=100,message:z="Rate limit exceeded. Please try again later."}=v,A=new Map;return(H)=>{let G=new Date,K=H.ip;if(!A.has(K))A.set(K,{count:0,startTime:G});let F=A.get(K);if(F)if(G-F.startTime>E)F.count=1,F.startTime=G;else F.count++;if(F&&F.count>C)return H.json({error:z},429)}}function Z(v){switch(v.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}function $(v,E){if(!v)throw new Error("JWT library is not defined, please provide jwt to authenticateJwt Function");return(C)=>{try{let z=C.cookies?.accessToken||C.req?.headers?.get("Authorization");if(!z)return C.json({message:"Unauthorized: No token provided"},401);if(z.startsWith("Bearer "))z=z.slice(7);let A=v?.verify(z,E);if(!A)return C.json({message:"Unauthorized: Invalid token"},401);C.set("user",A);return}catch(z){return C.json({message:"Unauthorized: Invalid token",error:z?.message},401)}}}function b(v,E,C){if(!v)throw new Error("JWT library is not defined, please provide jwt to authenticateJwtDB Function");if(!E)throw new Error("User model is not defined, please provide UserModel to authenticateJwtDB Function");return async(z)=>{try{let A=z.cookies?.accessToken||z.req?.headers?.get("Authorization");if(!A)return z.json({message:"Unauthorized: No token provided"},401);if(A.startsWith("Bearer "))A=A.slice(7);let H=v?.verify(A,C);if(!H)return z.json({message:"Unauthorized: Invalid token"},401);let G=await E.findById(H._id).select("-password -refreshToken");if(!G)return z.json({message:"Unauthorized: User not found"},401);z.set("user",G);return}catch(A){return z.json({message:"Unauthorized: Authentication failed",error:A?.message},401)}}}export{Z as getMimeType,S as default,$ as authenticateJwtMiddleware,b as authenticateJwtDbMiddleware};
