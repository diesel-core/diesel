function D(I,E,G){let z=new Headers,J={},L=!1,Z,U=null,X,_,K={};return{req:I,server:E,url:G,getUser(){return K},setUser(F){if(F)K=F},getIP(){return this.server.requestIP(this.req)},async getBody(){if(!_)_=await j(I);if(_.error)return new Response(JSON.stringify({error:_.error}),{status:400});return _},setHeader(F,Y){return z.set(F,Y),this},set(F,Y){if(typeof F!=="string")throw new Error("Key must be string type!");if(!Y)throw new Error("value paramter is missing pls pass value after key");return J[F]=Y,this},get(F){return F?J[F]:null},setAuth(F){return L=F,this},getAuth(){return L},text(F,Y){return new Response(F,{status:Y,headers:z})},json(F,Y){return new Response(JSON.stringify(F),{status:Y,headers:z})},file(F,Y){return new Response(Bun.file(F),{status:Y,headers:z})},redirect(F,Y){return z.set("Location",F),new Response(null,{status:Y??302,headers:z})},setCookie(F,Y,$={}){let W=`${encodeURIComponent(F)}=${encodeURIComponent(Y)}`;if($.maxAge)W+=`; Max-Age=${$.maxAge}`;if($.expires)W+=`; Expires=${$.expires.toUTCString()}`;if($.path)W+=`; Path=${$.path}`;if($.domain)W+=`; Domain=${$.domain}`;if($.secure)W+="; Secure";if($.httpOnly)W+="; HttpOnly";if($.sameSite)W+=`; SameSite=${$.sameSite}`;return z?.append("Set-Cookie",W),this},getParams(F){if(!X&&I?.routePattern)X=T(I?.routePattern,G?.pathname);return F?X[F]||{}:X},getQuery(F){try{if(!Z)Z=Object.fromEntries(G.searchParams);return F?Z[F]||{}:Z}catch(Y){return{}}},getCookie(F){if(!U){let Y=I.headers.get("cookie");if(Y)U=A(Y);else return null}if(!U)return null;if(F)return U[F]??null;else return U}}}function A(I){let E={},G=I?.split(";");for(let z=0;z<G?.length;z++){let[J,...L]=G[z].trim().split("="),Z=L?.join("=").trim();if(J)E[J.trim()]=decodeURIComponent(Z)}return E}function T(I,E){let G={},z=I.split("/"),[J]=E.split("?"),L=J.split("/");if(z.length!==L.length)return null;for(let Z=0;Z<z.length;Z++)if(z[Z].startsWith(":"))G[z[Z].slice(1)]=L[Z];return G}async function j(I){let E=I.headers.get("Content-Type");if(!E)return{};try{if(E.startsWith("application/json"))return await I.json();if(E.startsWith("application/x-www-form-urlencoded")){let G=await I.text();return Object.fromEntries(new URLSearchParams(G))}if(E.startsWith("multipart/form-data")){let G=await I.formData(),z={};for(let[J,L]of G.entries())z[J]=L;return z}return{error:"Unknown request body type"}}catch(G){return{error:"Invalid request body format"}}}async function M(I,E,G,z){let J=z.trie.search(G.pathname,I.method);if(J?.isDynamic)I.routePattern=J.path;let L=D(I,E,G);if(z.corsConfig){let U=Q(I,L,z.corsConfig);if(U)return U}if(z.hasOnReqHook&&z.hooks.onRequest)z.hooks.onRequest(I,G,E);if(z.hasFilterEnabled){let U=I.routePattern??G.pathname;if(!z.filters.has(U))if(z.filterFunction)try{let X=await z.filterFunction(L,E);if(X)return X}catch(X){return console.error("Error in filterFunction:",X),L.json({message:"Internal Server Error",error:X.message},500)}else return L.json({message:"Authentication required"},400)}if(z.hasMiddleware){let U=z.globalMiddlewares;for(let _=0;_<U.length;_++){let K=await U[_](L,E);if(K)return K}let X=z.middlewares.get(G.pathname)||[];for(let _=0;_<X.length;_++){let K=await X[_](L,E);if(K)return K}}if(!J||J.method!==I.method){let U=J?"Method not allowed":`Route not found for ${G.pathname}`,X=J?405:404;return new Response(JSON.stringify({message:U}),{status:X})}if(z.hasPreHandlerHook&&z.hooks.preHandler){let U=await z.hooks.preHandler(L);if(U)return U}let Z=await J.handler(L);if(z.hasPostHandlerHook&&z.hooks.postHandler)await z.hooks.postHandler(L);if(z.hasOnSendHook&&z.hooks.onSend){let U=await z.hooks.onSend(L,Z);if(U)return U}return Z??L.json({message:"No response from this handler"},204)}function Q(I,E,G={}){let z=I.headers.get("origin")??"*",J=G?.origin,L=G?.allowedHeaders??["Content-Type","Authorization"],Z=G?.methods??["GET","POST","PUT","DELETE","OPTIONS"],U=G?.credentials??!1,X=G?.exposedHeaders??[];if(E.setHeader("Access-Control-Allow-Methods",Z),E.setHeader("Access-Control-Allow-Headers",L),E.setHeader("Access-Control-Allow-Credentials",U),X.length)E.setHeader("Access-Control-Expose-Headers",X);if(J==="*")E.setHeader("Access-Control-Allow-Origin","*");else if(Array.isArray(J))if(z&&J.includes(z))E.setHeader("Access-Control-Allow-Origin",z);else if(J.includes("*"))E.setHeader("Access-Control-Allow-Origin","*");else return E.json({message:"CORS not allowed"},403);else if(typeof J==="string")if(z===J)E.setHeader("Access-Control-Allow-Origin",z);else return E.json({message:"CORS not allowed"},403);else return E.json({message:"CORS not allowed"},403);if(E.setHeader("Access-Control-Allow-Origin",z),I.method==="OPTIONS")return E.setHeader("Access-Control-Max-Age","86400"),E.text("",204);return null}export{M as default};
