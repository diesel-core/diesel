function D(I,E,G){let z=new Headers,J={},U=!1,Y,L=null,Z,_,K={};return{req:I,server:E,url:G,getUser(){return K},setUser(F){if(F)K=F},getIP(){return this.server.requestIP(this.req)},async getBody(){if(!_)_=await j(I);if(_.error)return new Response(JSON.stringify({error:_.error}),{status:400});return _},setHeader(F,X){return z.set(F,X),this},set(F,X){if(typeof F!=="string")throw new Error("Key must be string type!");if(!X)throw new Error("value paramter is missing pls pass value after key");return J[F]=X,this},get(F){return F?J[F]:null},setAuth(F){return U=F,this},getAuth(){return U},text(F,X){return new Response(F,{status:X,headers:z})},json(F,X){return new Response(JSON.stringify(F),{status:X,headers:z})},file(F,X){return new Response(Bun.file(F),{status:X,headers:z})},redirect(F,X){return z.set("Location",F),new Response(null,{status:X??302,headers:z})},setCookie(F,X,$={}){let W=`${encodeURIComponent(F)}=${encodeURIComponent(X)}`;if($.maxAge)W+=`; Max-Age=${$.maxAge}`;if($.expires)W+=`; Expires=${$.expires.toUTCString()}`;if($.path)W+=`; Path=${$.path}`;if($.domain)W+=`; Domain=${$.domain}`;if($.secure)W+="; Secure";if($.httpOnly)W+="; HttpOnly";if($.sameSite)W+=`; SameSite=${$.sameSite}`;return z?.append("Set-Cookie",W),this},getParams(F){if(!Z&&I?.routePattern)Z=T(I?.routePattern,G?.pathname);if(F)return Z[F]??{};return F},getQuery(F){try{if(!Y)Y=Object.fromEntries(G.searchParams);return F?Y[F]||{}:Y}catch(X){return{}}},getCookie(F){if(!L){let X=I.headers.get("cookie");if(X)L=A(X);else return null}if(!L)return null;if(F)return L[F]??null;else return L}}}function A(I){let E={},G=I?.split(";");for(let z=0;z<G?.length;z++){let[J,...U]=G[z].trim().split("="),Y=U?.join("=").trim();if(J)E[J.trim()]=decodeURIComponent(Y)}return E}function T(I,E){let G={},z=I.split("/"),[J]=E.split("?"),U=J.split("/");if(z.length!==U.length)return null;for(let Y=0;Y<z.length;Y++)if(z[Y].startsWith(":"))G[z[Y].slice(1)]=U[Y];return G}async function j(I){let E=I.headers.get("Content-Type");if(!E)return{};try{if(E.startsWith("application/json"))return await I.json();if(E.startsWith("application/x-www-form-urlencoded")){let G=await I.text();return Object.fromEntries(new URLSearchParams(G))}if(E.startsWith("multipart/form-data")){let G=await I.formData(),z={};for(let[J,U]of G.entries())z[J]=U;return z}return{error:"Unknown request body type"}}catch(G){return{error:"Invalid request body format"}}}async function M(I,E,G,z){let J=z.trie.search(G.pathname,I.method);if(J?.isDynamic)I.routePattern=J.path;let U=D(I,E,G);if(z.corsConfig){let L=Q(I,U,z.corsConfig);if(L)return L}if(z.hasOnReqHook&&z.hooks.onRequest)z.hooks.onRequest(I,G,E);if(z.hasFilterEnabled){let L=I.routePattern??G.pathname;if(!z.filters.has(L))if(z.filterFunction){let Z=await z.filterFunction(U,E);if(Z)return Z}else return U.json({message:"Authentication required"},400)}if(z.hasMiddleware){let L=z.globalMiddlewares;for(let _=0;_<L.length;_++){let K=await L[_](U,E);if(K)return K}let Z=z.middlewares.get(G.pathname)||[];for(let _=0;_<Z.length;_++){let K=await Z[_](U,E);if(K)return K}}if(!J||J.method!==I.method){let L=J?"Method not allowed":`Route not found for ${G.pathname}`,Z=J?405:404;return new Response(JSON.stringify({message:L}),{status:Z})}if(z.hasPreHandlerHook&&z.hooks.preHandler){let L=await z.hooks.preHandler(U);if(L)return L}let Y=await J.handler(U);if(z.hasPostHandlerHook&&z.hooks.postHandler)await z.hooks.postHandler(U);if(z.hasOnSendHook&&z.hooks.onSend){let L=await z.hooks.onSend(U,Y);if(L)return L}return Y??U.json({message:"No response from this handler"},204)}function Q(I,E,G={}){let z=I.headers.get("origin")??"*",J=G?.origin,U=G?.allowedHeaders??["Content-Type","Authorization"],Y=G?.methods??["GET","POST","PUT","DELETE","OPTIONS"],L=G?.credentials??!1,Z=G?.exposedHeaders??[];if(E.setHeader("Access-Control-Allow-Methods",Y),E.setHeader("Access-Control-Allow-Headers",U),E.setHeader("Access-Control-Allow-Credentials",L),Z.length)E.setHeader("Access-Control-Expose-Headers",Z);if(J==="*"||z==="*")E.setHeader("Access-Control-Allow-Origin","*");else if(Array.isArray(J))if(z&&J.includes(z))E.setHeader("Access-Control-Allow-Origin",z);else if(J.includes("*"))E.setHeader("Access-Control-Allow-Origin","*");else return E.json({message:"CORS not allowed"},403);else if(typeof J==="string")if(z===J)E.setHeader("Access-Control-Allow-Origin",z);else return E.json({message:"CORS not allowed"},403);else return E.json({message:"CORS not allowed"},403);if(E.setHeader("Access-Control-Allow-Origin",z),I.method==="OPTIONS")return E.setHeader("Access-Control-Max-Age","86400"),E.text("",204);return null}export{M as default};
