async function O(G){const F={};if(!G)return F;return G.split(";").forEach((I)=>{const[U,J]=I?.trim()?.split("=");if(U&&J)F[U.trim()]=J.split(" ")[0].trim()}),F}function A(G,F){const z={},I=G.split("/"),[U]=F.split("?"),J=U.split("/");if(I.length!==J.length)return null;return I.forEach((X,$)=>{if(X.startsWith(":")){const _=X.slice(1);z[_]=J[$]}}),z}async function V(G){const F=G.headers.get("Content-Type")||"";if(!F)return{};try{if(F.startsWith("application/json"))return await G.json();if(F.startsWith("application/x-www-form-urlencoded")){const z=await G.text();return Object.fromEntries(new URLSearchParams(z))}if(F.startsWith("multipart/form-data")){const z=await G.formData();return j(z)}return{error:"Unknown request body type"}}catch(z){return{error:"Invalid request body format"}}}function j(G){const F={};for(let[z,I]of G.entries())F[z]=I;return F}function M(G,F){let z=new Headers,I={},U=!1,J=null,X=null,$=null,_,K=200;return{req:G,url:F,next:()=>{},status(E){return K=E,this},async body(){if(!_)_=await V(G);if(_.error)return new Response(JSON.stringify({error:_.error}),{status:400});return _},setHeader(E,L){return z.set(E,L),this},set(E,L){return I[E]=L,this},get(E){return I[E]||null},setAuth(E){return U=E,this},getAuth(){return U},text(E,L){return new Response(E,{status:L??K,headers:z})},json(E,L){return new Response(JSON.stringify(E),{status:L??K,headers:z})},html(E,L){return new Response(Bun.file(E),{status:L??K,headers:z})},file(E,L){return new Response(Bun.file(E),{status:L??K,headers:z})},redirect(E,L){return z.set("Location",E),new Response(null,{status:L??302,headers:z})},getParams(E){if(!$)$=A(G?.routePattern,F?.pathname);return E?$[E]||null:$},getQuery(E){if(!J)J=Object.fromEntries(F.searchParams);return E?J[E]||null:J},async cookie(E,L,Y={}){let Z=`${encodeURIComponent(E)}=${encodeURIComponent(L)}`;if(Y.maxAge)Z+=`; Max-Age=${Y.maxAge}`;if(Y.expires)Z+=`; Expires=${Y.expires.toUTCString()}`;if(Y.path)Z+=`; Path=${Y.path}`;if(Y.domain)Z+=`; Domain=${Y.domain}`;if(Y.secure)Z+="; Secure";if(Y.httpOnly)Z+="; HttpOnly";if(Y.sameSite)Z+=`; SameSite=${Y.sameSite}`;return z?.append("Set-Cookie",Z),this},async getCookie(E){if(!X){const L=G.headers.get("cookie");if(L)X=await O(L)}return E?X[E]||null:X}}}async function Q(G,F){for(let z of G){const I=await z(F);if(I)return I}}var W={};async function D(G,F,z){const I=M(G,F);if(z.hasOnReqHook&&z.hooks.onRequest)await z.hooks.onRequest(I);if(z.hasMiddleware){const J=[...z.globalMiddlewares,...z.middlewares.get(F.pathname)||[]],X=await Q(J,I);if(X)return X}let U;if(W[F.pathname+G.method])U=W[F.pathname+G.method];else U=z.trie.search(F.pathname,G.method),W[F.pathname+G.method]=U;if(!U||!U.handler)return new Response(`Route not found for ${F.pathname}`,{status:404});if(U.method!==G.method)return new Response("Method not allowed",{status:405});if(U.isDynamic)G.routePattern=U.path;if(z.hasPreHandlerHook&&z.hooks.preHandler){const J=await z.hooks.preHandler(I);if(J)return J}try{const J=await U.handler(I);if(z.hasPostHandlerHook&&z.hooks.postHandler)await z.hooks.postHandler(I);if(z.hasOnSendHook&&z.hooks.onSend){const X=await z.hooks.onSend(I,J);if(X)return X}return J??new Response("No response from handler",{status:204})}catch(J){return new Response("Internal Server Error",{status:500})}}export{D as default};
