var j=Object.create;var{getPrototypeOf:C,defineProperty:Q,getOwnPropertyNames:P}=Object;var w=Object.prototype.hasOwnProperty;var R=(G,X,F)=>{F=G!=null?j(C(G)):{};let J=X||!G||!G.__esModule?Q(F,"default",{value:G,enumerable:!0}):F;for(let $ of P(G))if(!w.call(J,$))Q(J,$,{get:()=>G[$],enumerable:!0});return J};var b=(G,X)=>()=>(X||G((X={exports:{}}).exports,X),X.exports);var N=b((V)=>{Object.defineProperty(V,"__esModule",{value:!0});V.parse=h;V.serialize=m;var H=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/,f=/^("?)[\u0021\u0023-\u002B\u002D-\u003A\u003C-\u005B\u005D-\u007E]*\1$/,I=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,S=/^[\u0020-\u003A\u003D-\u007E]*$/,v=Object.prototype.toString,y=(()=>{let G=function(){};return G.prototype=Object.create(null),G})();function h(G,X){let F=new y,J=G.length;if(J<2)return F;let $=X?.decode||q,Y=0;do{let L=G.indexOf("=",Y);if(L===-1)break;let z=G.indexOf(";",Y),U=z===-1?J:z;if(L>U){Y=G.lastIndexOf(";",L-1)+1;continue}let W=B(G,Y,L),A=E(G,L,W),T=G.slice(W,A);if(F[T]===void 0){let Z=B(G,L+1,U),K=E(G,U,Z),_=$(G.slice(Z,K));F[T]=_}Y=U+1}while(Y<J);return F}function B(G,X,F){do{let J=G.charCodeAt(X);if(J!==32&&J!==9)return X}while(++X<F);return F}function E(G,X,F){while(X>F){let J=G.charCodeAt(--X);if(J!==32&&J!==9)return X+1}return F}function m(G,X,F){let J=F?.encode||encodeURIComponent;if(!H.test(G))throw new TypeError(`argument name is invalid: ${G}`);let $=J(X);if(!f.test($))throw new TypeError(`argument val is invalid: ${X}`);let Y=G+"="+$;if(!F)return Y;if(F.maxAge!==void 0){if(!Number.isInteger(F.maxAge))throw new TypeError(`option maxAge is invalid: ${F.maxAge}`);Y+="; Max-Age="+F.maxAge}if(F.domain){if(!I.test(F.domain))throw new TypeError(`option domain is invalid: ${F.domain}`);Y+="; Domain="+F.domain}if(F.path){if(!S.test(F.path))throw new TypeError(`option path is invalid: ${F.path}`);Y+="; Path="+F.path}if(F.expires){if(!g(F.expires)||!Number.isFinite(F.expires.valueOf()))throw new TypeError(`option expires is invalid: ${F.expires}`);Y+="; Expires="+F.expires.toUTCString()}if(F.httpOnly)Y+="; HttpOnly";if(F.secure)Y+="; Secure";if(F.partitioned)Y+="; Partitioned";if(F.priority)switch(typeof F.priority==="string"?F.priority.toLowerCase():F.sameSite){case"low":Y+="; Priority=Low";break;case"medium":Y+="; Priority=Medium";break;case"high":Y+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${F.priority}`)}if(F.sameSite)switch(typeof F.sameSite==="string"?F.sameSite.toLowerCase():F.sameSite){case!0:case"strict":Y+="; SameSite=Strict";break;case"lax":Y+="; SameSite=Lax";break;case"none":Y+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${F.sameSite}`)}return Y}function q(G){if(G.indexOf("%")===-1)return G;try{return decodeURIComponent(G)}catch(X){return G}}function g(G){return v.call(G)==="[object Date]"}});var O=R(N(),1);function M(G,X,F){let J=new Headers,$={},Y=!1,L,z=null,U,W,A=200,T={};return{req:G,server:X,url:F,getUser(){return T},setUser(Z){if(Z)T=Z},status(Z){return A=Z,this},getIP(){return this.server.requestIP(this.req)},async getBody(){if(!W)W=await c(G);if(W.error)return new Response(JSON.stringify({error:W.error}),{status:400});return W},setHeader(Z,K){return J.set(Z,K),this},set(Z,K){return $[Z]=K,this},get(Z){return $[Z]||null},setAuth(Z){return Y=Z,this},getAuth(){return Y},text(Z,K){return new Response(Z,{status:K??A,headers:J})},send(Z,K){return new Response(Z,{status:K??A,headers:J})},json(Z,K){return new Response(JSON.stringify(Z),{status:K??A,headers:J})},html(Z,K){return new Response(Bun.file(Z),{status:K??A,headers:J})},file(Z,K){return new Response(Bun.file(Z),{status:K??A,headers:J})},redirect(Z,K){return J.set("Location",Z),new Response(null,{status:K??302,headers:J})},setCookie(Z,K,_={}){let D=`${encodeURIComponent(Z)}=${encodeURIComponent(K)}`;if(_.maxAge)D+=`; Max-Age=${_.maxAge}`;if(_.expires)D+=`; Expires=${_.expires.toUTCString()}`;if(_.path)D+=`; Path=${_.path}`;if(_.domain)D+=`; Domain=${_.domain}`;if(_.secure)D+="; Secure";if(_.httpOnly)D+="; HttpOnly";if(_.sameSite)D+=`; SameSite=${_.sameSite}`;return J?.append("Set-Cookie",D),this},getParams(Z){if(!U&&G?.routePattern)U=x(G?.routePattern,F?.pathname);return Z?U[Z]||{}:U},getQuery(Z){try{if(!L)L=Object.fromEntries(F.searchParams);return Z?L[Z]||{}:L}catch(K){return{}}},getCookie(Z){if(!z){let K=G.headers.get("cookie");if(K)z=O.default.parse(K);else return null}if(!z)return null;if(Z)return z[Z]??null;else return z}}}function x(G,X){let F={},J=G.split("/"),[$]=X.split("?"),Y=$.split("/");if(J.length!==Y.length)return null;return J.forEach((L,z)=>{if(L.startsWith(":")){let U=L.slice(1);F[U]=Y[z]}}),F}async function c(G){let X=G.headers.get("Content-Type")||"";if(!X)return{};try{if(X.startsWith("application/json"))return await G.json();if(X.startsWith("application/x-www-form-urlencoded")){let F=await G.text();return Object.fromEntries(new URLSearchParams(F))}if(X.startsWith("multipart/form-data")){let F=await G.formData(),J={};for(let[$,Y]of F.entries())J[$]=Y;return J}return{error:"Unknown request body type"}}catch(F){return{error:"Invalid request body format"}}}async function l(G,X,F,J){let $=J.trie.search(F.pathname,G.method);if(!$||$.method!==G.method){let z=$?"Method not allowed":`Route not found for ${F.pathname}`,U=$?405:404;return new Response(JSON.stringify({message:z}),{status:U})}if($.isDynamic)G.routePattern=$.path;let Y=M(G,X,F);if(J.corsConfig){let z=p(G,Y,J.corsConfig);if(z)return z}if(J.hasOnReqHook&&J.hooks.onRequest)J.hooks.onRequest(G,F,X);if(J.hasFilterEnabled){let z=G.routePattern??F.pathname;if(J.filters.includes(z)===!1)if(J.filterFunction)try{let W=await J.filterFunction(Y,X);if(W)return W}catch(W){return console.error("Error in filterFunction:",W),Y.status(500).json({message:"Internal Server Error",error:W.message})}else return Y.status(400).json({message:"Authentication required"})}if(J.hasMiddleware){for(let U of J.globalMiddlewares){let W=await U(Y,X);if(W)return W}let z=J.middlewares.get(F.pathname)||[];for(let U of z){let W=await U(Y,X);if(W)return W}}if(J.hasPreHandlerHook&&J.hooks.preHandler){let z=await J.hooks.preHandler(Y);if(z)return z}let L=await $.handler(Y);if(J.hasPostHandlerHook&&J.hooks.postHandler)await J.hooks.postHandler(Y);if(J.hasOnSendHook&&J.hooks.onSend){let z=await J.hooks.onSend(Y,L);if(z)return z}return L??Y.status(204).json({message:"No response from this handler"})}function p(G,X,F={}){let J=G.headers.get("origin")??"*",$=F?.origin,Y=F?.allowedHeaders??["Content-Type","Authorization"],L=F?.methods??["GET","POST","PUT","DELETE","OPTIONS"],z=F?.credentials??!1,U=F?.exposedHeaders??[];if(X.setHeader("Access-Control-Allow-Methods",L),X.setHeader("Access-Control-Allow-Headers",Y),X.setHeader("Access-Control-Allow-Credentials",z),U.length)X.setHeader("Access-Control-Expose-Headers",U);if($==="*")X.setHeader("Access-Control-Allow-Origin","*");else if(Array.isArray($))if(J&&$.includes(J))X.setHeader("Access-Control-Allow-Origin",J);else if($.includes("*"))X.setHeader("Access-Control-Allow-Origin","*");else return X.status(403).json({message:"CORS not allowed"});else if(typeof $==="string")if(J===$)X.setHeader("Access-Control-Allow-Origin",J);else return X.status(403).json({message:"CORS not allowed"});else return X.status(403).json({message:"CORS not allowed"});if(X.setHeader("Access-Control-Allow-Origin",J),G.method==="OPTIONS")return X.setHeader("Access-Control-Max-Age","86400"),X.status(204).text("");return null}export{l as default};
