async function V(F){const E={};if(!F)return E;return F.split(";").forEach((z)=>{const[J,U]=z?.trim()?.split("=");if(J&&U)E[J.trim()]=U.split(" ")[0].trim()}),E}function j(F,E){const G={},z=F.split("/"),[J]=E.split("?"),U=J.split("/");if(z.length!==U.length)return null;return z.forEach((L,Y)=>{if(L.startsWith(":")){const _=L.slice(1);G[_]=U[Y]}}),G}async function D(F){const E=F.headers.get("Content-Type")||"";if(!E)return{};try{if(E.startsWith("application/json"))return await F.json();if(E.startsWith("application/x-www-form-urlencoded")){const G=await F.text();return Object.fromEntries(new URLSearchParams(G))}if(E.startsWith("multipart/form-data")){const G=await F.formData();return Q(G)}return{error:"Unknown request body type"}}catch(G){return{error:"Invalid request body format"}}}function Q(F){const E={};for(let[G,z]of F.entries())E[G]=z;return E}function M(F,E,G){let z=new Headers,J={},U=!1,L=null,Y=null,_=null,K,W=200;return{req:F,server:E,url:G,next:()=>{},status(I){return W=I,this},getIP(){return this.server.requestIP(this.req)},async body(){if(!K)K=await D(F);if(K.error)return new Response(JSON.stringify({error:K.error}),{status:400});return K},setHeader(I,X){return z.set(I,X),this},set(I,X){return J[I]=X,this},get(I){return J[I]||null},setAuth(I){return U=I,this},getAuth(){return U},text(I,X){return new Response(I,{status:X??W,headers:z})},json(I,X){return new Response(JSON.stringify(I),{status:X??W,headers:z})},html(I,X){return new Response(Bun.file(I),{status:X??W,headers:z})},file(I,X){return new Response(Bun.file(I),{status:X??W,headers:z})},redirect(I,X){return z.set("Location",I),new Response(null,{status:X??302,headers:z})},getParams(I){if(!_)_=j(F?.routePattern,G?.pathname);return I?_[I]||null:_},getQuery(I){if(!L)L=Object.fromEntries(G.searchParams);return I?L[I]||null:L},async cookie(I,X,Z={}){let $=`${encodeURIComponent(I)}=${encodeURIComponent(X)}`;if(Z.maxAge)$+=`; Max-Age=${Z.maxAge}`;if(Z.expires)$+=`; Expires=${Z.expires.toUTCString()}`;if(Z.path)$+=`; Path=${Z.path}`;if(Z.domain)$+=`; Domain=${Z.domain}`;if(Z.secure)$+="; Secure";if(Z.httpOnly)$+="; HttpOnly";if(Z.sameSite)$+=`; SameSite=${Z.sameSite}`;return z?.append("Set-Cookie",$),this},async getCookie(I){if(!Y){const X=F.headers.get("cookie");if(X)Y=await V(X)}return I?Y[I]||null:Y}}}async function B(F,E,G){for(let z of F){const J=await z(E,G);if(J)return J}}async function N(F,E,G={}){const z=F.headers.get("origin")??"*",J=G?.origin,U=G?.allowedHeaders??["Content-Type","Authorization"],L=G?.methods??["GET","POST","PUT","DELETE","OPTIONS"],Y=G?.credentials??!1,_=G?.exposedHeaders??[];if(E.setHeader("Access-Control-Allow-Methods",L),E.setHeader("Access-Control-Allow-Headers",U),E.setHeader("Access-Control-Allow-Credentials",Y),_.length)E.setHeader("Access-Control-Expose-Headers",_);if(J==="*")E.setHeader("Access-Control-Allow-Origin","*");else if(Array.isArray(J))if(z&&J.includes(z))E.setHeader("Access-Control-Allow-Origin",z);else if(J.includes("*"))E.setHeader("Access-Control-Allow-Origin","*");else return E.status(403).json({message:"CORS not allowed"});else if(typeof J==="string")if(z===J)E.setHeader("Access-Control-Allow-Origin",z);else return E.status(403).json({message:"CORS not allowed"});else return E.status(403).json({message:"CORS not allowed"});if(E.setHeader("Access-Control-Allow-Origin",z),F.method==="OPTIONS")return E.setHeader("Access-Control-Max-Age","86400"),E.status(204).text("");return null}var A={};async function T(F,E,G,z){const J=M(F,E,G);if(z.corsConfig){const L=await N(F,J,z.corsConfig);if(L)return L}if(z.hasOnReqHook&&z.hooks.onRequest)await z.hooks.onRequest(J,E);if(z.hasMiddleware){const L=[...z.globalMiddlewares,...z.middlewares.get(G.pathname)||[]],Y=await B(L,J,E);if(Y)return Y}let U;if(A[G.pathname+F.method])U=A[G.pathname+F.method];else U=z.trie.search(G.pathname,F.method),A[G.pathname+F.method]=U;if(!U||!U.handler)return new Response(`Route not found for ${G.pathname}`,{status:404});if(U.method!==F.method)return new Response("Method not allowed",{status:405});if(U.isDynamic)F.routePattern=U.path;if(z.hasPreHandlerHook&&z.hooks.preHandler){const L=await z.hooks.preHandler(J);if(L)return L}try{const L=await U.handler(J);if(z.hasPostHandlerHook&&z.hooks.postHandler)await z.hooks.postHandler(J);if(z.hasOnSendHook&&z.hooks.onSend){const Y=await z.hooks.onSend(J,L);if(Y)return Y}return L??new Response("No response from handler",{status:204})}catch(L){return new Response("Internal Server Error",{status:500})}}export{T as default};
