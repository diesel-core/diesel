function A(L){switch(L.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}function Q(L,J,U){let z=new Headers({"X-Powered-By":"DieselJS","Cache-Control":"no-cache"});z.set("X-Powered-By","DieselJS");let X={},Y=!1,K,Z=null,W,E,F={};return{req:L,server:J,url:U,setHeader(G,$){return z.set(G,$),this},getUser(){return F},setUser(G){if(G)F=G},getIP(){return this.server.requestIP(this.req)},async getBody(){if(!E)E=await M(L);if(E.error)return new Response(JSON.stringify({error:E.error}),{status:400});return E},set(G,$){if(typeof G!=="string")throw new Error("Key must be string type!");if(!$)throw new Error("value paramter is missing pls pass value after key");return X[G]=$,this},get(G){return G?X[G]:null},setAuth(G){return Y=G,this},getAuth(){return Y},text(G,$){if(!z.has("Content-Type"))z.set("Content-Type","text/plain; charset=utf-8");return new Response(G,{status:$,headers:z})},send(G,$){if(typeof G==="string"){if(!z.has("Content-Type"))z.set("Content-Type","text/plain; charset=utf-8")}else if(typeof G==="object"){if(!z.has("Content-Type"))z.set("Content-Type","application/json; charset=utf-8");G=JSON.stringify(G)}else if(G instanceof Uint8Array||G instanceof ArrayBuffer){if(!z.has("Content-Type"))z.set("Content-Type","application/octet-stream")}return new Response(G,{status:$,headers:z})},json(G,$){if(!z.has("Content-Type"))z.set("Content-Type","application/json; charset=utf-8");return new Response(JSON.stringify(G),{status:$,headers:z})},file(G,$=200,_){let D=A(G),N=Bun.file(G),j=new Headers;if(!j.has("Content-Type"))j.set("Content-Type",_??D);return new Response(N,{status:$,headers:j})},redirect(G,$){return z.set("Location",G),new Response(null,{status:$??302,headers:z})},setCookie(G,$,_={}){let D=`${encodeURIComponent(G)}=${encodeURIComponent($)}`;if(_.maxAge)D+=`; Max-Age=${_.maxAge}`;if(_.expires)D+=`; Expires=${_.expires.toUTCString()}`;if(_.path)D+=`; Path=${_.path}`;if(_.domain)D+=`; Domain=${_.domain}`;if(_.secure)D+="; Secure";if(_.httpOnly)D+="; HttpOnly";if(_.sameSite)D+=`; SameSite=${_.sameSite}`;return z?.append("Set-Cookie",D),this},getParams(G){if(!W&&L?.routePattern)W=O(L?.routePattern,U?.pathname);if(G)if(W)return W[G];else return;if(W)return G;else return},getQuery(G){try{if(!K)K=Object.fromEntries(U.searchParams);if(G)return K[G]??void 0;return K}catch($){return}},getCookie(G){if(!Z){let $=L.headers.get("cookie");if($)Z=B($);else return}if(!Z)return;if(G)return Z[G]??void 0;else return Z}}}function B(L){let J={},U=L?.split(";");for(let z=0;z<U?.length;z++){let[X,...Y]=U[z].trim().split("="),K=Y?.join("=").trim();if(X)J[X.trim()]=decodeURIComponent(K)}return J}function O(L,J){let U={},z=L.split("/"),[X]=J.split("?"),Y=X.split("/");if(z.length!==Y.length)return null;for(let K=0;K<z.length;K++)if(z[K].startsWith(":"))U[z[K].slice(1)]=Y[K];return U}async function M(L){let J=L.headers.get("Content-Type");if(!J)return{};try{if(J.startsWith("application/json"))return await L.json();if(J.startsWith("application/x-www-form-urlencoded")){let U=await L.text();return Object.fromEntries(new URLSearchParams(U))}if(J.startsWith("multipart/form-data")){let U=await L.formData(),z={};for(let[X,Y]of U.entries())z[X]=Y;return z}return{error:"Unknown request body type"}}catch(U){return{error:"Invalid request body format"}}}async function I(L,J,U,z){let X=z.trie.search(U.pathname,L.method);if(X?.isDynamic)L.routePattern=X.path;let Y=Q(L,J,U);if(z.corsConfig){let Z=C(L,Y,z.corsConfig);if(Z)return Z}if(z.hooks.onRequest)z.hooks.onRequest(L,U,J);if(z.hasFilterEnabled){let Z=L.routePattern??U.pathname,W=await b(z,Z,Y,J);if(W)return W}if(z.hasMiddleware){let Z=z.globalMiddlewares;for(let E=0;E<Z.length;E++){let F=await Z[E](Y,J);if(F)return F}let W=z.middlewares.get(U.pathname)||[];for(let E=0;E<W.length;E++){let F=await W[E](Y,J);if(F)return F}}if(!X||X.method!==L.method){let Z=z.trie.search("*",L.method);if(Z){let W=await T(z,U.pathname,Y);if(W)return W;return await Z.handler(Y)}return V(X?405:404,X?"Method not allowed":`Route not found for ${U.pathname}`)}if(z.hooks.preHandler){let Z=await z.hooks.preHandler(Y);if(Z)return Z}let K=await X.handler(Y);if(z.hooks.postHandler)await z.hooks.postHandler(Y);if(z.hooks.onSend){let Z=await z.hooks.onSend(Y,K);if(Z)return Z}return K??V(204,"No response from this handler")}function C(L,J,U={}){let z=L.headers.get("origin")??"*",X=U?.origin,Y=U?.allowedHeaders??["Content-Type","Authorization"],K=U?.methods??["GET","POST","PUT","DELETE","OPTIONS"],Z=U?.credentials??!1,W=U?.exposedHeaders??[];if(J.setHeader("Access-Control-Allow-Methods",K),J.setHeader("Access-Control-Allow-Headers",Y),J.setHeader("Access-Control-Allow-Credentials",Z),W.length)J.setHeader("Access-Control-Expose-Headers",W);if(X==="*"||z==="*")J.setHeader("Access-Control-Allow-Origin","*");else if(Array.isArray(X))if(z&&X.includes(z))J.setHeader("Access-Control-Allow-Origin",z);else if(X.includes("*"))J.setHeader("Access-Control-Allow-Origin","*");else return J.json({message:"CORS not allowed"},403);else if(typeof X==="string")if(z===X)J.setHeader("Access-Control-Allow-Origin",z);else return J.json({message:"CORS not allowed"},403);else return J.json({message:"CORS not allowed"},403);if(J.setHeader("Access-Control-Allow-Origin",z),L.method==="OPTIONS")return J.setHeader("Access-Control-Max-Age","86400"),J.text("",204);return null}async function b(L,J,U,z){if(!L.filters.has(J)){if(L.filterFunction.length)for(let X of L.filterFunction){let Y=await X(U,z);if(Y)return Y}return U.json({error:!0,message:"Protected route, authentication required",status:401},401)}}function V(L,J){return new Response(JSON.stringify({error:!0,message:J,status:L}),{status:L,headers:{"Content-Type":"application/json"}})}async function T(L,J,U){if(!L.UseStaticFiles)throw new Error("Static files directory is not configured.");let z=`${L.UseStaticFiles}${J}`;if(/\.(js|css|html)$/.test(J)){let X=A(z);return U.file(z,200,X)}return null}export{T as handleStaticFiles,b as handleFilterRequest,V as generateErrorResponse,I as default,C as applyCors};
