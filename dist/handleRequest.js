function V(G){switch(G.split(".").pop()?.toLowerCase()){case"js":return"application/javascript";case"css":return"text/css";case"html":return"text/html";case"json":return"application/json";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"svg":return"image/svg+xml";case"gif":return"image/gif";case"woff":return"font/woff";case"woff2":return"font/woff2";default:return"application/octet-stream"}}function j(G,K,Z){let z=new Headers({"Cache-Control":"no-cache"}),X=null,L=null,N,U,$={};return{req:G,server:K,url:Z,setHeader(A,J){return z.set(A,J),this},removeHeader(A){return z.delete(A),this},get ip(){return this.server.requestIP(this.req)?.address??null},get query(){if(!X)try{X=Object.fromEntries(this.url.searchParams)}catch(A){throw new Error("Failed to parse query parameters")}return X},get params(){if(!N&&this.req.routePattern)try{N=D(this.req.routePattern,this.url.pathname)}catch(A){throw new Error("Failed to extract route parameters")}return N??{}},get body(){if(!U)U=(async()=>{let A=await Q(this.req);if(A.error)throw new Error(A.error);if(A.error)throw new Error(A.error);return A})();return U},set(A,J){return $[A]=J,this},get(A){return $[A]},text(A,J){if(!z.has("Content-Type"))z.set("Content-Type","text/plain; charset=utf-8");return new Response(A,{status:J,headers:z})},send(A,J){if(typeof A==="string"){if(!z.has("Content-Type"))z.set("Content-Type","text/plain; charset=utf-8")}else if(typeof A==="object"){if(!z.has("Content-Type"))z.set("Content-Type","application/json; charset=utf-8");A=JSON.stringify(A)}else if(A instanceof Uint8Array||A instanceof ArrayBuffer){if(!z.has("Content-Type"))z.set("Content-Type","application/octet-stream")}return new Response(A,{status:J,headers:z})},json(A,J){if(!z.has("Content-Type"))z.set("Content-Type","application/json; charset=utf-8");return new Response(JSON.stringify(A),{status:J,headers:z})},file(A,J=200,Y){let O=V(A),E=Bun.file(A),W=new Headers;if(!W.has("Content-Type"))W.set("Content-Type",Y??O);return new Response(E,{status:J,headers:W})},redirect(A,J){return z.set("Location",A),new Response(null,{status:J??302,headers:z})},setCookie(A,J,Y={}){let O=`${encodeURIComponent(A)}=${encodeURIComponent(J)}`;if(Y.maxAge)O+=`; Max-Age=${Y.maxAge}`;if(Y.expires)O+=`; Expires=${Y.expires.toUTCString()}`;if(Y.path)O+=`; Path=${Y.path}`;if(Y.domain)O+=`; Domain=${Y.domain}`;if(Y.secure)O+="; Secure";if(Y.httpOnly)O+="; HttpOnly";if(Y.sameSite)O+=`; SameSite=${Y.sameSite}`;return z?.append("Set-Cookie",O),this},get cookies(){if(!L){let A=this.req.headers.get("cookie");if(A)L=F(A);else return{}}return L}}}function F(G){return Object.fromEntries(G.split(";").map((K)=>{let[Z,...z]=K.trim().split("=");return[Z,decodeURIComponent(z.join("="))]}))}function D(G,K){let Z={},z=G.split("/"),[X]=K.split("?"),L=X.split("/");if(z.length!==L.length)return null;for(let N=0;N<z.length;N++)if(z[N].startsWith(":"))Z[z[N].slice(1)]=L[N];return Z}async function Q(G){let K=G.headers.get("Content-Type");if(!K)return{};if(G.headers.get("Content-Length")==="0"||!G.body)return{};try{if(K.startsWith("application/json"))return await G.json();if(K.startsWith("application/x-www-form-urlencoded")){let z=await G.text();return Object.fromEntries(new URLSearchParams(z))}if(K.startsWith("multipart/form-data")){let z=await G.formData(),X={};for(let[L,N]of z.entries())X[L]=N;return X}return{error:"Unknown request body type"}}catch(z){return{error:"Invalid request body format"}}}async function B(G,K,Z,z){let X=z.trie.search(Z.pathname,G.method);G.routePattern=X?.path;let L=j(G,K,Z);if(z.hasFilterEnabled){let $=G.routePattern??Z.pathname,A=await M(z,$,L,K);if(A)return A}if(z.hasMiddleware){let $=z.globalMiddlewares;for(let J=0;J<$.length;J++){let Y=await $[J](L,K);if(Y)return Y}let A=z.middlewares.get(Z.pathname)||[];for(let J=0;J<A.length;J++){let Y=await A[J](L,K);if(Y)return Y}}if(!X?.handler||X.method!==G.method){let $=z.trie.search("*",G.method);if($){let A=await w(z,Z.pathname,L);if(A)return A;return await $.handler(L)}if(!X||X?.handler.length==0)return _(404,`Route not found for ${Z.pathname}`);else if(X?.method!==G.method)return _(405,"Method not allowed")}if(z.hooks.preHandler){let $=await z.hooks.preHandler(L);if($)return $}let N=X.handler(L),U=N instanceof Promise?await N:N;if(z.hooks.postHandler)await z.hooks.postHandler(L);if(z.hooks.onSend){let $=await z.hooks.onSend(L,U);if($)return $}return U??_(204,"No response from this handler")}async function M(G,K,Z,z){if(!G.filters.has(K))if(G.filterFunction.length)for(let X of G.filterFunction){let L=await X(Z,z);if(L)return L}else return Z.json({error:!0,message:"Protected route, authentication required",status:401},401)}function _(G,K){return new Response(JSON.stringify({error:!0,message:K,status:G}),{status:G,headers:{"Content-Type":"application/json"}})}async function w(G,K,Z){if(!G.UseStaticFiles)throw new Error("Static files directory is not configured.");let z=`${G.UseStaticFiles}${K}`;if(/\.(js|css|html)$/.test(K)){let X=V(z);return Z.file(z,200,X)}return null}export{w as handleStaticFiles,M as handleFilterRequest,_ as generateErrorResponse,B as default};
