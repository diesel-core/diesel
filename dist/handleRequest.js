async function A(G){const F={};if(!G)return F;return G.split(";").forEach((J)=>{const[U,L]=J.trim().split("=");F[U]=L.split(" ")[0]}),F}function V(G,F){const z={},J=G.split("/"),[U]=F.split("?"),L=U.split("/");if(J.length!==L.length)return null;return J.forEach((X,$)=>{if(X.startsWith(":")){const K=X.slice(1);z[K]=L[$]}}),z}async function B(G){const F=G.headers.get("Content-Type")||"";if(!F)return{};try{if(F.startsWith("application/json"))return await G.json();if(F.startsWith("application/x-www-form-urlencoded")){const z=await G.text();return Object.fromEntries(new URLSearchParams(z))}if(F.startsWith("multipart/form-data")){const z=await G.formData();return j(z)}return new Response({error:"Unknown request body type"})}catch(z){return new Response({error:"Invalid request body format"})}}function j(G){const F={};for(let[z,J]of G.entries())F[z]=J;return F}function M(G,F){let z={},J={},U=!1,L=null,X=null,$=null,K=null,Z=200;return{req:G,url:F,next:()=>{},status(E){return Z=E,this},async body(){if(!K)K=await B(G);return K},setHeader(E,I){return z[E]=I,this},set(E,I){return J[E]=I,this},get(E){return J[E]},setAuth(E){return U=E,this},getAuth(){return U},text(E,I){if(I)Z=I;return new Response(E,{status:Z,headers:z})},json(E,I){if(I)Z=I;return new Response(JSON.stringify(E),{status:Z,headers:{"Content-Type":"application/json",...z}})},html(E,I){if(I)Z=I;return new Response(Bun.file(E),{status:Z,headers:{...z}})},file(E,I){if(I)Z=I;return new Response(Bun.file(E),{status:Z,headers:{...z}})},redirect(E,I){if(I)Z=I;return new Response(null,{status:Z,headers:{Location:E,...z}})},getParams(E){if(!$)$=V(G.routePattern,F.pathname);return E?$[E]:$},getQuery(E){if(!L)L=Object.fromEntries(F.searchParams);return E?L[E]:L},async cookie(E,I,Y={}){let _=`${encodeURIComponent(E)}=${encodeURIComponent(I)}`;if(Y.maxAge)_+=`; Max-Age=${Y.maxAge}`;if(Y.expires)_+=`; Expires=${Y.expires.toUTCString()}`;if(Y.path)_+=`; Path=${Y.path}`;if(Y.domain)_+=`; Domain=${Y.domain}`;if(Y.secure)_+="; Secure";if(Y.httpOnly)_+="; HttpOnly";if(Y.sameSite)_+=`; SameSite=${Y.sameSite}`;if(z["Set-Cookie"]){const O=Array.isArray(z["Set-Cookie"])?z["Set-Cookie"]:[z["Set-Cookie"]];O.push(_),z["Set-Cookie"]=O}else z["Set-Cookie"]=_;return this},async getCookie(E){if(!X)X=await A(G.headers.get("cookie"));return E?X[E]:X}}}async function N(G,F){for(let z of G){const J=await z(F);if(J)return J}}var W={};async function D(G,F,z){const J=M(G,F);if(z.hasOnReqHook)await z.hooks.onRequest(J);if(z.hasMiddleware){const L=[...z.globalMiddlewares,...z.middlewares.get(F.pathname)||[]],X=await N(L,J);if(X)return X}let U;if(W[F.pathname+G.method])U=W[F.pathname+G.method];else U=z.trie.search(F.pathname,G.method),W[F.pathname+G.method]=U;if(!U||!U.handler)return new Response(`Route not found for ${F.pathname}`,{status:404});if(U.method!==G.method)return new Response("Method not allowed",{status:405});if(U.isDynamic)G.routePattern=U.path;if(z.hasPreHandlerHook){const L=await z.hooks.preHandler(J);if(L)return L}try{const L=await U.handler(J);if(z.hasPostHandlerHook)await z.hooks.postHandler(J);if(z.hasOnSendHook){const X=await z.hooks.onSend(L,J);if(X)return X}return L??new Response("No response from handler",{status:204})}catch(L){return new Response("Internal Server Error",{status:500})}}export{D as default};
