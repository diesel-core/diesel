async function A(I){const G={};if(!I)return G;return I.split(";").forEach((J)=>{const[X,L]=J?.trim()?.split("=");if(X&&L)G[X.trim()]=L.split(" ")[0].trim()}),G}function O(I,G){const z={},J=I.split("/"),[X]=G.split("?"),L=X.split("/");if(J.length!==L.length)return null;return J.forEach((Y,E)=>{if(Y.startsWith(":")){const $=Y.slice(1);z[$]=L[E]}}),z}async function V(I){const G=I.headers.get("Content-Type")||"";if(!G)return{};try{if(G.startsWith("application/json"))return await I.json();if(G.startsWith("application/x-www-form-urlencoded")){const z=await I.text();return Object.fromEntries(new URLSearchParams(z))}if(G.startsWith("multipart/form-data")){const z=await I.formData();return D(z)}return{error:"Unknown request body type"}}catch(z){return{error:"Invalid request body format"}}}function D(I){const G={};for(let[z,J]of I.entries())G[z]=J;return G}function M(I,G){let z=new Headers,J={},X=!1,L=null,Y=null,E=null,$,K=200;return{req:I,url:G,next:()=>{},status(F){return K=F,this},async body(){if(!$)$=await V(I);if($.error)return new Response(JSON.stringify({error:$.error}),{status:400});return $},setHeader(F,U){return z.set(F,U),this},set(F,U){return J[F]=U,this},get(F){return J[F]||null},setAuth(F){return X=F,this},getAuth(){return X},text(F,U){return new Response(F,{status:U??K,headers:z})},json(F,U){return new Response(JSON.stringify(F),{status:U??K,headers:z})},html(F,U){return new Response(Bun.file(F),{status:U??K,headers:z})},file(F,U){return new Response(Bun.file(F),{status:U??K,headers:z})},redirect(F,U){return z.set("Location",F),new Response(null,{status:U??302,headers:z})},getParams(F){if(!E)E=O(I?.routePattern,G?.pathname);return F?E[F]||null:E},getQuery(F){if(!L)L=Object.fromEntries(G.searchParams);return F?L[F]||null:L},async cookie(F,U,Z={}){let _=`${encodeURIComponent(F)}=${encodeURIComponent(U)}`;if(Z.maxAge)_+=`; Max-Age=${Z.maxAge}`;if(Z.expires)_+=`; Expires=${Z.expires.toUTCString()}`;if(Z.path)_+=`; Path=${Z.path}`;if(Z.domain)_+=`; Domain=${Z.domain}`;if(Z.secure)_+="; Secure";if(Z.httpOnly)_+="; HttpOnly";if(Z.sameSite)_+=`; SameSite=${Z.sameSite}`;return z?.append("Set-Cookie",_),this},async getCookie(F){if(!Y){const U=I.headers.get("cookie");if(U)Y=await A(U)}return F?Y[F]||null:Y}}}async function R(I,G){for(let z of I){const J=await z(G);if(J)return J}}var W={};async function Q(I,G,z){const J=M(I,G);if(z.hasOnReqHook)await z.hooks.onRequest(J);if(z.hasMiddleware){const L=[...z.globalMiddlewares,...z.middlewares.get(G.pathname)||[]],Y=await R(L,J);if(Y)return Y}let X;if(W[G.pathname+I.method])X=W[G.pathname+I.method];else X=z.trie.search(G.pathname,I.method),W[G.pathname+I.method]=X;if(!X||!X.handler)return new Response(`Route not found for ${G.pathname}`,{status:404});if(X.method!==I.method)return new Response("Method not allowed",{status:405});if(X.isDynamic)I.routePattern=X.path;if(z.hasPreHandlerHook){const L=await z.hooks.preHandler(J);if(L)return L}try{const L=await X.handler(J);if(z.hasPostHandlerHook)await z.hooks.postHandler(J);if(z.hasOnSendHook){const Y=await z.hooks.onSend(L,J);if(Y)return Y}return L??new Response("No response from handler",{status:204})}catch(L){return new Response("Internal Server Error",{status:500})}}export{Q as default};
