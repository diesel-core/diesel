async function A(F){const E={};if(!F)return E;return F.split(";").forEach((I)=>{const[J,L]=I?.trim()?.split("=");if(J&&L)E[J.trim()]=L.split(" ")[0].trim()}),E}function V(F,E){const z={},I=F.split("/"),[J]=E.split("?"),L=J.split("/");if(I.length!==L.length)return null;return I.forEach((X,_)=>{if(X.startsWith(":")){const Z=X.slice(1);z[Z]=L[_]}}),z}async function j(F){const E=F.headers.get("Content-Type")||"";if(!E)return{};try{if(E.startsWith("application/json"))return await F.json();if(E.startsWith("application/x-www-form-urlencoded")){const z=await F.text();return Object.fromEntries(new URLSearchParams(z))}if(E.startsWith("multipart/form-data")){const z=await F.formData();return D(z)}return{error:"Unknown request body type"}}catch(z){return{error:"Invalid request body format"}}}function D(F){const E={};for(let[z,I]of F.entries())E[z]=I;return E}function W(F,E){let z=new Headers,I={},J=!1,L=null,X=null,_=null,Z,K=200;return{req:F,url:E,next:()=>{},status(G){return K=G,this},async body(){if(!Z)Z=await j(F);if(Z.error)return new Response(JSON.stringify({error:Z.error}),{status:400});return Z},setHeader(G,U){return z.set(G,U),this},set(G,U){return I[G]=U,this},get(G){return I[G]||null},setAuth(G){return J=G,this},getAuth(){return J},text(G,U){return new Response(G,{status:U??K,headers:z})},json(G,U){return new Response(JSON.stringify(G),{status:U??K,headers:z})},html(G,U){return new Response(Bun.file(G),{status:U??K,headers:z})},file(G,U){return new Response(Bun.file(G),{status:U??K,headers:z})},redirect(G,U){return z.set("Location",G),new Response(null,{status:U??302,headers:z})},getParams(G){if(!_)_=V(F?.routePattern,E?.pathname);return G?_[G]||null:_},getQuery(G){if(!L)L=Object.fromEntries(E.searchParams);return G?L[G]||null:L},async cookie(G,U,Y={}){let $=`${encodeURIComponent(G)}=${encodeURIComponent(U)}`;if(Y.maxAge)$+=`; Max-Age=${Y.maxAge}`;if(Y.expires)$+=`; Expires=${Y.expires.toUTCString()}`;if(Y.path)$+=`; Path=${Y.path}`;if(Y.domain)$+=`; Domain=${Y.domain}`;if(Y.secure)$+="; Secure";if(Y.httpOnly)$+="; HttpOnly";if(Y.sameSite)$+=`; SameSite=${Y.sameSite}`;return z?.append("Set-Cookie",$),this},async getCookie(G){if(!X){const U=F.headers.get("cookie");if(U)X=await A(U)}return G?X[G]||null:X}}}async function T(F,E){for(let z of F){const I=await z(E);if(I)return I}}async function B(F,E,z={}){const I=F.headers.get("origin")??"*",J=z?.origin,L=z?.allowedHeaders??["Content-Type","Authorization"],X=z?.methods??["GET","POST","PUT","DELETE","OPTIONS"],_=z?.credentials??!1,Z=z?.exposedHeaders??[];if(E.setHeader("Access-Control-Allow-Methods",X),E.setHeader("Access-Control-Allow-Headers",L),E.setHeader("Access-Control-Allow-Credentials",_),Z.length)E.setHeader("Access-Control-Expose-Headers",Z);if(J==="*")E.setHeader("Access-Control-Allow-Origin","*");else if(Array.isArray(J))if(I&&J.includes(I))E.setHeader("Access-Control-Allow-Origin",I);else if(J.includes("*"))E.setHeader("Access-Control-Allow-Origin","*");else return E.status(403).json({message:"CORS not allowed"});else if(typeof J==="string")if(I===J)E.setHeader("Access-Control-Allow-Origin",I);else return E.status(403).json({message:"CORS not allowed"});else return E.status(403).json({message:"CORS not allowed"});if(E.setHeader("Access-Control-Allow-Origin",I),F.method==="OPTIONS")return E.setHeader("Access-Control-Max-Age","86400"),E.status(204).text("");return null}var M={};async function Q(F,E,z){const I=W(F,E);if(z.corsConfig){const L=await B(F,I,z.corsConfig);if(L)return L}if(z.hasOnReqHook&&z.hooks.onRequest)await z.hooks.onRequest(I);if(z.hasMiddleware){const L=[...z.globalMiddlewares,...z.middlewares.get(E.pathname)||[]],X=await T(L,I);if(X)return X}let J;if(M[E.pathname+F.method])J=M[E.pathname+F.method];else J=z.trie.search(E.pathname,F.method),M[E.pathname+F.method]=J;if(!J||!J.handler)return new Response(`Route not found for ${E.pathname}`,{status:404});if(J.method!==F.method)return new Response("Method not allowed",{status:405});if(J.isDynamic)F.routePattern=J.path;if(z.hasPreHandlerHook&&z.hooks.preHandler){const L=await z.hooks.preHandler(I);if(L)return L}try{const L=await J.handler(I);if(z.hasPostHandlerHook&&z.hooks.postHandler)await z.hooks.postHandler(I);if(z.hasOnSendHook&&z.hooks.onSend){const X=await z.hooks.onSend(I,L);if(X)return X}return L??new Response("No response from handler",{status:204})}catch(L){return new Response("Internal Server Error",{status:500})}}export{Q as default};
