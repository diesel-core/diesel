async function O(J){const L={};if(!J)return L;return J.split(";").forEach((X)=>{const[_,Y]=X.trim().split("=");L[_]=Y.split(" ")[0]}),L}function V(J,L){const G={},X=J.split("/"),[_]=L.split("?"),Y=_.split("/");if(X.length!==Y.length)return null;return X.forEach((Z,E)=>{if(Z.startsWith(":")){const K=Z.slice(1);G[K]=Y[E]}}),G}async function A(J){const L=J.headers.get("Content-Type")||"";if(!L)return{};try{if(L.startsWith("application/json"))return await J.json();if(L.startsWith("application/x-www-form-urlencoded")){const G=await J.text();return Object.fromEntries(new URLSearchParams(G))}if(L.startsWith("multipart/form-data")){const G=await J.formData();return B(G)}return new Response({error:"Unknown request body type"})}catch(G){return new Response({error:"Invalid request body format"})}}function B(J){const L={};for(let[G,X]of J.entries())L[G]=X;return L}function W(J,L){let G={},X={},_=!1,Y=null,Z=null,E=null,K=null,z=200;return{req:J,url:L,next:()=>{},status(I){return z=I,this},async body(){if(!K)K=await A(J);return K},setHeader(I,U){return G[I]=U,this},set(I,U){return X[I]=U,this},get(I){return X[I]},setAuth(I){return _=I,this},getAuth(){return _},text(I,U){if(U)z=U;return new Response(I,{status:z,headers:G})},json(I,U){if(U)z=U;return new Response(JSON.stringify(I),{status:z,headers:{"Content-Type":"application/json",...G}})},html(I,U){if(U)z=U;return new Response(Bun.file(I),{status:z,headers:{...G}})},file(I,U){if(U)z=U;return new Response(Bun.file(I),{status:z,headers:{...G}})},redirect(I,U){if(U)z=U;return new Response(null,{status:z,headers:{Location:I,...G}})},getParams(I){if(!E)E=V(J.routePattern,L.pathname);return I?E[I]:E},getQuery(I){if(!Y)Y=Object.fromEntries(L.searchParams);return I?Y[I]:Y},async cookie(I,U,$={}){let F=`${encodeURIComponent(I)}=${encodeURIComponent(U)}`;if($.maxAge)F+=`; Max-Age=${$.maxAge}`;if($.expires)F+=`; Expires=${$.expires.toUTCString()}`;if($.path)F+=`; Path=${$.path}`;if($.domain)F+=`; Domain=${$.domain}`;if($.secure)F+="; Secure";if($.httpOnly)F+="; HttpOnly";if($.sameSite)F+=`; SameSite=${$.sameSite}`;if(G["Set-Cookie"]){const M=Array.isArray(G["Set-Cookie"])?G["Set-Cookie"]:[G["Set-Cookie"]];M.push(F),G["Set-Cookie"]=M}else G["Set-Cookie"]=F;return this},async getCookie(I){if(!Z)Z=await O(J.headers.get("cookie"));return I?Z[I]:Z}}}async function D(J,L){for(let G of J){const X=await G(L);if(X)return X}}function Q(J){return new Response(`Route not found for ${J}`,{status:404})}function R(){return new Response("Method not allowed",{status:405})}function T(){return new Response("No response from handler",{status:204})}function b(){return new Response("Internal Server Error",{status:500})}async function j(J,L,G){const X=W(J,L);if(G.hasOnReqHook)for(let Y of G.hooks.onRequest)await Y(X);if(G.hasMiddleware){const Y=[...G.globalMiddlewares,...G.middlewares.get(L.pathname)||[]],Z=await D(Y,X);if(Z)return Z}const _=G.trie.search(L.pathname,J.method);if(!_||!_.handler)return Q(L.pathname);if(_.method!==J.method)return R();if(_.isDynamic)J.routePattern=_.path;if(G.hasPreHandlerHook)for(let Y of G.hooks.preHandler){const Z=await Y(X);if(Z)return Z}try{const Y=await _.handler(X);if(G.hasPostHandlerHook)for(let Z of G.hooks.postHandler)await Z(X);if(G.hasOnSendHook)for(let Z of G.hooks.onSend){const E=await Z(Y,X);if(E)return E}return Y??T()}catch(Y){return b()}}export{j as default};
