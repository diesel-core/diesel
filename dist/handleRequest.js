async function O(J){const L={};if(!J)return L;return J.split(";").forEach((X)=>{const[E,Y]=X.trim().split("=");L[E]=Y.split(" ")[0]}),L}async function R(J,L){const G={},X=J.split("/"),[E]=L.split("?"),Y=E.split("/");if(X.length!==Y.length)return null;return X.forEach(($,z)=>{if($.startsWith(":")){const K=$.slice(1);G[K]=Y[z]}}),G}async function V(J){const L=J.headers.get("Content-Type")||"";if(!L)return{};try{if(L.startsWith("application/json"))return await J.json();if(L.startsWith("application/x-www-form-urlencoded")){const G=await J.text();return Object.fromEntries(new URLSearchParams(G))}if(L.startsWith("multipart/form-data")){const G=await J.formData();return A(G)}return new Response({error:"Unknown request body type"})}catch(G){return new Response({error:"Invalid request body format"})}}function A(J){const L={};for(let[G,X]of J.entries())L[G]=X;return L}function W(J,L){let G={},X={},E=!1,Y=null,$=null,z=null,K=null,_=200;return{req:J,url:L,next:()=>{},status(I){return _=I,this},async body(){if(!K)K=await V(J);return K},setHeader(I,U){return G[I]=U,this},set(I,U){return X[I]=U,this},get(I){return X[I]},setAuth(I){return E=I,this},getAuth(){return E},text(I,U){if(U)_=U;return new Response(I,{status:_,headers:G})},json(I,U){if(U)_=U;return new Response(JSON.stringify(I),{status:_,headers:{"Content-Type":"application/json",...G}})},html(I,U){if(U)_=U;return new Response(Bun.file(I),{status:_,headers:{...G}})},file(I,U){if(U)_=U;return new Response(Bun.file(I),{status:_,headers:{...G}})},redirect(I,U){if(U)_=U;return new Response(null,{status:_,headers:{Location:I,...G}})},async getParams(I){if(!z)z=await R(J.routePattern,L.pathname);return I?z[I]:z},getQuery(I){if(!Y)Y=Object.fromEntries(L.searchParams.entries());return I?Y[I]:Y},async cookie(I,U,Z={}){let F=`${encodeURIComponent(I)}=${encodeURIComponent(U)}`;if(Z.maxAge)F+=`; Max-Age=${Z.maxAge}`;if(Z.expires)F+=`; Expires=${Z.expires.toUTCString()}`;if(Z.path)F+=`; Path=${Z.path}`;if(Z.domain)F+=`; Domain=${Z.domain}`;if(Z.secure)F+="; Secure";if(Z.httpOnly)F+="; HttpOnly";if(Z.sameSite)F+=`; SameSite=${Z.sameSite}`;if(G["Set-Cookie"]){const M=Array.isArray(G["Set-Cookie"])?G["Set-Cookie"]:[G["Set-Cookie"]];M.push(F),G["Set-Cookie"]=M}else G["Set-Cookie"]=F;return this},async getCookie(I){if(!$)$=await O(J.headers.get("cookie"));return I?$[I]:$}}}async function j(J,L){for(let G of J){const X=await G(L);if(X)return X}}function D(J){return new Response(`Route not found for ${J}`,{status:404})}function Q(){return new Response("Method not allowed",{status:405})}function T(){return new Response("No response from handler",{status:204})}function b(){return new Response("Internal Server Error",{status:500})}async function B(J,L,G){const{pathname:X}=L,{method:E}=J,Y=G.trie.search(X,E);if(!Y||!Y.handler)return D(X);if(Y.method!==E)return Q();if(Y.isDynamic)J.routePattern=Y.path;const $=W(J,L);if(G.hasMiddleware){const z=[...G.globalMiddlewares,...G.middlewares.get(X)||[]],K=await j(z,$);if(K)return K}try{return await Y.handler($)??T()}catch(z){return b()}}export{B as default};
