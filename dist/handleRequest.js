function D(I,F,G){let z=new Headers({"X-Powered-By":"DieselJS","Cache-Control":"no-cache"});z.set("X-Powered-By","DieselJS");let J={},U=!1,Y,L=null,Z,$,K={};return{req:I,server:F,url:G,setHeader(E,X){return z.set(E,X),this},getUser(){return K},setUser(E){if(E)K=E},getIP(){return this.server.requestIP(this.req)},async getBody(){if(!$)$=await M(I);if($.error)return new Response(JSON.stringify({error:$.error}),{status:400});return $},set(E,X){if(typeof E!=="string")throw new Error("Key must be string type!");if(!X)throw new Error("value paramter is missing pls pass value after key");return J[E]=X,this},get(E){return E?J[E]:null},setAuth(E){return U=E,this},getAuth(){return U},text(E,X){if(!z.has("Content-Type"))z.set("Content-Type","text/plain; charset=utf-8");return new Response(E,{status:X,headers:z})},send(E,X){if(typeof E==="string"){if(!z.has("Content-Type"))z.set("Content-Type","text/plain; charset=utf-8")}else if(typeof E==="object"){if(!z.has("Content-Type"))z.set("Content-Type","application/json; charset=utf-8");E=JSON.stringify(E)}else if(E instanceof Uint8Array||E instanceof ArrayBuffer){if(!z.has("Content-Type"))z.set("Content-Type","application/octet-stream")}return new Response(E,{status:X,headers:z})},json(E,X){if(!z.has("Content-Type"))z.set("Content-Type","application/json; charset=utf-8");return new Response(JSON.stringify(E),{status:X,headers:z})},file(E,X){let _=Bun.file(E).type||"application/octet-stream";if(!z.has("Content-Type"))z.set("Content-Type",_);return new Response(Bun.file(E),{status:X,headers:z})},redirect(E,X){return z.set("Location",E),new Response(null,{status:X??302,headers:z})},setCookie(E,X,_={}){let W=`${encodeURIComponent(E)}=${encodeURIComponent(X)}`;if(_.maxAge)W+=`; Max-Age=${_.maxAge}`;if(_.expires)W+=`; Expires=${_.expires.toUTCString()}`;if(_.path)W+=`; Path=${_.path}`;if(_.domain)W+=`; Domain=${_.domain}`;if(_.secure)W+="; Secure";if(_.httpOnly)W+="; HttpOnly";if(_.sameSite)W+=`; SameSite=${_.sameSite}`;return z?.append("Set-Cookie",W),this},getParams(E){if(!Z&&I?.routePattern)Z=j(I?.routePattern,G?.pathname);if(E)if(Z)return Z[E];else return;if(Z)return E;else return},getQuery(E){try{if(!Y)Y=Object.fromEntries(G.searchParams);if(E)return Y[E]??void 0;return Y}catch(X){return}},getCookie(E){if(!L){let X=I.headers.get("cookie");if(X)L=A(X);else return}if(!L)return;if(E)return L[E]??void 0;else return L}}}function A(I){let F={},G=I?.split(";");for(let z=0;z<G?.length;z++){let[J,...U]=G[z].trim().split("="),Y=U?.join("=").trim();if(J)F[J.trim()]=decodeURIComponent(Y)}return F}function j(I,F){let G={},z=I.split("/"),[J]=F.split("?"),U=J.split("/");if(z.length!==U.length)return null;for(let Y=0;Y<z.length;Y++)if(z[Y].startsWith(":"))G[z[Y].slice(1)]=U[Y];return G}async function M(I){let F=I.headers.get("Content-Type");if(!F)return{};try{if(F.startsWith("application/json"))return await I.json();if(F.startsWith("application/x-www-form-urlencoded")){let G=await I.text();return Object.fromEntries(new URLSearchParams(G))}if(F.startsWith("multipart/form-data")){let G=await I.formData(),z={};for(let[J,U]of G.entries())z[J]=U;return z}return{error:"Unknown request body type"}}catch(G){return{error:"Invalid request body format"}}}async function Q(I,F,G,z){let J=z.trie.search(G.pathname,I.method);if(J?.isDynamic)I.routePattern=J.path;let U=D(I,F,G);if(z.corsConfig){let L=T(I,U,z.corsConfig);if(L)return L}if(z.hasOnReqHook&&z.hooks.onRequest)z.hooks.onRequest(I,G,F);if(z.hasFilterEnabled){let L=I.routePattern??G.pathname;if(!z.filters.has(L))if(z.filterFunction){let Z=await z.filterFunction(U,F);if(Z)return Z}else return U.json({error:!0,message:"Protected route,authentication required",status:400},400)}if(z.hasMiddleware){let L=z.globalMiddlewares;for(let $=0;$<L.length;$++){let K=await L[$](U,F);if(K)return K}let Z=z.middlewares.get(G.pathname)||[];for(let $=0;$<Z.length;$++){let K=await Z[$](U,F);if(K)return K}}if(!J||J.method!==I.method){let L=J?405:404,Z=J?"Method not allowed":`Route not found for ${G.pathname}`;return new Response(JSON.stringify({error:!0,message:Z,status:L}),{status:L,headers:{"Content-Type":"application/json"}})}if(z.hasPreHandlerHook&&z.hooks.preHandler){let L=await z.hooks.preHandler(U);if(L)return L}let Y=await J.handler(U);if(z.hasPostHandlerHook&&z.hooks.postHandler)await z.hooks.postHandler(U);if(z.hasOnSendHook&&z.hooks.onSend){let L=await z.hooks.onSend(U,Y);if(L)return L}return Y??U.json({error:!0,message:"No response from this handler",status:204},204)}function T(I,F,G={}){let z=I.headers.get("origin")??"*",J=G?.origin,U=G?.allowedHeaders??["Content-Type","Authorization"],Y=G?.methods??["GET","POST","PUT","DELETE","OPTIONS"],L=G?.credentials??!1,Z=G?.exposedHeaders??[];if(F.setHeader("Access-Control-Allow-Methods",Y),F.setHeader("Access-Control-Allow-Headers",U),F.setHeader("Access-Control-Allow-Credentials",L),Z.length)F.setHeader("Access-Control-Expose-Headers",Z);if(J==="*"||z==="*")F.setHeader("Access-Control-Allow-Origin","*");else if(Array.isArray(J))if(z&&J.includes(z))F.setHeader("Access-Control-Allow-Origin",z);else if(J.includes("*"))F.setHeader("Access-Control-Allow-Origin","*");else return F.json({message:"CORS not allowed"},403);else if(typeof J==="string")if(z===J)F.setHeader("Access-Control-Allow-Origin",z);else return F.json({message:"CORS not allowed"},403);else return F.json({message:"CORS not allowed"},403);if(F.setHeader("Access-Control-Allow-Origin",z),I.method==="OPTIONS")return F.setHeader("Access-Control-Max-Age","86400"),F.text("",204);return null}export{Q as default};
